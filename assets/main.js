var si=Object.defineProperty;var ni=(r,t,e)=>t in r?si(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var d=(r,t,e)=>ni(r,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class ee extends Error{constructor(e,i,s){super(e);d(this,"statusCode");d(this,"response");this.statusCode=i,this.response=s,this.name="ThinktAPIError"}}class ie extends Error{constructor(e,i){super(e);d(this,"originalError");this.originalError=i,this.name="ThinktNetworkError"}}const ri={baseUrl:"http://localhost:8784",apiVersion:"/api/v1",timeout:3e4};function E(r,t,e,i){let s=`${r}${t}${e}`;if(i&&Object.keys(i).length>0){const n=new URLSearchParams;for(const[a,l]of Object.entries(i))l!=null&&n.append(a,String(l));const o=n.toString();o&&(s+=`?${o}`)}return s}class oi{constructor(t){d(this,"config");this.config={...ri,...t}}setConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}async fetchWithTimeout(t,e={},i){const s=new AbortController,n=setTimeout(()=>s.abort(),this.config.timeout),o=i?AbortSignal.any([s.signal,i]):s.signal,a=this.config.fetch??fetch;try{const l={};this.config.token&&(l.Authorization=`Bearer ${this.config.token}`);const h=await a(t,{...e,signal:o,headers:{Accept:"application/json",...l,...e.headers}});if(clearTimeout(n),!h.ok){let p;try{p=await h.json()}catch{}throw new ee((p==null?void 0:p.message)||`HTTP ${h.status}: ${h.statusText}`,h.status,p)}return await h.json()}catch(l){throw clearTimeout(n),l instanceof ee?l:l instanceof Error&&l.name==="AbortError"?i!=null&&i.aborted?l:new ie(`Request timeout after ${this.config.timeout}ms`,l):new ie(l instanceof Error?l.message:"Network error",l)}}async getSources(){const t=E(this.config.baseUrl,this.config.apiVersion,"/sources");return(await this.fetchWithTimeout(t)).sources??[]}async getLanguages(){const t=E(this.config.baseUrl,this.config.apiVersion,"/languages");return await this.fetchWithTimeout(t)}async getProjects(t,e){const i=E(this.config.baseUrl,this.config.apiVersion,"/projects",{source:t,include_deleted:e!=null&&e.includeDeleted?"true":void 0});return(await this.fetchWithTimeout(i,{},e==null?void 0:e.signal)).projects??[]}async getSessions(t,e,i){const s=encodeURIComponent(t),n=e==null?void 0:e.trim().toLowerCase(),o=n?`/projects/${encodeURIComponent(n)}/${s}/sessions`:`/projects/${s}/sessions`,a=E(this.config.baseUrl,this.config.apiVersion,o);return(await this.fetchWithTimeout(a,{},i)).sessions??[]}async getSession(t,e){const i=encodeURIComponent(t),s=E(this.config.baseUrl,this.config.apiVersion,`/sessions/${i}`,{limit:e==null?void 0:e.limit,offset:e==null?void 0:e.offset}),n=await this.fetchWithTimeout(s,{},e==null?void 0:e.signal);return{meta:n.meta,entries:n.entries??[],total:n.total??0,has_more:n.has_more??!1}}async getSessionMetadata(t,e){const i=encodeURIComponent(t),s={limit:e==null?void 0:e.limit,offset:e==null?void 0:e.offset,sort_by:e==null?void 0:e.sortBy};e!=null&&e.excludeRoles&&e.excludeRoles.length>0&&(s.exclude_roles=e.excludeRoles.join(",")),(e==null?void 0:e.summaryOnly)!==void 0&&(s.summary_only=e.summaryOnly?"true":"false");const n=E(this.config.baseUrl,this.config.apiVersion,`/sessions/${i}/metadata`,s);return await this.fetchWithTimeout(n)}async openIn(t,e){const i=E(this.config.baseUrl,this.config.apiVersion,"/open-in"),s=await this.fetchWithTimeout(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({app:t,path:e})});if(s.error)throw new Error(s.error)}async getOpenInApps(){const t=E(this.config.baseUrl,this.config.apiVersion,"/open-in/apps");return await this.fetchWithTimeout(t)}async search(t){const e={q:t.query,project:t.project,source:t.source,limit:t.limit,limit_per_session:t.limitPerSession};t.caseSensitive&&(e.case_sensitive="true"),t.regex&&(e.regex="true");const i=E(this.config.baseUrl,this.config.apiVersion,"/search",e);return await this.fetchWithTimeout(i,{},t.signal)}async semanticSearch(t){const e={q:t.query,project:t.project,source:t.source,limit:t.limit,max_distance:t.maxDistance};t.diversity&&(e.diversity="true");const i=E(this.config.baseUrl,this.config.apiVersion,"/semantic-search",e);return await this.fetchWithTimeout(i,{},t.signal)}async getResumeCommand(t){const e=encodeURIComponent(t),i=E(this.config.baseUrl,this.config.apiVersion,`/sessions/${e}/resume`);return await this.fetchWithTimeout(i)}async execResumeSession(t){const e=encodeURIComponent(t),i=E(this.config.baseUrl,this.config.apiVersion,`/sessions/${e}/resume`);return await this.fetchWithTimeout(i,{method:"POST"})}async getIndexerHealth(){const t=E(this.config.baseUrl,this.config.apiVersion,"/indexer/health");return await this.fetchWithTimeout(t)}async getIndexerStatus(){const t=E(this.config.baseUrl,this.config.apiVersion,"/indexer/status");return await this.fetchWithTimeout(t)}async getInfo(){const t=E(this.config.baseUrl,this.config.apiVersion,"/info");return await this.fetchWithTimeout(t)}async resolveSession(t,e){const i=E(this.config.baseUrl,this.config.apiVersion,"/sessions/resolve",{path:t});return await this.fetchWithTimeout(i,{},e)}async getStats(){const t=E(this.config.baseUrl,this.config.apiVersion,"/stats");return await this.fetchWithTimeout(t)}async getTeams(){const t=E(this.config.baseUrl,this.config.apiVersion,"/teams");return(await this.fetchWithTimeout(t)).teams??[]}async getTeam(t){const e=encodeURIComponent(t),i=E(this.config.baseUrl,this.config.apiVersion,`/teams/${e}`);return await this.fetchWithTimeout(i)}async getTeamMemberMessages(t,e){const i=encodeURIComponent(t),s=encodeURIComponent(e),n=E(this.config.baseUrl,this.config.apiVersion,`/teams/${i}/members/${s}/messages`);return(await this.fetchWithTimeout(n)).messages??[]}async getTeamTasks(t){const e=encodeURIComponent(t),i=E(this.config.baseUrl,this.config.apiVersion,`/teams/${e}/tasks`);return(await this.fetchWithTimeout(i)).tasks??[]}async getThemes(){const t=E(this.config.baseUrl,this.config.apiVersion,"/themes");return await this.fetchWithTimeout(t)}async*streamSessionEntries(t,e=100,i){let s=0,n=!0;for(;n;){const o=await this.getSession(t,{limit:e,offset:s,signal:i});for(const a of o.entries)yield a;if(n=o.has_more,s+=o.entries.length,o.entries.length===0)break}}async getAllSessionEntries(t,e=100,i){const s=[];for await(const n of this.streamSessionEntries(t,e,i))s.push(n);return s}}function $t(r){return r==="thinkt"?"thinkt":r==="codex"?"codex":r==="copilot"?"copilot":r==="kimi"?"kimi":r==="gemini"?"gemini":r==="qwen"?"qwen":"claude"}function ai(r){switch(r){case"user":return"user";case"assistant":return"assistant";case"tool":return"tool";case"system":return"system";case"summary":return"summary";case"progress":return"progress";case"checkpoint":return"checkpoint";default:return"assistant"}}function li(r){switch(r.type??"text"){case"text":return{type:"text",text:r.text??""};case"thinking":return{type:"thinking",thinking:r.thinking??"",signature:r.signature};case"tool_use":return{type:"tool_use",toolUseId:r.tool_use_id??"",toolName:r.tool_name??"unknown",toolInput:r.tool_input??{}};case"tool_result":return{type:"tool_result",toolUseId:r.tool_use_id??"",toolResult:r.tool_result??"",isError:r.is_error??!1};case"image":return{type:"image",mediaType:r.media_type??"image/png",mediaData:r.media_data??""};case"document":return{type:"document",mediaType:r.media_type??"application/pdf",mediaData:r.media_data??"",filename:void 0};default:return{type:"text",text:r.text??""}}}function ci(r){return{id:r.id??"",name:r.name??"",path:r.path??"",displayPath:r.display_path,sessionCount:r.session_count??0,lastModified:r.last_modified?new Date(r.last_modified):void 0,source:$t(r.source),workspaceId:r.workspace_id,sourceBasePath:r.source_base_path,pathExists:r.path_exists??!0}}function se(r){return{id:r.id??"unknown",projectPath:r.project_path,fullPath:r.full_path,firstPrompt:r.first_prompt,summary:r.summary,entryCount:r.entry_count??0,fileSize:r.file_size,createdAt:r.created_at?new Date(r.created_at):void 0,modifiedAt:r.modified_at?new Date(r.modified_at):void 0,gitBranch:r.git_branch,model:r.model,source:$t(r.source),workspaceId:r.workspace_id,chunkCount:r.chunk_count,title:r.first_prompt?r.first_prompt.slice(0,60)+(r.first_prompt.length>60?"...":""):r.id??"Untitled Session"}}function ne(r){var i;const t=((i=r.content_blocks)==null?void 0:i.map(li))??[],e={};return r.metadata&&Object.assign(e,r.metadata),r.workspace_id&&(e.workspaceId=r.workspace_id),{uuid:r.uuid??`entry-${Date.now()}-${Math.random().toString(36).slice(2)}`,parentUuid:r.parent_uuid??void 0,role:ai(r.role),timestamp:r.timestamp?new Date(r.timestamp):new Date,source:$t(r.source),contentBlocks:t,text:r.text??t.filter(s=>s.type==="text").map(s=>s.text).join(`
`),model:r.model,usage:r.usage?{inputTokens:r.usage.input_tokens??0,outputTokens:r.usage.output_tokens??0,cacheCreationInputTokens:r.usage.cache_creation_input_tokens,cacheReadInputTokens:r.usage.cache_read_input_tokens}:void 0,gitBranch:r.git_branch,cwd:r.cwd,isCheckpoint:r.is_checkpoint??!1,isSidechain:r.is_sidechain??!1,agentId:r.agent_id,sourceAgentId:r.source_agent_id,metadata:Object.keys(e).length>0?e:void 0}}function hi(r){return r==="thinkt"?"thinkt":r==="codex"?"codex":r==="copilot"?"copilot":r==="kimi"?"kimi":r==="gemini"?"gemini":r==="qwen"?"qwen":"claude"}class je{constructor(t){d(this,"_api");this._api=new oi(t)}get api(){return this._api}setConfig(t){this._api.setConfig(t)}getConfig(){return this._api.getConfig()}async getSources(){return this._api.getSources()}async getLanguages(){return this._api.getLanguages()}async getProjects(t,e){return(await this._api.getProjects(t,e)).map(ci)}async getSessions(t,e,i){return(await this._api.getSessions(t,e,i)).map(se)}async getSession(t,e){const i=await this._api.getSession(t,e);return{meta:se(i.meta),entries:i.entries.map(ne),total:i.total,hasMore:i.has_more}}async getSessionMetadata(t,e){const i=await this._api.getSessionMetadata(t,e),s=i.meta;return{meta:{id:(s==null?void 0:s.id)??"unknown",fullPath:s==null?void 0:s.path,entryCount:i.total_entries??0,createdAt:s!=null&&s.created_at?new Date(s.created_at):void 0,modifiedAt:s!=null&&s.modified_at?new Date(s.modified_at):void 0,gitBranch:s==null?void 0:s.git_branch,model:s==null?void 0:s.model,source:hi(s==null?void 0:s.source),title:(s==null?void 0:s.id)??"Session Metadata"},description:i.description,roleCounts:i.role_counts??{},entrySummary:(i.entry_summary??[]).map(o=>({index:o.index,role:o.role,timestamp:o.timestamp,contentLength:o.content_length,hasThinking:o.has_thinking,hasToolUse:o.has_tool_use,hasToolResult:o.has_tool_result,preview:o.preview})),totalEntries:i.total_entries??0,totalContentBytes:i.total_content_bytes??0,returnedSummaries:i.returned_summaries??0}}async openIn(t,e){return this._api.openIn(t,e)}async getOpenInApps(){return this._api.getOpenInApps()}async search(t){return this._api.search(t)}async semanticSearch(t){return this._api.semanticSearch(t)}async getResumeCommand(t){return this._api.getResumeCommand(t)}async execResumeSession(t){return this._api.execResumeSession(t)}async getIndexerHealth(){return this._api.getIndexerHealth()}async getIndexerStatus(){return this._api.getIndexerStatus()}async getInfo(){return this._api.getInfo()}async getStats(){return this._api.getStats()}async getTeams(){return this._api.getTeams()}async getTeam(t){return this._api.getTeam(t)}async getTeamMemberMessages(t,e){return this._api.getTeamMemberMessages(t,e)}async getTeamTasks(t){return this._api.getTeamTasks(t)}async getThemes(){return this._api.getThemes()}async*streamSessionEntries(t,e,i){for await(const s of this._api.streamSessionEntries(t,e,i))yield ne(s)}async getAllSessionEntries(t,e,i){const s=[];for await(const n of this.streamSessionEntries(t,e,i))s.push(n);return s}}let Y=null;function B(){return Y||(Y=new je),Y}function di(r){Y?Y.setConfig(r):Y=new je(r)}const q=r=>typeof r=="string",pi=r=>typeof r=="function",re=new Map,Ae="en";function jt(r){return[...Array.isArray(r)?r:[r],Ae]}function At(r,t,e){const i=jt(r);e||(e="default");let s;if(typeof e=="string")switch(s={day:"numeric",month:"short",year:"numeric"},e){case"full":s.weekday="long";case"long":s.month="long";break;case"short":s.month="numeric";break}else s=e;return ht(()=>dt("date",i,e),()=>new Intl.DateTimeFormat(i,s)).format(q(t)?new Date(t):t)}function ui(r,t,e){let i;if(e||(e="default"),typeof e=="string")switch(i={second:"numeric",minute:"numeric",hour:"numeric"},e){case"full":case"long":i.timeZoneName="short";break;case"short":delete i.second}else i=e;return At(r,t,i)}function wt(r,t,e){const i=jt(r);return ht(()=>dt("number",i,e),()=>new Intl.NumberFormat(i,e)).format(t)}function oe(r,t,e,{offset:i=0,...s}){const n=jt(r),o=t?ht(()=>dt("plural-ordinal",n),()=>new Intl.PluralRules(n,{type:"ordinal"})):ht(()=>dt("plural-cardinal",n),()=>new Intl.PluralRules(n,{type:"cardinal"}));return s[e]??s[o.select(e-i)]??s.other}function ht(r,t){const e=r();let i=re.get(e);return i||(i=t(),re.set(e,i)),i}function dt(r,t,e){const i=t.join("-");return`${r}-${i}-${JSON.stringify(e)}`}const Le=/\\u[a-fA-F0-9]{4}|\\x[a-fA-F0-9]{2}/,Ie=r=>r.replace(/\\u([a-fA-F0-9]{4})|\\x([a-fA-F0-9]{2})/g,(t,e,i)=>{if(e){const s=parseInt(e,16);return String.fromCharCode(s)}else{const s=parseInt(i,16);return String.fromCharCode(s)}}),Re="%__lingui_octothorpe__%",mi=(r,t,e={})=>{const i=t||r,s=o=>typeof o=="object"?o:e[o],n=(o,a)=>{const l=Object.keys(e).length?s("number"):void 0,h=wt(i,o,l);return a.replace(new RegExp(Re,"g"),h)};return{plural:(o,a)=>{const{offset:l=0}=a,h=oe(i,!1,o,a);return n(o-l,h)},selectordinal:(o,a)=>{const{offset:l=0}=a,h=oe(i,!0,o,a);return n(o-l,h)},select:gi,number:(o,a)=>wt(i,o,s(a)||{style:a}),date:(o,a)=>At(i,o,s(a)||a),time:(o,a)=>ui(i,o,s(a)||a)}},gi=(r,t)=>t[r]??t.other;function fi(r,t,e){return(i={},s)=>{const n=mi(t,e,s),o=(l,h=!1)=>Array.isArray(l)?l.reduce((p,u)=>{if(u==="#"&&h)return p+Re;if(q(u))return p+u;const[g,m,b]=u;let f={};m==="plural"||m==="selectordinal"||m==="select"?Object.entries(b).forEach(([x,k])=>{f[x]=o(k,m==="plural"||m==="selectordinal")}):f=b;let v;if(m){const x=n[m];v=x(i[g],f)}else v=i[g];return v==null?p:p+v},""):l,a=o(r);return q(a)&&Le.test(a)?Ie(a):q(a)?a:a?String(a):""}}var ki=Object.defineProperty,bi=(r,t,e)=>t in r?ki(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,vi=(r,t,e)=>(bi(r,t+"",e),e);class xi{constructor(){vi(this,"_events",{})}on(t,e){var i;return(i=this._events)[t]??(i[t]=[]),this._events[t].push(e),()=>this.removeListener(t,e)}removeListener(t,e){const i=this._getListeners(t);if(!i)return;const s=i.indexOf(e);~s&&i.splice(s,1)}emit(t,...e){const i=this._getListeners(t);i&&i.map(s=>s.apply(this,e))}_getListeners(t){const e=this._events[t];return Array.isArray(e)?e:!1}}var wi=Object.defineProperty,yi=(r,t,e)=>t in r?wi(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,W=(r,t,e)=>(yi(r,typeof t!="symbol"?t+"":t,e),e);class _i extends xi{constructor(t){super(),W(this,"_locale",""),W(this,"_locales"),W(this,"_localeData",{}),W(this,"_messages",{}),W(this,"_missing"),W(this,"_messageCompiler"),W(this,"t",this._.bind(this)),t.missing!=null&&(this._missing=t.missing),t.messages!=null&&this.load(t.messages),t.localeData!=null&&this.loadLocaleData(t.localeData),(typeof t.locale=="string"||t.locales)&&this.activate(t.locale??Ae,t.locales)}get locale(){return this._locale}get locales(){return this._locales}get messages(){return this._messages[this._locale]??{}}get localeData(){return this._localeData[this._locale]??{}}_loadLocaleData(t,e){const i=this._localeData[t];i?Object.assign(i,e):this._localeData[t]=e}setMessagesCompiler(t){return this._messageCompiler=t,this}loadLocaleData(t,e){typeof t=="string"?this._loadLocaleData(t,e):Object.keys(t).forEach(i=>this._loadLocaleData(i,t[i])),this.emit("change")}_load(t,e){const i=this._messages[t];i?Object.assign(i,e):this._messages[t]=e}load(t,e){typeof t=="string"&&typeof e=="object"?this._load(t,e):Object.entries(t).forEach(([i,s])=>this._load(i,s)),this.emit("change")}loadAndActivate({locale:t,locales:e,messages:i}){this._locale=t,this._locales=e||void 0,this._messages[this._locale]=i,this.emit("change")}activate(t,e){this._locale=t,this._locales=e,this.emit("change")}_(t,e,i){if(!this.locale)throw new Error("Lingui: Attempted to call a translation function without setting a locale.\nMake sure to call `i18n.activate(locale)` before using Lingui functions.\nThis issue may also occur due to a race condition in your initialization logic.");let s=i==null?void 0:i.message;t||(t=""),q(t)||(e=t.values||e,s=t.message,t=t.id);const n=this.messages[t],o=n===void 0,a=this._missing;if(a&&o)return pi(a)?a(this._locale,t):a;o&&this.emit("missing",{id:t,locale:this._locale});let l=n||s||t;return q(l)&&(this._messageCompiler?l=this._messageCompiler(l):console.warn(`Uncompiled message detected! Message:

> ${l}

That means you use raw catalog or your catalog doesn't have a translation for the message and fallback was used.
ICU features such as interpolation and plurals will not work properly for that message. 

Please compile your catalog first. 
`)),q(l)&&Le.test(l)?Ie(l):q(l)?l:fi(l,this._locale,this._locales)(e,i==null?void 0:i.formats)}date(t,e){return At(this._locales||this._locale,t,e)}number(t,e){return wt(this._locales||this._locale,t,e)}}function Si(r={}){return new _i(r)}const c=Si(),ae=new Set;function N(r,t){if(!ae.has(r)){if(!document.getElementById(r)){const e=document.createElement("style");e.id=r,e.textContent=t,document.head.appendChild(e)}ae.add(r)}}const Ci='.thinkt-project-browser{display:flex;flex-direction:column;height:100%;font-family:var(--thinkt-font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif);color:var(--thinkt-text-color, #e0e0e0);background:var(--thinkt-bg-color, #1a1a1a)}.thinkt-project-browser__header{padding:8px 12px;border-bottom:1px solid var(--thinkt-border-color, #333);flex-shrink:0}.thinkt-project-browser__toolbar{display:flex;gap:6px;margin-bottom:6px}.thinkt-project-browser__search{flex:1;padding:6px 10px;border:1px solid var(--thinkt-border-color, #333);border-radius:4px;background:var(--thinkt-input-bg, #252525);color:inherit;font-size:13px}.thinkt-project-browser__search:focus{outline:none;border-color:var(--thinkt-accent-color, #6366f1)}.thinkt-project-browser__search::placeholder{color:var(--thinkt-muted-color, #666)}.thinkt-project-browser__filter{padding:6px 8px;border:1px solid var(--thinkt-border-color, #333);border-radius:4px;background:var(--thinkt-input-bg, #252525);color:inherit;font-size:12px;min-width:90px}.thinkt-project-browser__stats{font-size:11px;color:var(--thinkt-muted-color, #666)}.thinkt-project-browser__content{flex:1;overflow-y:auto}.thinkt-project-browser__list{list-style:none;margin:0;padding:0}.thinkt-project-browser__item{display:flex;align-items:center;padding:8px 12px;cursor:pointer;transition:background-color .12s ease;border-bottom:1px solid var(--thinkt-border-color, #252525);border-left:2px solid transparent}.thinkt-project-browser__item:hover{background:var(--thinkt-hover-bg, #252525)}.thinkt-project-browser__item--selected{background:var(--thinkt-selected-bg, rgba(99, 102, 241, .15));border-left-color:var(--thinkt-accent-color, #6366f1)}.thinkt-project-browser__icon{width:28px;height:28px;border-radius:4px;display:flex;align-items:center;justify-content:center;margin-right:10px;font-size:14px;flex-shrink:0}.thinkt-project-browser__icon--claude{background:var(--thinkt-source-claude-bg, rgba(217, 119, 80, .15));color:var(--thinkt-source-claude-color, #d97750)}.thinkt-project-browser__icon--kimi{background:var(--thinkt-source-kimi-bg, rgba(25, 195, 155, .15));color:var(--thinkt-source-kimi-color, #19c39b)}.thinkt-project-browser__icon--gemini{background:var(--thinkt-source-gemini-bg, rgba(99, 102, 241, .15));color:var(--thinkt-source-gemini-color, #6366f1)}.thinkt-project-browser__info{flex:1;min-width:0}.thinkt-project-browser__name{font-weight:500;font-size:13px;margin-bottom:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--thinkt-text-color, #e0e0e0)}.thinkt-project-browser__path{font-size:11px;color:var(--thinkt-muted-color, #666);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.thinkt-project-browser__meta{text-align:right;font-size:11px;color:var(--thinkt-muted-color, #666)}.thinkt-project-browser__count{display:block;font-weight:500;color:var(--thinkt-text-color, #e0e0e0)}.thinkt-project-browser__loading{display:flex;align-items:center;justify-content:center;padding:48px;color:var(--thinkt-muted-color, #888)}.thinkt-project-browser__empty{text-align:center;padding:48px;color:var(--thinkt-muted-color, #888)}.thinkt-project-browser__error{padding:16px;margin:16px;background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:8px;color:#ef4444}.thinkt-project-browser__retry{margin-top:8px;padding:6px 12px;background:transparent;border:1px solid currentColor;border-radius:4px;color:inherit;cursor:pointer;font-size:12px}.thinkt-project-browser__retry:hover{background:#ef444433}';class Ti{constructor(t){d(this,"elements");d(this,"options");d(this,"client");d(this,"projects",[]);d(this,"filteredProjects",[]);d(this,"discoveredSources",[]);d(this,"filters");d(this,"showAllWhenNoSourceSelected");d(this,"lastLoadedIncludeDeleted",!1);d(this,"selectedIndex",-1);d(this,"loadController",null);d(this,"itemElements",new Map);d(this,"currentError",null);d(this,"abortController",new AbortController);d(this,"disposed",!1);this.elements=t.elements,this.options={...t,enableSearch:t.enableSearch??!0,enableSourceFilter:t.enableSourceFilter??!0,classPrefix:t.classPrefix??"thinkt-project-browser"},this.filters=t.filters??{searchQuery:"",sources:new Set,sort:"date_desc",includeDeleted:!1},this.showAllWhenNoSourceSelected=t.filters===void 0,this.client=t.client??B(),this.init(),this.loadProjects()}init(){N("thinkt-project-browser-styles",Ci),this.createStructure(),this.attachListeners(),window.addEventListener("thinkt:locale-changed",()=>this.refreshI18n(),{signal:this.abortController.signal})}createStructure(){const{container:t}=this.elements,{classPrefix:e}=this.options;t.className=e;const i=document.createElement("div");i.className=`${e}__header`;const s=this.options.enableSearch||this.options.enableSourceFilter,n=document.createElement("div");if(n.className=`${e}__toolbar`,this.options.enableSearch){const h=this.elements.searchInput??document.createElement("input");h.className=`${e}__search`,h.type="text",h.placeholder=c._("Filter projects..."),h.value=this.filters.searchQuery,this.elements.searchInput||(this.elements.searchInput=h,n.appendChild(h))}if(this.options.enableSourceFilter){const h=this.elements.sourceFilter??document.createElement("select");h.className=`${e}__filter`,this.elements.sourceFilter||(this.elements.sourceFilter=h,n.appendChild(h)),this.renderSourceFilterOptions()}s&&n.childElementCount>0&&i.appendChild(n);const o=document.createElement("div");o.className=`${e}__stats`,o.textContent=c._("Loading..."),i.appendChild(o),t.appendChild(i);const a=document.createElement("div");a.className=`${e}__content`;const l=document.createElement("ul");l.className=`${e}__list`,l.setAttribute("role","listbox"),a.appendChild(l),this.elements.loadingIndicator||(this.elements.loadingIndicator=document.createElement("div"),this.elements.loadingIndicator.className=`${e}__loading`,this.elements.loadingIndicator.textContent=c._("Loading projects...")),a.appendChild(this.elements.loadingIndicator),this.elements.errorDisplay||(this.elements.errorDisplay=document.createElement("div"),this.elements.errorDisplay.className=`${e}__error`,this.elements.errorDisplay.style.display="none"),a.appendChild(this.elements.errorDisplay),t.appendChild(a)}attachListeners(){const{searchInput:t,container:e}=this.elements;if(t){const s=()=>{this.filters.searchQuery=t.value.toLowerCase(),this.filterProjects()};t.addEventListener("input",s,{signal:this.abortController.signal})}const i=s=>this.handleKeydown(s);e.addEventListener("keydown",i,{signal:this.abortController.signal}),e.setAttribute("tabindex","0")}handleKeydown(t){if(this.filteredProjects.length!==0)switch(t.key){case"ArrowDown":t.preventDefault(),this.selectIndex(Math.min(this.selectedIndex+1,this.filteredProjects.length-1));break;case"ArrowUp":t.preventDefault(),this.selectIndex(Math.max(this.selectedIndex-1,0));break;case"Enter":this.selectedIndex>=0&&this.selectProject(this.filteredProjects[this.selectedIndex]);break;case"Home":t.preventDefault(),this.selectIndex(0);break;case"End":t.preventDefault(),this.selectIndex(this.filteredProjects.length-1);break}}get isLoading(){return this.loadController!==null&&!this.loadController.signal.aborted}async loadProjects(){var e,i,s,n,o;(e=this.loadController)==null||e.abort();const t=new AbortController;this.loadController=t,this.showLoading(!0),this.showError(null);try{if(this.projects=await this.client.getProjects(void 0,{includeDeleted:this.filters.includeDeleted,signal:t.signal}),t.signal.aborted)return;this.lastLoadedIncludeDeleted=this.filters.includeDeleted;const a=new Set(this.discoveredSources);this.projects.forEach(l=>{typeof l.source=="string"&&l.source.trim().length>0&&a.add(l.source.trim().toLowerCase())}),this.discoveredSources=Array.from(a).sort((l,h)=>l.localeCompare(h)),this.renderSourceFilterOptions(),this.filterProjects(),Promise.resolve((s=(i=this.options).onProjectsLoaded)==null?void 0:s.call(i,this.projects))}catch(a){if(t.signal.aborted)return;const l=a instanceof Error?a:new Error(String(a));this.showError(l),(o=(n=this.options).onError)==null||o.call(n,l)}finally{this.loadController===t&&(this.loadController=null,this.showLoading(!1))}}showLoading(t){this.elements.loadingIndicator&&(this.elements.loadingIndicator.style.display=t?"flex":"none");const e=this.elements.container.querySelector(`.${this.options.classPrefix}__list`);e&&(e.style.display=t?"none":"block")}showError(t){if(this.elements.errorDisplay)if(this.currentError=t,t){this.elements.errorDisplay.replaceChildren();const e=document.createElement("div");e.textContent=t.message,this.elements.errorDisplay.appendChild(e);const i=document.createElement("button");i.className=`${this.options.classPrefix}__retry`,i.textContent=c._("Retry"),i.addEventListener("click",()=>{this.loadProjects()}),this.elements.errorDisplay.appendChild(i),this.elements.errorDisplay.style.display="block"}else this.elements.errorDisplay.style.display="none"}filterProjects(){const t=this.filters.searchQuery.trim().toLowerCase(),e=this.filters.sources;this.filteredProjects=this.projects.filter(i=>{var a,l;const s=!t||((a=i.name)==null?void 0:a.toLowerCase().includes(t))||((l=i.path)==null?void 0:l.toLowerCase().includes(t)),n=typeof i.source=="string"?i.source.trim().toLowerCase():"",o=this.showAllWhenNoSourceSelected&&e.size===0||n.length>0&&e.has(n);return s&&o}),this.filteredProjects.sort((i,s)=>this.compareProjects(i,s)),this.selectedIndex=-1,this.render()}projectSortName(t){return(t.name??t.displayPath??t.path??"").toLowerCase()}projectSortTime(t){if(!t.lastModified)return 0;const e=t.lastModified instanceof Date?t.lastModified:new Date(t.lastModified);return Number.isNaN(e.getTime())?0:e.getTime()}compareProjects(t,e){const i=()=>this.projectSortName(t).localeCompare(this.projectSortName(e)),s=()=>this.projectSortTime(t)-this.projectSortTime(e);switch(this.filters.sort){case"name_asc":return i();case"name_desc":return i()*-1;case"date_asc":{const n=s();return n!==0?n:i()}case"date_desc":default:{const n=s()*-1;return n!==0?n:i()}}}renderSourceFilterOptions(){}render(){this.updateStats(),this.renderList()}updateStats(){const t=this.elements.container.querySelector(`.${this.options.classPrefix}__stats`);if(t){const e=this.projects.length,i=this.filteredProjects.length;i===e?t.textContent=c._("{count, plural, one {# project} other {# projects}}",{count:e}):t.textContent=c._("Showing {showing} of {total} projects",{showing:i,total:e})}}renderList(){var i;const t=this.elements.container.querySelector("ul");if(!t)return;if(t.replaceChildren(),this.itemElements.clear(),this.elements.container.querySelectorAll(`.${this.options.classPrefix}__empty`).forEach(s=>s.remove()),this.filteredProjects.length===0){const s=document.createElement("div");s.className=`${this.options.classPrefix}__empty`,s.textContent=this.projects.length===0?c._("No projects found"):c._("No projects match your search"),(i=t.parentElement)==null||i.appendChild(s);return}for(let s=0;s<this.filteredProjects.length;s++){const n=this.filteredProjects[s],o=this.renderProjectItem(n,s);t.appendChild(o),this.itemElements.set(this.projectKey(n,s),o)}}renderProjectItem(t,e){if(this.options.projectRenderer)return this.options.projectRenderer(t,e);const{classPrefix:i}=this.options,s=document.createElement("li");s.className=`${i}__item`,s.setAttribute("role","option"),s.setAttribute("aria-selected","false"),s.dataset.index=String(e),s.dataset.projectId=t.id;const n=t.source??"claude",o=`${i}__icon--${n}`;let a="ðŸ…²";return n==="kimi"&&(a="ðŸ…º"),n==="gemini"&&(a="ðŸ…¶"),s.innerHTML=`
      <div class="${i}__icon ${o}">${a}</div>
      <div class="${i}__info">
        <div class="${i}__name">${this.escapeHtml(t.name??c._("Unknown"))}</div>
        <div class="${i}__path">${this.escapeHtml(t.displayPath??t.path??"")}</div>
      </div>
      <div class="${i}__meta">
        <span class="${i}__count">${t.sessionCount??0}</span>
        <span>${c._("{count, plural, one {session} other {sessions}}",{count:t.sessionCount??0})}</span>
      </div>
    `,s.addEventListener("click",()=>{this.selectIndex(e),this.selectProject(t)}),s}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}projectKey(t,e){return t.id??`project-${e}`}selectIndex(t){if(this.selectedIndex>=0){const e=this.filteredProjects[this.selectedIndex],i=e?this.itemElements.get(this.projectKey(e,this.selectedIndex)):void 0;i&&(i.classList.remove(`${this.options.classPrefix}__item--selected`),i.setAttribute("aria-selected","false"))}if(this.selectedIndex=t,t>=0){const e=this.filteredProjects[t],i=e?this.itemElements.get(this.projectKey(e,t)):void 0;i&&(i.classList.add(`${this.options.classPrefix}__item--selected`),i.setAttribute("aria-selected","true"),i.scrollIntoView({block:"nearest",behavior:"smooth"}))}}selectProject(t){var e,i;(i=(e=this.options).onProjectSelect)==null||i.call(e,t)}getProjects(){return[...this.projects]}getFilteredProjects(){return[...this.filteredProjects]}getSelectedProject(){return this.selectedIndex>=0?this.filteredProjects[this.selectedIndex]??null:null}selectProjectById(t){const e=this.filteredProjects.findIndex(i=>i.id===t);e>=0&&this.selectIndex(e)}refresh(){this.loadProjects()}applyFilters(){if(this.filters.includeDeleted!==this.lastLoadedIncludeDeleted){this.loadProjects();return}this.isLoading||this.filterProjects()}focusSearch(){var t;(t=this.elements.searchInput)==null||t.focus()}refreshI18n(){this.elements.searchInput&&(this.elements.searchInput.placeholder=c._("Filter projects...")),this.elements.loadingIndicator&&(this.elements.loadingIndicator.textContent=c._("Loading projects...")),this.renderSourceFilterOptions(),this.updateStats(),this.renderList(),this.currentError&&this.showError(this.currentError)}dispose(){var e;if(this.disposed)return;this.abortController.abort(),(e=this.loadController)==null||e.abort(),this.itemElements.clear(),this.projects=[],this.filteredProjects=[];const t=this.elements.container.querySelector(`.${this.options.classPrefix}__content`);t&&t.replaceChildren(),this.disposed=!0}}const Ei='.thinkt-session-list{display:flex;flex-direction:column;height:100%;font-family:var(--thinkt-font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif);color:var(--thinkt-text-color, #e0e0e0);background:var(--thinkt-bg-color, #1a1a1a)}.thinkt-session-list__header{padding:8px 12px;border-bottom:1px solid var(--thinkt-border-color, #333);flex-shrink:0}.thinkt-session-list__controls{display:flex;gap:6px;align-items:center}.thinkt-session-list__search{flex:1;min-width:0;padding:6px 10px;border:1px solid var(--thinkt-border-color, #333);border-radius:4px;background:var(--thinkt-input-bg, #252525);color:inherit;font-size:13px;box-sizing:border-box}.thinkt-session-list__search:focus{outline:none;border-color:var(--thinkt-accent-color, #6366f1)}.thinkt-session-list__search::placeholder{color:var(--thinkt-muted-color, #666)}.thinkt-session-list__sort{min-width:88px;max-width:104px;width:100%;padding:6px 8px;border:1px solid var(--thinkt-border-color, #333);border-radius:4px;background:var(--thinkt-input-bg, #252525);color:inherit;font-size:12px}.thinkt-session-list__sort:focus{outline:none;border-color:var(--thinkt-accent-color, #6366f1)}.thinkt-session-list__stats{font-size:11px;color:var(--thinkt-muted-color, #666);margin-top:6px}.thinkt-session-list__content{flex:1;overflow-y:auto}.thinkt-session-list__list{list-style:none;margin:0;padding:0}.thinkt-session-list__item{padding:10px 12px;cursor:pointer;transition:background-color .12s ease;border-bottom:1px solid var(--thinkt-border-color, #252525);border-left:2px solid transparent}.thinkt-session-list__item:hover{background:var(--thinkt-hover-bg, #252525)}.thinkt-session-list__item--selected{background:var(--thinkt-selected-bg, rgba(99, 102, 241, .15));border-left-color:var(--thinkt-accent-color, #6366f1)}.thinkt-session-list__title{font-weight:400;font-size:13px;line-height:1.4;margin-bottom:4px;color:var(--thinkt-text-color, #e0e0e0);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.thinkt-session-list__summary{font-size:12px;color:var(--thinkt-muted-color, #888);margin-bottom:6px;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;line-height:1.3}.thinkt-session-list__meta{display:flex;align-items:center;gap:8px;font-size:11px;color:var(--thinkt-muted-color, #666);flex-wrap:wrap}.thinkt-session-list__meta-item{display:flex;align-items:center;gap:3px}.thinkt-session-list__meta-icon{width:12px;height:12px;opacity:.6}.thinkt-session-list__badge{display:inline-flex;align-items:center;padding:1px 4px;border-radius:3px;font-size:9px;font-weight:600;text-transform:uppercase;letter-spacing:.3px}.thinkt-session-list__badge--claude{background:var(--thinkt-source-claude-bg, rgba(217, 119, 80, .15));color:var(--thinkt-source-claude-color, #d97750)}.thinkt-session-list__badge--kimi{background:var(--thinkt-source-kimi-bg, rgba(25, 195, 155, .15));color:var(--thinkt-source-kimi-color, #19c39b)}.thinkt-session-list__badge--gemini,.thinkt-session-list__badge--chunked{background:var(--thinkt-source-gemini-bg, rgba(99, 102, 241, .15));color:var(--thinkt-source-gemini-color, #6366f1)}.thinkt-session-list__loading{display:flex;align-items:center;justify-content:center;padding:48px;color:var(--thinkt-muted-color, #888)}.thinkt-session-list__empty{text-align:center;padding:48px;color:var(--thinkt-muted-color, #888)}.thinkt-session-list__error{padding:16px;margin:16px;background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:8px;color:#ef4444}.thinkt-session-list__retry{margin-top:8px;padding:6px 12px;background:transparent;border:1px solid currentColor;border-radius:4px;color:inherit;cursor:pointer;font-size:12px}.thinkt-session-list__retry:hover{background:#ef444433}',le=80;function Pi(r){if(!r)return c._("Unknown");try{const t=r instanceof Date?r:new Date(r),i=new Date().getTime()-t.getTime(),s=Math.floor(i/1e3),n=Math.floor(s/60),o=Math.floor(n/60),a=Math.floor(o/24),l=Math.floor(a/7),h=Math.floor(a/30),p=Math.floor(a/365);return s<60?c._("just now"):n<60?c._("{count}m ago",{count:n}):o<24?c._("{count}h ago",{count:o}):a<7?c._("{count}d ago",{count:a}):l<4?c._("{count}w ago",{count:l}):h<12?c._("{count}mo ago",{count:h}):c._("{count}y ago",{count:p})}catch{return c._("Invalid")}}function $i(r){return r==null?"0":r>=1e6?(r/1e6).toFixed(1)+"M":r>=1e3?(r/1e3).toFixed(1)+"k":r.toString()}class ji{constructor(t){d(this,"elements");d(this,"options");d(this,"client");d(this,"sessions",[]);d(this,"filteredSessions",[]);d(this,"sortMode","date_desc");d(this,"selectedIndex",-1);d(this,"loadController",null);d(this,"itemElements",new Map);d(this,"currentError",null);d(this,"abortController",new AbortController);d(this,"disposed",!1);this.elements=t.elements,this.options={...t,enableSearch:t.enableSearch??!0,classPrefix:t.classPrefix??"thinkt-session-list",dateLocale:t.dateLocale??"en-US",showEntryCount:t.showEntryCount??!0,showFileSize:t.showFileSize??!0,showModel:t.showModel??!0},this.client=t.client??B(),this.init()}async init(){N("thinkt-session-list-styles",Ei),this.createStructure(),this.attachListeners(),window.addEventListener("thinkt:locale-changed",()=>this.refreshI18n(),{signal:this.abortController.signal}),this.options.projectId&&await this.loadSessions(this.options.projectId,this.options.projectSource)}createStructure(){const{container:t}=this.elements,{classPrefix:e}=this.options;t.className=e,t.replaceChildren();const i=document.createElement("div");if(i.className=`${e}__header`,this.options.enableSearch){const a=document.createElement("div");a.className=`${e}__controls`;const l=this.elements.searchInput??document.createElement("input");l.className=`${e}__search`,l.type="text",l.placeholder=c._("Filter sessions..."),this.elements.searchInput||(this.elements.searchInput=l);const h=this.elements.sortSelect??document.createElement("select");h.className=`${e}__sort`,this.elements.sortSelect||(this.elements.sortSelect=h),this.renderSortOptions(),a.appendChild(l),a.appendChild(h),i.appendChild(a)}const s=document.createElement("div");s.className=`${e}__stats`,s.textContent=this.options.projectId?c._("Loading..."):c._("Select a project"),i.appendChild(s),t.appendChild(i);const n=document.createElement("div");n.className=`${e}__content`;const o=document.createElement("ul");o.className=`${e}__list`,o.setAttribute("role","listbox"),n.appendChild(o),this.elements.loadingIndicator||(this.elements.loadingIndicator=document.createElement("div"),this.elements.loadingIndicator.className=`${e}__loading`,this.elements.loadingIndicator.textContent=c._("Loading sessions...")),n.appendChild(this.elements.loadingIndicator),this.elements.errorDisplay||(this.elements.errorDisplay=document.createElement("div"),this.elements.errorDisplay.className=`${e}__error`,this.elements.errorDisplay.style.display="none"),n.appendChild(this.elements.errorDisplay),t.appendChild(n)}attachListeners(){const{searchInput:t,sortSelect:e,container:i}=this.elements;if(t){const n=()=>this.filterSessions();t.addEventListener("input",n,{signal:this.abortController.signal})}if(e){const n=()=>{this.sortMode=this.normalizeSortMode(e.value),this.filterSessions()};e.addEventListener("change",n,{signal:this.abortController.signal})}const s=n=>this.handleKeydown(n);i.addEventListener("keydown",s,{signal:this.abortController.signal}),i.setAttribute("tabindex","0")}handleKeydown(t){if(this.filteredSessions.length!==0)switch(t.key){case"ArrowDown":t.preventDefault(),this.selectIndex(Math.min(this.selectedIndex+1,this.filteredSessions.length-1));break;case"ArrowUp":t.preventDefault(),this.selectIndex(Math.max(this.selectedIndex-1,0));break;case"Enter":this.selectedIndex>=0&&this.selectSession(this.filteredSessions[this.selectedIndex]);break;case"Home":t.preventDefault(),this.selectIndex(0);break;case"End":t.preventDefault(),this.selectIndex(this.filteredSessions.length-1);break}}get isLoading(){return this.loadController!==null&&!this.loadController.signal.aborted}async loadSessions(t,e){var s,n,o,a,l;(s=this.loadController)==null||s.abort();const i=new AbortController;this.loadController=i,this.options.projectId=t,this.options.projectSource=(e==null?void 0:e.trim().toLowerCase())||void 0,this.showLoading(!0),this.showError(null),this.sessions=[],this.filteredSessions=[],this.selectedIndex=-1,this.render();try{if(this.sessions=await this.client.getSessions(t,this.options.projectSource,i.signal),i.signal.aborted)return;this.filterSessions(),Promise.resolve((o=(n=this.options).onSessionsLoaded)==null?void 0:o.call(n,this.sessions))}catch(h){if(i.signal.aborted)return;const p=h instanceof Error?h:new Error(String(h));this.showError(p),(l=(a=this.options).onError)==null||l.call(a,p)}finally{this.loadController===i&&(this.loadController=null,this.showLoading(!1))}}showLoading(t){this.elements.loadingIndicator&&(this.elements.loadingIndicator.style.display=t?"flex":"none");const e=this.elements.container.querySelector(`.${this.options.classPrefix}__list`);e&&(e.style.display=t?"none":"block")}showError(t){if(this.elements.errorDisplay)if(this.currentError=t,t){this.elements.errorDisplay.replaceChildren();const e=document.createElement("div");if(e.textContent=t.message,this.elements.errorDisplay.appendChild(e),this.options.projectId){const i=document.createElement("button");i.className=`${this.options.classPrefix}__retry`,i.textContent=c._("Retry"),i.addEventListener("click",()=>{this.options.projectId&&this.loadSessions(this.options.projectId,this.options.projectSource)}),this.elements.errorDisplay.appendChild(i)}this.elements.errorDisplay.style.display="block"}else this.elements.errorDisplay.style.display="none"}filterSessions(){var i;const t=(((i=this.elements.searchInput)==null?void 0:i.value)??"").trim().toLowerCase(),e=t.replace(/[^a-z0-9]/g,"");this.filteredSessions=this.sessions.filter(s=>!t||[s.id,s.title,s.summary,s.firstPrompt,s.model,s.gitBranch].some(o=>o==null?void 0:o.toLowerCase().includes(t))?!0:e?(s.id??"").toLowerCase().replace(/[^a-z0-9]/g,"").includes(e):!1),this.filteredSessions.sort((s,n)=>this.compareSessions(s,n)),this.selectedIndex=-1,this.render()}normalizeSortMode(t){return t==="date_asc"?"date_asc":"date_desc"}sessionTime(t){if(!t.modifiedAt)return 0;const e=t.modifiedAt instanceof Date?t.modifiedAt:new Date(t.modifiedAt);return Number.isNaN(e.getTime())?0:e.getTime()}compareSessions(t,e){const i=this.sessionTime(t)-this.sessionTime(e);if(i!==0)return this.sortMode==="date_asc"?i:i*-1;const s=(t.firstPrompt??t.id??"").toLowerCase(),n=(e.firstPrompt??e.id??"").toLowerCase();return s.localeCompare(n)}renderSortOptions(){const t=this.elements.sortSelect;if(!t)return;t.replaceChildren(),[{value:"date_desc",label:c._("Newest")},{value:"date_asc",label:c._("Oldest")}].forEach(({value:i,label:s})=>{const n=document.createElement("option");n.value=i,n.textContent=s,t.appendChild(n)}),t.value=this.sortMode}render(){this.updateStats(),this.renderList()}updateStats(){const t=this.elements.container.querySelector(`.${this.options.classPrefix}__stats`);if(t)if(!this.options.projectId)t.textContent=c._("Select a project to view sessions");else if(this.isLoading)t.textContent=c._("Loading sessions...");else{const e=this.sessions.length,i=this.filteredSessions.length;i===e?t.textContent=c._("{count, plural, one {# session} other {# sessions}}",{count:e}):t.textContent=c._("Showing {showing} of {total} sessions",{showing:i,total:e})}}renderList(){var i,s;const t=this.elements.container.querySelector("ul");if(!t)return;if(t.replaceChildren(),this.itemElements.clear(),this.elements.container.querySelectorAll(`.${this.options.classPrefix}__empty`).forEach(n=>n.remove()),!this.options.projectId){const n=document.createElement("div");n.className=`${this.options.classPrefix}__empty`,n.textContent=c._("Select a project to view its sessions"),(i=t.parentElement)==null||i.appendChild(n);return}if(this.filteredSessions.length===0){const n=document.createElement("div");n.className=`${this.options.classPrefix}__empty`,n.textContent=this.sessions.length===0?c._("No sessions found for this project"):c._("No sessions match your search"),(s=t.parentElement)==null||s.appendChild(n);return}for(let n=0;n<this.filteredSessions.length;n++){const o=this.filteredSessions[n],a=this.renderSessionItem(o,n);t.appendChild(a),this.itemElements.set(this.sessionKey(o,n),a)}}renderSessionItem(t,e){if(this.options.sessionRenderer)return this.options.sessionRenderer(t,e);const{classPrefix:i,showEntryCount:s,showModel:n}=this.options,o=document.createElement("li");o.className=`${i}__item`,o.setAttribute("role","option"),o.setAttribute("aria-selected","false"),o.dataset.index=String(e),o.dataset.sessionId=t.id,o.title=t.id??"";const a=t.source??"claude",l=(t.chunkCount??0)>1,h=t.firstPrompt?t.firstPrompt.slice(0,le)+(t.firstPrompt.length>le?"...":""):t.id??c._("Unknown Session"),p=[];if(p.push(`<span class="${i}__meta-item">${Pi(t.modifiedAt)}</span>`),s&&t.entryCount!==void 0){const u=c._("{count, plural, one {msg} other {msgs}}",{count:t.entryCount});p.push(`<span class="${i}__meta-item">${$i(t.entryCount)} ${u}</span>`)}if(n&&t.model){const u=t.model.replace(/^(claude-|gpt-|gemini-)/,"");p.push(`<span class="${i}__meta-item">${u}</span>`)}return a!=="claude"&&p.push(`<span class="${i}__badge ${i}__badge--${a}">${a}</span>`),l&&p.push(`<span class="${i}__badge ${i}__badge--chunked">${c._("chunked")}</span>`),o.innerHTML=`
      <div class="${i}__title">${this.escapeHtml(h)}</div>
      ${t.summary?`<div class="${i}__summary">${this.escapeHtml(t.summary)}</div>`:""}
      <div class="${i}__meta">${p.join("")}</div>
    `,o.addEventListener("click",()=>{this.selectIndex(e),this.selectSession(t)}),o}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}sessionKey(t,e){return t.id??`session-${e}`}selectIndex(t){if(this.selectedIndex>=0){const e=this.filteredSessions[this.selectedIndex],i=e?this.itemElements.get(this.sessionKey(e,this.selectedIndex)):void 0;i&&(i.classList.remove(`${this.options.classPrefix}__item--selected`),i.setAttribute("aria-selected","false"))}if(this.selectedIndex=t,t>=0){const e=this.filteredSessions[t],i=e?this.itemElements.get(this.sessionKey(e,t)):void 0;i&&(i.classList.add(`${this.options.classPrefix}__item--selected`),i.setAttribute("aria-selected","true"),i.scrollIntoView({block:"nearest",behavior:"smooth"}))}}selectSession(t){const e=this.options.onSessionSelect;if(e)try{e(t)}catch(i){console.error("Session selection handler error:",i)}}getSessions(){return[...this.sessions]}getFilteredSessions(){return[...this.filteredSessions]}getSelectedSession(){return this.selectedIndex>=0?this.filteredSessions[this.selectedIndex]??null:null}selectSessionById(t){const e=this.filteredSessions.findIndex(i=>i.id===t);e>=0&&this.selectIndex(e)}refresh(){return this.options.projectId?this.loadSessions(this.options.projectId,this.options.projectSource):Promise.resolve()}setSearch(t){this.elements.searchInput&&(this.elements.searchInput.value=t,this.filterSessions())}setSort(t){const e=this.normalizeSortMode(t);this.sortMode!==e&&(this.sortMode=e,this.elements.sortSelect&&(this.elements.sortSelect.value=e),this.filterSessions())}setProjectId(t,e){return this.loadSessions(t,e)}focusSearch(){var t;(t=this.elements.searchInput)==null||t.focus()}refreshI18n(){this.elements.searchInput&&(this.elements.searchInput.placeholder=c._("Filter sessions...")),this.renderSortOptions(),this.elements.loadingIndicator&&(this.elements.loadingIndicator.textContent=c._("Loading sessions...")),this.updateStats(),this.renderList(),this.currentError&&this.showError(this.currentError)}dispose(){var t;this.disposed||(this.abortController.abort(),(t=this.loadController)==null||t.abort(),this.itemElements.clear(),this.sessions=[],this.filteredSessions=[],this.elements.container.replaceChildren(),this.disposed=!0)}}const Ai='.thinkt-conversation-view{height:100%;display:flex;flex-direction:column;font-family:var(--thinkt-font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif);font-size:13px;line-height:1.6;color:var(--thinkt-text-color, #e0e0e0);background:var(--thinkt-bg-color, #0a0a0a)}.thinkt-conversation-view__filters{display:flex;align-items:center;gap:8px;padding:10px 16px;border-bottom:1px solid var(--thinkt-border-color, #2a2a2a);background:#ffffff05;overflow-x:auto;flex-shrink:0}.thinkt-conversation-view__filter-label{font-size:11px;color:var(--thinkt-muted-color, #666);margin-right:4px;white-space:nowrap}.thinkt-conversation-view__session-context{display:inline-flex;align-items:center;gap:6px;margin-right:2px}.thinkt-conversation-view__session-badge{display:inline-flex;align-items:center;max-width:260px;padding:2px 8px;border:1px solid transparent;border-radius:999px;font-size:10px;font-weight:600;letter-spacing:.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.thinkt-conversation-view__session-badge--model{background:#ffffff08;border-color:var(--thinkt-border-color, #333);color:var(--thinkt-text-color, #d5d7db);font-family:var(--thinkt-font-mono, "SF Mono", Monaco, "Cascadia Code", monospace);font-weight:500}.thinkt-conversation-view__session-badge--source-claude{color:var(--thinkt-source-claude-color, #d97750);border-color:var(--thinkt-source-claude-border, rgba(217, 119, 80, .4));background:var(--thinkt-source-claude-bg, rgba(217, 119, 80, .15))}.thinkt-conversation-view__session-badge--source-kimi{color:var(--thinkt-source-kimi-color, #19c39b);border-color:#19c39b66;background:var(--thinkt-source-kimi-bg, rgba(25, 195, 155, .15))}.thinkt-conversation-view__session-badge--source-gemini{color:var(--thinkt-source-gemini-color, #6366f1);border-color:#6366f166;background:var(--thinkt-source-gemini-bg, rgba(99, 102, 241, .15))}.thinkt-conversation-view__session-badge--source-copilot{color:#60a5fa;border-color:#60a5fa66;background:#60a5fa26}.thinkt-conversation-view__session-badge--source-codex{color:#22d3ee;border-color:#22d3ee66;background:#22d3ee24}.thinkt-conversation-view__session-badge--source-qwen{color:#f59e0b;border-color:#f59e0b66;background:#f59e0b26}.thinkt-conversation-view__session-badge--source-thinkt{color:#a855f7;border-color:#a855f766;background:#a855f726}.thinkt-conversation-view__session-badge--source-other{color:var(--thinkt-text-color, #e0e0e0);border-color:var(--thinkt-border-color, #333);background:#ffffff0a}.thinkt-conversation-view__filter-btn{display:flex;align-items:center;gap:4px;padding:4px 10px;border:1px solid var(--thinkt-border-color, #333);border-radius:4px;background:#ffffff08;color:var(--thinkt-muted-color, #888);font-size:11px;cursor:pointer;transition:all .15s ease;white-space:nowrap}.thinkt-conversation-view__filter-btn:hover{border-color:var(--thinkt-border-color-light, rgba(255, 255, 255, .12));color:var(--thinkt-text-color, #e0e0e0)}.thinkt-conversation-view__filter-btn.active{background:#6366f126;border-color:#6366f166;color:#6366f1}.thinkt-conversation-view__filter-btn.active[data-filter=assistant]{background:var(--thinkt-source-claude-bg, rgba(217, 119, 80, .15));border-color:var(--thinkt-source-claude-border, rgba(217, 119, 80, .4));color:var(--thinkt-source-claude-color, #d97750)}.thinkt-conversation-view__filter-btn.active[data-filter=thinking]{background:#6366f126;border-color:#6366f166;color:#6366f1}.thinkt-conversation-view__filter-btn.active[data-filter=tool],.thinkt-conversation-view__filter-btn.active[data-filter=toolUse]{background:var(--thinkt-source-kimi-bg, rgba(25, 195, 155, .15));border-color:#19c39b66;color:var(--thinkt-source-kimi-color, #19c39b)}.thinkt-conversation-view__filter-btn.active[data-filter=toolResult]{background:#22c55e26;border-color:#22c55e66;color:#22c55e}.thinkt-conversation-view__filter-btn.active[data-filter=media]{background:#60a5fa26;border-color:#60a5fa66;color:#93c5fd}.thinkt-conversation-view__filter-btn.active[data-filter=system]{background:#f871712e;border-color:#f8717173;color:#fca5a5}.thinkt-conversation-view__content{flex:1;overflow-y:auto;padding:16px}.thinkt-conversation-entry{margin-bottom:16px;border-radius:8px;border:1px solid var(--thinkt-border-color, #2a2a2a);background:var(--thinkt-bg-secondary, #141414);overflow:hidden}.thinkt-conversation-entry.hidden{display:none}.thinkt-conversation-entry--highlighted{animation:thinkt-highlight-pulse 2s ease}@keyframes thinkt-highlight-pulse{0%,to{border-color:var(--thinkt-border-color, #2a2a2a);box-shadow:none}20%,80%{border-color:var(--thinkt-accent-color, #6366f1);box-shadow:0 0 0 2px #6366f14d}}.thinkt-conversation-entry__header{display:flex;align-items:center;gap:8px;padding:8px 12px;background:#ffffff08;border-bottom:1px solid var(--thinkt-border-color, #2a2a2a)}.thinkt-conversation-entry__role{font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:.5px}.thinkt-conversation-entry__role--user{color:#6366f1}.thinkt-conversation-entry__role--assistant{color:var(--thinkt-source-claude-color, #d97750)}.thinkt-conversation-entry__role--system{color:#888}.thinkt-conversation-entry__role--tool{color:var(--thinkt-source-kimi-color, #19c39b)}.thinkt-conversation-entry__timestamp{margin-left:auto;font-size:11px;color:var(--thinkt-muted-color, #666)}.thinkt-conversation-entry__content{padding:12px}.thinkt-conversation-entry__text{white-space:pre-wrap;word-break:break-word;position:relative}.thinkt-conversation-entry__text--markdown{white-space:normal}.thinkt-conversation-entry__text--markdown h1,.thinkt-conversation-entry__text--markdown h2,.thinkt-conversation-entry__text--markdown h3,.thinkt-conversation-entry__text--markdown h4,.thinkt-conversation-entry__text--markdown h5,.thinkt-conversation-entry__text--markdown h6{margin:1em 0 .5em;line-height:1.3;color:var(--thinkt-text-color, #e0e0e0)}.thinkt-conversation-entry__text--markdown h1:first-child,.thinkt-conversation-entry__text--markdown h2:first-child,.thinkt-conversation-entry__text--markdown h3:first-child{margin-top:0}.thinkt-conversation-entry__text--markdown h1{font-size:1.4em}.thinkt-conversation-entry__text--markdown h2{font-size:1.2em}.thinkt-conversation-entry__text--markdown h3{font-size:1.1em}.thinkt-conversation-entry__text--markdown p{margin:.5em 0}.thinkt-conversation-entry__text--markdown p:first-child{margin-top:0}.thinkt-conversation-entry__text--markdown p:last-child{margin-bottom:0}.thinkt-conversation-entry__text--markdown ul,.thinkt-conversation-entry__text--markdown ol{margin:.5em 0;padding-left:1.5em}.thinkt-conversation-entry__text--markdown li{margin:.2em 0}.thinkt-conversation-entry__text--markdown blockquote{margin:.5em 0;padding:.5em 1em;border-left:3px solid var(--thinkt-border-color, #444);color:var(--thinkt-muted-color, #aaa);background:#ffffff05}.thinkt-conversation-entry__text--markdown a{color:#6366f1;text-decoration:none}.thinkt-conversation-entry__text--markdown a:hover{text-decoration:underline}.thinkt-conversation-entry__text--markdown code{font-family:var(--thinkt-font-mono, "SF Mono", Monaco, "Cascadia Code", monospace);font-size:.9em;padding:.15em .4em;background:#ffffff14;border-radius:3px}.thinkt-conversation-entry__text--markdown table{border-collapse:collapse;margin:.5em 0;width:100%}.thinkt-conversation-entry__text--markdown th,.thinkt-conversation-entry__text--markdown td{border:1px solid var(--thinkt-border-color, #333);padding:6px 10px;text-align:left}.thinkt-conversation-entry__text--markdown th{background:#ffffff0d;font-weight:600}.thinkt-conversation-entry__text--markdown hr{border:none;border-top:1px solid var(--thinkt-border-color, #333);margin:1em 0}.thinkt-conversation-entry__text--markdown img{max-width:100%}.thinkt-code-block{margin:.5em 0;border-radius:6px;border:1px solid var(--thinkt-border-color, #2a2a2a);overflow:hidden}.thinkt-code-block__header{display:flex;align-items:center;justify-content:space-between;padding:4px 10px;background:#ffffff0d;border-bottom:1px solid var(--thinkt-border-color, #2a2a2a);font-size:11px}.thinkt-code-block__lang{color:var(--thinkt-muted-color, #888);text-transform:lowercase}.thinkt-code-block pre{margin:0;padding:10px 12px;background:#0000004d;overflow-x:auto;font-family:var(--thinkt-font-mono, "SF Mono", Monaco, "Cascadia Code", monospace);font-size:12px;line-height:1.5}.thinkt-code-block pre code{padding:0;background:none;border-radius:0;font-size:inherit}.thinkt-standalone-block{margin-bottom:8px}.thinkt-standalone-block.hidden{display:none}.thinkt-standalone-block>.thinkt-thinking-block,.thinkt-standalone-block>.thinkt-tool-call,.thinkt-standalone-block>.thinkt-conversation-entry__tool-result,.thinkt-standalone-block>.thinkt-media-block{margin-top:0}.thinkt-media-block{margin-top:8px;border-radius:4px;overflow:hidden;border-left:3px solid #60a5fa;background:#60a5fa14}.thinkt-media-block--document{border-left-color:#a78bfa;background:#a78bfa14}.thinkt-media-block__header{display:flex;align-items:center;gap:8px;padding:8px 12px;font-size:11px;border-bottom:1px solid rgba(255,255,255,.08)}.thinkt-media-block__label{font-weight:600;color:#93c5fd}.thinkt-media-block--document .thinkt-media-block__label{color:#c4b5fd}.thinkt-media-block__type{margin-left:auto;color:var(--thinkt-muted-color, #999);font-family:var(--thinkt-font-mono, "SF Mono", Monaco, "Cascadia Code", monospace);font-size:10px}.thinkt-media-block__content{padding:10px 12px}.thinkt-media-block__image{display:block;max-width:100%;max-height:460px;border-radius:6px;border:1px solid var(--thinkt-border-color, #2a2a2a);background:#0000004d}.thinkt-media-block__filename{margin-bottom:8px;color:var(--thinkt-text-color, #e0e0e0);word-break:break-word}.thinkt-media-block__link{display:inline-block;padding:5px 10px;border-radius:4px;border:1px solid rgba(167,139,250,.45);color:#c4b5fd;text-decoration:none;font-size:11px;background:#a78bfa1f}.thinkt-media-block__link:hover{background:#a78bfa33}.thinkt-media-block__empty{color:var(--thinkt-muted-color, #999);font-size:12px}.thinkt-thinking-block{margin-top:12px;border-radius:4px;background:#6366f114;border-left:3px solid #6366f1;overflow:hidden}.thinkt-thinking-block.hidden{display:none}.thinkt-thinking-block__header{display:flex;align-items:center;gap:8px;padding:8px 12px;cursor:pointer;-webkit-user-select:none;user-select:none;transition:background .12s ease}.thinkt-thinking-block__header:hover{background:#6366f10f}.thinkt-thinking-block__toggle{font-size:10px;color:#6366f1;transition:transform .15s ease;flex-shrink:0}.thinkt-thinking-block.expanded .thinkt-thinking-block__toggle{transform:rotate(90deg)}.thinkt-thinking-block__label{font-size:11px;font-weight:600;color:#6366f1;flex-shrink:0}.thinkt-thinking-block__duration{font-size:10px;color:#a5a6f3;flex-shrink:0}.thinkt-thinking-block__preview{font-size:11px;color:#a5a6f3;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-style:italic;flex:1;min-width:0}.thinkt-thinking-block__content{display:none;padding:8px 12px;font-style:italic;color:#a5a6f3;white-space:pre-wrap;word-break:break-word;border-top:1px solid rgba(99,102,241,.15);max-height:400px;overflow-y:auto}.thinkt-thinking-block.expanded .thinkt-thinking-block__content{display:block}.thinkt-tool-call{margin-top:8px;border-radius:4px;background:#19c39b0f;border-left:3px solid #19c39b;overflow:hidden}.thinkt-tool-call.hidden{display:none}.thinkt-tool-call__summary{display:flex;align-items:center;gap:6px;padding:6px 12px;cursor:pointer;-webkit-user-select:none;user-select:none;font-size:12px;transition:background .12s ease}.thinkt-tool-call__summary:hover{background:#19c39b0f}.thinkt-tool-call__toggle{font-size:10px;color:#19c39b;transition:transform .15s ease;flex-shrink:0}.thinkt-tool-call.expanded .thinkt-tool-call__toggle{transform:rotate(90deg)}.thinkt-tool-call__bullet{color:var(--thinkt-muted-color, #666)}.thinkt-tool-call__name{font-weight:600;color:#19c39b}.thinkt-tool-call__arg{color:var(--thinkt-muted-color, #999);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0;font-family:var(--thinkt-font-mono, "SF Mono", Monaco, "Cascadia Code", monospace);font-size:11px}.thinkt-tool-call__status{margin-left:auto;flex-shrink:0;font-size:12px}.thinkt-tool-call__status--ok{color:#22c55e}.thinkt-tool-call__status--error{color:#ef4444}.thinkt-tool-call__status--pending{color:var(--thinkt-muted-color, #666)}.thinkt-tool-call__duration{font-size:10px;color:var(--thinkt-muted-color, #666);flex-shrink:0}.thinkt-tool-call__detail{display:none;border-top:1px solid rgba(25,195,155,.15)}.thinkt-tool-call.expanded .thinkt-tool-call__detail{display:block}.thinkt-tool-call__detail-section{padding:8px 12px}.thinkt-tool-call__detail-label{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;color:var(--thinkt-muted-color, #888)}.thinkt-tool-call__detail-content{font-family:var(--thinkt-font-mono, "SF Mono", Monaco, "Cascadia Code", monospace);font-size:11px;background:#0000004d;padding:8px;border-radius:4px;overflow-x:auto;max-height:300px;overflow-y:auto;white-space:pre-wrap;word-break:break-word;position:relative}.thinkt-tool-call__detail-result{margin-top:4px;padding-top:8px;border-top:1px solid rgba(25,195,155,.1)}.thinkt-tool-call__detail-result--error .thinkt-tool-call__detail-label{color:#ef4444}.thinkt-conversation-entry__tool-result{margin-top:12px;padding:10px 12px;background:#22c55e1a;border-left:3px solid #22c55e;border-radius:0 4px 4px 0}.thinkt-conversation-entry__tool-result.hidden{display:none}.thinkt-conversation-entry__tool-result-label{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;color:#22c55e}.thinkt-conversation-entry__tool-result--error{background:#ef44441a;border-left-color:#ef4444}.thinkt-conversation-entry__tool-result--error .thinkt-conversation-entry__tool-result-label{color:#ef4444}.thinkt-copy-btn{display:flex;align-items:center;gap:4px;padding:3px 8px;border:1px solid var(--thinkt-border-color, #333);border-radius:4px;background:#ffffff0d;color:var(--thinkt-muted-color, #888);font-size:11px;cursor:pointer;transition:all .15s ease}.thinkt-copy-btn:hover{background:#ffffff1a;color:var(--thinkt-text-color, #e0e0e0)}.thinkt-copy-btn--float{position:absolute;top:0;right:0;opacity:0;transition:opacity .15s ease}.thinkt-conversation-entry__text:hover .thinkt-copy-btn--float,.thinkt-tool-call__detail-content:hover .thinkt-copy-btn--float{opacity:1}.thinkt-conversation-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:var(--thinkt-muted-color, #666);text-align:center;padding:48px}.thinkt-conversation-empty__icon{font-size:40px;margin-bottom:12px;opacity:.4}.thinkt-conversation-empty__title{font-size:16px;font-weight:500;margin-bottom:6px;color:var(--thinkt-text-color, #e0e0e0)}.thinkt-conversation-empty--filtered{min-height:220px;border:1px dashed var(--thinkt-border-color, #333);border-radius:8px;background:#ffffff05}.thinkt-conversation-view__toolbar{display:flex;align-items:center;gap:12px;padding:10px 16px;border-bottom:1px solid var(--thinkt-border-color, #2a2a2a);background:#ffffff05;flex-shrink:0}.thinkt-conversation-view__toolbar-path{flex:1;display:flex;align-items:center;gap:8px;min-width:0}.thinkt-conversation-view__toolbar-path-icon{font-size:14px;color:var(--thinkt-muted-color, #666);flex-shrink:0}.thinkt-conversation-view__toolbar-path-text{font-size:13px;color:var(--thinkt-text-color, #e0e0e0);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-family:var(--thinkt-font-mono, "SF Mono", Monaco, "Cascadia Code", monospace)}.thinkt-conversation-view__toolbar-right{display:flex;align-items:center;gap:10px;margin-left:auto}.thinkt-conversation-view__toolbar-metrics{display:flex;align-items:center;gap:8px;font-size:11px;color:var(--thinkt-muted-color, #888)}.thinkt-conversation-view__toolbar-actions{position:relative;flex-shrink:0;display:flex;flex-direction:row;align-items:center;gap:8px}.thinkt-conversation-view__toolbar-btn{display:flex;align-items:center;gap:6px;padding:6px 12px;background:#ffffff0d;border:1px solid var(--thinkt-border-color, #333);border-radius:6px;color:var(--thinkt-text-color, #e0e0e0);font-size:12px;cursor:pointer;transition:all .15s ease}.thinkt-conversation-view__toolbar-btn:hover{background:#ffffff14;border-color:var(--thinkt-border-color-light, rgba(255, 255, 255, .12))}.thinkt-conversation-view__toolbar-btn:disabled{opacity:.45;cursor:not-allowed}.thinkt-conversation-view__toolbar-dropdown{position:absolute;top:100%;right:0;margin-top:4px;min-width:160px;background:var(--thinkt-dropdown-bg, #1a1a1a);border:1px solid var(--thinkt-border-color, #333);border-radius:6px;box-shadow:0 4px 12px #00000080;z-index:1000;display:none;overflow:hidden}.thinkt-conversation-view__toolbar-dropdown.open{display:block}.thinkt-conversation-view__toolbar-dropdown-item{display:flex;align-items:center;gap:10px;padding:10px 14px;font-size:13px;color:var(--thinkt-text-color, #e0e0e0);cursor:pointer;transition:background .12s ease;border-bottom:1px solid rgba(255,255,255,.03)}.thinkt-conversation-view__toolbar-dropdown-item:last-child{border-bottom:none}.thinkt-conversation-view__toolbar-dropdown-item:hover{background:#ffffff0d}.thinkt-conversation-view__export{position:relative;margin-left:auto;flex-shrink:0}.thinkt-conversation-view__export-btn{display:flex;align-items:center;gap:6px;padding:4px 10px;background:#ffffff08;border:1px solid var(--thinkt-border-color, #333);border-radius:4px;color:var(--thinkt-muted-color, #888);font-size:11px;cursor:pointer;transition:all .15s ease;white-space:nowrap}.thinkt-conversation-view__export-btn:hover{background:#ffffff14;border-color:var(--thinkt-border-color-light, rgba(255, 255, 255, .12));color:var(--thinkt-text-color, #e0e0e0)}.thinkt-conversation-view__export-btn:disabled{opacity:.5;cursor:not-allowed}.thinkt-conversation-view__export-dropdown{position:fixed;min-width:140px;background:var(--thinkt-dropdown-bg, #1a1a1a);border:1px solid var(--thinkt-border-color, #333);border-radius:6px;box-shadow:0 4px 12px #00000080;z-index:10000;display:none;overflow:hidden}.thinkt-conversation-view__export-dropdown.open{display:block}.thinkt-conversation-view__export-dropdown-item{display:flex;align-items:center;gap:8px;padding:8px 12px;font-size:12px;color:var(--thinkt-text-color, #e0e0e0);cursor:pointer;transition:background .12s ease;border-bottom:1px solid rgba(255,255,255,.03)}.thinkt-conversation-view__export-dropdown-item:last-child{border-bottom:none}.thinkt-conversation-view__export-dropdown-item:hover{background:#ffffff0d}';function Lt(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Z=Lt();function ze(r){Z=r}var it={exec:()=>null};function _(r,t=""){let e=typeof r=="string"?r:r.source,i={replace:(s,n)=>{let o=typeof n=="string"?n:n.source;return o=o.replace(L.caret,"$1"),e=e.replace(s,o),i},getRegex:()=>new RegExp(e,t)};return i}var Li=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),L={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:r=>new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}#`),htmlBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}<(?:[a-z].*>|!--)`,"i")},Ii=/^(?:[ \t]*(?:\n|$))+/,Ri=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,zi=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,nt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Mi=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,It=/(?:[*+-]|\d{1,9}[.)])/,Me=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,De=_(Me).replace(/bull/g,It).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Di=_(Me).replace(/bull/g,It).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Rt=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Ni=/^[^\n]+/,zt=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Bi=_(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",zt).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Hi=_(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,It).getRegex(),ft="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Mt=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Fi=_("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Mt).replace("tag",ft).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Ne=_(Rt).replace("hr",nt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ft).getRegex(),Ui=_(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Ne).getRegex(),Dt={blockquote:Ui,code:Ri,def:Bi,fences:zi,heading:Mi,hr:nt,html:Fi,lheading:De,list:Hi,newline:Ii,paragraph:Ne,table:it,text:Ni},ce=_("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",nt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ft).getRegex(),Oi={...Dt,lheading:Di,table:ce,paragraph:_(Rt).replace("hr",nt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",ce).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ft).getRegex()},Vi={...Dt,html:_(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Mt).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:it,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:_(Rt).replace("hr",nt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",De).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},qi=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Wi=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Be=/^( {2,}|\\)\n(?!\s*$)/,Ki=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,kt=/[\p{P}\p{S}]/u,Nt=/[\s\p{P}\p{S}]/u,He=/[^\s\p{P}\p{S}]/u,Zi=_(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Nt).getRegex(),Fe=/(?!~)[\p{P}\p{S}]/u,Xi=/(?!~)[\s\p{P}\p{S}]/u,Yi=/(?:[^\s\p{P}\p{S}]|~)/u,Qi=_(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",Li?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),Ue=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Gi=_(Ue,"u").replace(/punct/g,kt).getRegex(),Ji=_(Ue,"u").replace(/punct/g,Fe).getRegex(),Oe="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",ts=_(Oe,"gu").replace(/notPunctSpace/g,He).replace(/punctSpace/g,Nt).replace(/punct/g,kt).getRegex(),es=_(Oe,"gu").replace(/notPunctSpace/g,Yi).replace(/punctSpace/g,Xi).replace(/punct/g,Fe).getRegex(),is=_("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,He).replace(/punctSpace/g,Nt).replace(/punct/g,kt).getRegex(),ss=_(/\\(punct)/,"gu").replace(/punct/g,kt).getRegex(),ns=_(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),rs=_(Mt).replace("(?:-->|$)","-->").getRegex(),os=_("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",rs).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),pt=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,as=_(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",pt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ve=_(/^!?\[(label)\]\[(ref)\]/).replace("label",pt).replace("ref",zt).getRegex(),qe=_(/^!?\[(ref)\](?:\[\])?/).replace("ref",zt).getRegex(),ls=_("reflink|nolink(?!\\()","g").replace("reflink",Ve).replace("nolink",qe).getRegex(),he=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Bt={_backpedal:it,anyPunctuation:ss,autolink:ns,blockSkip:Qi,br:Be,code:Wi,del:it,emStrongLDelim:Gi,emStrongRDelimAst:ts,emStrongRDelimUnd:is,escape:qi,link:as,nolink:qe,punctuation:Zi,reflink:Ve,reflinkSearch:ls,tag:os,text:Ki,url:it},cs={...Bt,link:_(/^!?\[(label)\]\((.*?)\)/).replace("label",pt).getRegex(),reflink:_(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",pt).getRegex()},yt={...Bt,emStrongRDelimAst:es,emStrongLDelim:Ji,url:_(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",he).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:_(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",he).getRegex()},hs={...yt,br:_(Be).replace("{2,}","*").getRegex(),text:_(yt.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ot={normal:Dt,gfm:Oi,pedantic:Vi},G={normal:Bt,gfm:yt,breaks:hs,pedantic:cs},ds={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},de=r=>ds[r];function H(r,t){if(t){if(L.escapeTest.test(r))return r.replace(L.escapeReplace,de)}else if(L.escapeTestNoEncode.test(r))return r.replace(L.escapeReplaceNoEncode,de);return r}function pe(r){try{r=encodeURI(r).replace(L.percentDecode,"%")}catch{return null}return r}function ue(r,t){var n;let e=r.replace(L.findPipe,(o,a,l)=>{let h=!1,p=a;for(;--p>=0&&l[p]==="\\";)h=!h;return h?"|":" |"}),i=e.split(L.splitPipe),s=0;if(i[0].trim()||i.shift(),i.length>0&&!((n=i.at(-1))!=null&&n.trim())&&i.pop(),t)if(i.length>t)i.splice(t);else for(;i.length<t;)i.push("");for(;s<i.length;s++)i[s]=i[s].trim().replace(L.slashPipe,"|");return i}function J(r,t,e){let i=r.length;if(i===0)return"";let s=0;for(;s<i&&r.charAt(i-s-1)===t;)s++;return r.slice(0,i-s)}function ps(r,t){if(r.indexOf(t[1])===-1)return-1;let e=0;for(let i=0;i<r.length;i++)if(r[i]==="\\")i++;else if(r[i]===t[0])e++;else if(r[i]===t[1]&&(e--,e<0))return i;return e>0?-2:-1}function me(r,t,e,i,s){let n=t.href,o=t.title||null,a=r[1].replace(s.other.outputLinkReplace,"$1");i.state.inLink=!0;let l={type:r[0].charAt(0)==="!"?"image":"link",raw:e,href:n,title:o,text:a,tokens:i.inlineTokens(a)};return i.state.inLink=!1,l}function us(r,t,e){let i=r.match(e.other.indentCodeCompensation);if(i===null)return t;let s=i[1];return t.split(`
`).map(n=>{let o=n.match(e.other.beginningSpace);if(o===null)return n;let[a]=o;return a.length>=s.length?n.slice(s.length):n}).join(`
`)}var ut=class{constructor(r){d(this,"options");d(this,"rules");d(this,"lexer");this.options=r||Z}space(r){let t=this.rules.block.newline.exec(r);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(r){let t=this.rules.block.code.exec(r);if(t){let e=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:J(e,`
`)}}}fences(r){let t=this.rules.block.fences.exec(r);if(t){let e=t[0],i=us(e,t[3]||"",this.rules);return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:i}}}heading(r){let t=this.rules.block.heading.exec(r);if(t){let e=t[2].trim();if(this.rules.other.endingHash.test(e)){let i=J(e,"#");(this.options.pedantic||!i||this.rules.other.endingSpaceChar.test(i))&&(e=i.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(r){let t=this.rules.block.hr.exec(r);if(t)return{type:"hr",raw:J(t[0],`
`)}}blockquote(r){let t=this.rules.block.blockquote.exec(r);if(t){let e=J(t[0],`
`).split(`
`),i="",s="",n=[];for(;e.length>0;){let o=!1,a=[],l;for(l=0;l<e.length;l++)if(this.rules.other.blockquoteStart.test(e[l]))a.push(e[l]),o=!0;else if(!o)a.push(e[l]);else break;e=e.slice(l);let h=a.join(`
`),p=h.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");i=i?`${i}
${h}`:h,s=s?`${s}
${p}`:p;let u=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(p,n,!0),this.lexer.state.top=u,e.length===0)break;let g=n.at(-1);if((g==null?void 0:g.type)==="code")break;if((g==null?void 0:g.type)==="blockquote"){let m=g,b=m.raw+`
`+e.join(`
`),f=this.blockquote(b);n[n.length-1]=f,i=i.substring(0,i.length-m.raw.length)+f.raw,s=s.substring(0,s.length-m.text.length)+f.text;break}else if((g==null?void 0:g.type)==="list"){let m=g,b=m.raw+`
`+e.join(`
`),f=this.list(b);n[n.length-1]=f,i=i.substring(0,i.length-g.raw.length)+f.raw,s=s.substring(0,s.length-m.raw.length)+f.raw,e=b.substring(n.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:i,tokens:n,text:s}}}list(r){var e,i;let t=this.rules.block.list.exec(r);if(t){let s=t[1].trim(),n=s.length>1,o={type:"list",raw:"",ordered:n,start:n?+s.slice(0,-1):"",loose:!1,items:[]};s=n?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=n?s:"[*+-]");let a=this.rules.other.listItemRegex(s),l=!1;for(;r;){let p=!1,u="",g="";if(!(t=a.exec(r))||this.rules.block.hr.test(r))break;u=t[0],r=r.substring(u.length);let m=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,x=>" ".repeat(3*x.length)),b=r.split(`
`,1)[0],f=!m.trim(),v=0;if(this.options.pedantic?(v=2,g=m.trimStart()):f?v=t[1].length+1:(v=t[2].search(this.rules.other.nonSpaceChar),v=v>4?1:v,g=m.slice(v),v+=t[1].length),f&&this.rules.other.blankLine.test(b)&&(u+=b+`
`,r=r.substring(b.length+1),p=!0),!p){let x=this.rules.other.nextBulletRegex(v),k=this.rules.other.hrRegex(v),y=this.rules.other.fencesBeginRegex(v),S=this.rules.other.headingBeginRegex(v),$=this.rules.other.htmlBeginRegex(v);for(;r;){let T=r.split(`
`,1)[0],R;if(b=T,this.options.pedantic?(b=b.replace(this.rules.other.listReplaceNesting,"  "),R=b):R=b.replace(this.rules.other.tabCharGlobal,"    "),y.test(b)||S.test(b)||$.test(b)||x.test(b)||k.test(b))break;if(R.search(this.rules.other.nonSpaceChar)>=v||!b.trim())g+=`
`+R.slice(v);else{if(f||m.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||y.test(m)||S.test(m)||k.test(m))break;g+=`
`+b}!f&&!b.trim()&&(f=!0),u+=T+`
`,r=r.substring(T.length+1),m=R.slice(v)}}o.loose||(l?o.loose=!0:this.rules.other.doubleBlankLine.test(u)&&(l=!0)),o.items.push({type:"list_item",raw:u,task:!!this.options.gfm&&this.rules.other.listIsTask.test(g),loose:!1,text:g,tokens:[]}),o.raw+=u}let h=o.items.at(-1);if(h)h.raw=h.raw.trimEnd(),h.text=h.text.trimEnd();else return;o.raw=o.raw.trimEnd();for(let p of o.items){if(this.lexer.state.top=!1,p.tokens=this.lexer.blockTokens(p.text,[]),p.task){if(p.text=p.text.replace(this.rules.other.listReplaceTask,""),((e=p.tokens[0])==null?void 0:e.type)==="text"||((i=p.tokens[0])==null?void 0:i.type)==="paragraph"){p.tokens[0].raw=p.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),p.tokens[0].text=p.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let g=this.lexer.inlineQueue.length-1;g>=0;g--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[g].src)){this.lexer.inlineQueue[g].src=this.lexer.inlineQueue[g].src.replace(this.rules.other.listReplaceTask,"");break}}let u=this.rules.other.listTaskCheckbox.exec(p.raw);if(u){let g={type:"checkbox",raw:u[0]+" ",checked:u[0]!=="[ ]"};p.checked=g.checked,o.loose?p.tokens[0]&&["paragraph","text"].includes(p.tokens[0].type)&&"tokens"in p.tokens[0]&&p.tokens[0].tokens?(p.tokens[0].raw=g.raw+p.tokens[0].raw,p.tokens[0].text=g.raw+p.tokens[0].text,p.tokens[0].tokens.unshift(g)):p.tokens.unshift({type:"paragraph",raw:g.raw,text:g.raw,tokens:[g]}):p.tokens.unshift(g)}}if(!o.loose){let u=p.tokens.filter(m=>m.type==="space"),g=u.length>0&&u.some(m=>this.rules.other.anyLine.test(m.raw));o.loose=g}}if(o.loose)for(let p of o.items){p.loose=!0;for(let u of p.tokens)u.type==="text"&&(u.type="paragraph")}return o}}html(r){let t=this.rules.block.html.exec(r);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(r){let t=this.rules.block.def.exec(r);if(t){let e=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),i=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:i,title:s}}}table(r){var o;let t=this.rules.block.table.exec(r);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let e=ue(t[1]),i=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=(o=t[3])!=null&&o.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],n={type:"table",raw:t[0],header:[],align:[],rows:[]};if(e.length===i.length){for(let a of i)this.rules.other.tableAlignRight.test(a)?n.align.push("right"):this.rules.other.tableAlignCenter.test(a)?n.align.push("center"):this.rules.other.tableAlignLeft.test(a)?n.align.push("left"):n.align.push(null);for(let a=0;a<e.length;a++)n.header.push({text:e[a],tokens:this.lexer.inline(e[a]),header:!0,align:n.align[a]});for(let a of s)n.rows.push(ue(a,n.header.length).map((l,h)=>({text:l,tokens:this.lexer.inline(l),header:!1,align:n.align[h]})));return n}}lheading(r){let t=this.rules.block.lheading.exec(r);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(r){let t=this.rules.block.paragraph.exec(r);if(t){let e=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(r){let t=this.rules.block.text.exec(r);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(r){let t=this.rules.inline.escape.exec(r);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(r){let t=this.rules.inline.tag.exec(r);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(r){let t=this.rules.inline.link.exec(r);if(t){let e=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(e)){if(!this.rules.other.endAngleBracket.test(e))return;let n=J(e.slice(0,-1),"\\");if((e.length-n.length)%2===0)return}else{let n=ps(t[2],"()");if(n===-2)return;if(n>-1){let o=(t[0].indexOf("!")===0?5:4)+t[1].length+n;t[2]=t[2].substring(0,n),t[0]=t[0].substring(0,o).trim(),t[3]=""}}let i=t[2],s="";if(this.options.pedantic){let n=this.rules.other.pedanticHrefTitle.exec(i);n&&(i=n[1],s=n[3])}else s=t[3]?t[3].slice(1,-1):"";return i=i.trim(),this.rules.other.startAngleBracket.test(i)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(e)?i=i.slice(1):i=i.slice(1,-1)),me(t,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(r,t){let e;if((e=this.rules.inline.reflink.exec(r))||(e=this.rules.inline.nolink.exec(r))){let i=(e[2]||e[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=t[i.toLowerCase()];if(!s){let n=e[0].charAt(0);return{type:"text",raw:n,text:n}}return me(e,s,e[0],this.lexer,this.rules)}}emStrong(r,t,e=""){let i=this.rules.inline.emStrongLDelim.exec(r);if(!(!i||i[3]&&e.match(this.rules.other.unicodeAlphaNumeric))&&(!(i[1]||i[2])||!e||this.rules.inline.punctuation.exec(e))){let s=[...i[0]].length-1,n,o,a=s,l=0,h=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(h.lastIndex=0,t=t.slice(-1*r.length+s);(i=h.exec(t))!=null;){if(n=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!n)continue;if(o=[...n].length,i[3]||i[4]){a+=o;continue}else if((i[5]||i[6])&&s%3&&!((s+o)%3)){l+=o;continue}if(a-=o,a>0)continue;o=Math.min(o,o+a+l);let p=[...i[0]][0].length,u=r.slice(0,s+i.index+p+o);if(Math.min(s,o)%2){let m=u.slice(1,-1);return{type:"em",raw:u,text:m,tokens:this.lexer.inlineTokens(m)}}let g=u.slice(2,-2);return{type:"strong",raw:u,text:g,tokens:this.lexer.inlineTokens(g)}}}}codespan(r){let t=this.rules.inline.code.exec(r);if(t){let e=t[2].replace(this.rules.other.newLineCharGlobal," "),i=this.rules.other.nonSpaceChar.test(e),s=this.rules.other.startingSpaceChar.test(e)&&this.rules.other.endingSpaceChar.test(e);return i&&s&&(e=e.substring(1,e.length-1)),{type:"codespan",raw:t[0],text:e}}}br(r){let t=this.rules.inline.br.exec(r);if(t)return{type:"br",raw:t[0]}}del(r){let t=this.rules.inline.del.exec(r);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(r){let t=this.rules.inline.autolink.exec(r);if(t){let e,i;return t[2]==="@"?(e=t[1],i="mailto:"+e):(e=t[1],i=e),{type:"link",raw:t[0],text:e,href:i,tokens:[{type:"text",raw:e,text:e}]}}}url(r){var e;let t;if(t=this.rules.inline.url.exec(r)){let i,s;if(t[2]==="@")i=t[0],s="mailto:"+i;else{let n;do n=t[0],t[0]=((e=this.rules.inline._backpedal.exec(t[0]))==null?void 0:e[0])??"";while(n!==t[0]);i=t[0],t[1]==="www."?s="http://"+t[0]:s=t[0]}return{type:"link",raw:t[0],text:i,href:s,tokens:[{type:"text",raw:i,text:i}]}}}inlineText(r){let t=this.rules.inline.text.exec(r);if(t){let e=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:e}}}},M=class _t{constructor(t){d(this,"tokens");d(this,"options");d(this,"state");d(this,"inlineQueue");d(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=t||Z,this.options.tokenizer=this.options.tokenizer||new ut,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let e={other:L,block:ot.normal,inline:G.normal};this.options.pedantic?(e.block=ot.pedantic,e.inline=G.pedantic):this.options.gfm&&(e.block=ot.gfm,this.options.breaks?e.inline=G.breaks:e.inline=G.gfm),this.tokenizer.rules=e}static get rules(){return{block:ot,inline:G}}static lex(t,e){return new _t(e).lex(t)}static lexInline(t,e){return new _t(e).inlineTokens(t)}lex(t){t=t.replace(L.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){let i=this.inlineQueue[e];this.inlineTokens(i.src,i.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,e=[],i=!1){var s,n,o;for(this.options.pedantic&&(t=t.replace(L.tabCharGlobal,"    ").replace(L.spaceLine,""));t;){let a;if((n=(s=this.options.extensions)==null?void 0:s.block)!=null&&n.some(h=>(a=h.call({lexer:this},t,e))?(t=t.substring(a.raw.length),e.push(a),!0):!1))continue;if(a=this.tokenizer.space(t)){t=t.substring(a.raw.length);let h=e.at(-1);a.raw.length===1&&h!==void 0?h.raw+=`
`:e.push(a);continue}if(a=this.tokenizer.code(t)){t=t.substring(a.raw.length);let h=e.at(-1);(h==null?void 0:h.type)==="paragraph"||(h==null?void 0:h.type)==="text"?(h.raw+=(h.raw.endsWith(`
`)?"":`
`)+a.raw,h.text+=`
`+a.text,this.inlineQueue.at(-1).src=h.text):e.push(a);continue}if(a=this.tokenizer.fences(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.heading(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.hr(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.blockquote(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.list(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.html(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.def(t)){t=t.substring(a.raw.length);let h=e.at(-1);(h==null?void 0:h.type)==="paragraph"||(h==null?void 0:h.type)==="text"?(h.raw+=(h.raw.endsWith(`
`)?"":`
`)+a.raw,h.text+=`
`+a.raw,this.inlineQueue.at(-1).src=h.text):this.tokens.links[a.tag]||(this.tokens.links[a.tag]={href:a.href,title:a.title},e.push(a));continue}if(a=this.tokenizer.table(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.lheading(t)){t=t.substring(a.raw.length),e.push(a);continue}let l=t;if((o=this.options.extensions)!=null&&o.startBlock){let h=1/0,p=t.slice(1),u;this.options.extensions.startBlock.forEach(g=>{u=g.call({lexer:this},p),typeof u=="number"&&u>=0&&(h=Math.min(h,u))}),h<1/0&&h>=0&&(l=t.substring(0,h+1))}if(this.state.top&&(a=this.tokenizer.paragraph(l))){let h=e.at(-1);i&&(h==null?void 0:h.type)==="paragraph"?(h.raw+=(h.raw.endsWith(`
`)?"":`
`)+a.raw,h.text+=`
`+a.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=h.text):e.push(a),i=l.length!==t.length,t=t.substring(a.raw.length);continue}if(a=this.tokenizer.text(t)){t=t.substring(a.raw.length);let h=e.at(-1);(h==null?void 0:h.type)==="text"?(h.raw+=(h.raw.endsWith(`
`)?"":`
`)+a.raw,h.text+=`
`+a.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=h.text):e.push(a);continue}if(t){let h="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(h);break}else throw new Error(h)}}return this.state.top=!0,e}inline(t,e=[]){return this.inlineQueue.push({src:t,tokens:e}),e}inlineTokens(t,e=[]){var l,h,p,u,g;let i=t,s=null;if(this.tokens.links){let m=Object.keys(this.tokens.links);if(m.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(i))!=null;)m.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(i=i.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(i))!=null;)i=i.slice(0,s.index)+"++"+i.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let n;for(;(s=this.tokenizer.rules.inline.blockSkip.exec(i))!=null;)n=s[2]?s[2].length:0,i=i.slice(0,s.index+n)+"["+"a".repeat(s[0].length-n-2)+"]"+i.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);i=((h=(l=this.options.hooks)==null?void 0:l.emStrongMask)==null?void 0:h.call({lexer:this},i))??i;let o=!1,a="";for(;t;){o||(a=""),o=!1;let m;if((u=(p=this.options.extensions)==null?void 0:p.inline)!=null&&u.some(f=>(m=f.call({lexer:this},t,e))?(t=t.substring(m.raw.length),e.push(m),!0):!1))continue;if(m=this.tokenizer.escape(t)){t=t.substring(m.raw.length),e.push(m);continue}if(m=this.tokenizer.tag(t)){t=t.substring(m.raw.length),e.push(m);continue}if(m=this.tokenizer.link(t)){t=t.substring(m.raw.length),e.push(m);continue}if(m=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(m.raw.length);let f=e.at(-1);m.type==="text"&&(f==null?void 0:f.type)==="text"?(f.raw+=m.raw,f.text+=m.text):e.push(m);continue}if(m=this.tokenizer.emStrong(t,i,a)){t=t.substring(m.raw.length),e.push(m);continue}if(m=this.tokenizer.codespan(t)){t=t.substring(m.raw.length),e.push(m);continue}if(m=this.tokenizer.br(t)){t=t.substring(m.raw.length),e.push(m);continue}if(m=this.tokenizer.del(t)){t=t.substring(m.raw.length),e.push(m);continue}if(m=this.tokenizer.autolink(t)){t=t.substring(m.raw.length),e.push(m);continue}if(!this.state.inLink&&(m=this.tokenizer.url(t))){t=t.substring(m.raw.length),e.push(m);continue}let b=t;if((g=this.options.extensions)!=null&&g.startInline){let f=1/0,v=t.slice(1),x;this.options.extensions.startInline.forEach(k=>{x=k.call({lexer:this},v),typeof x=="number"&&x>=0&&(f=Math.min(f,x))}),f<1/0&&f>=0&&(b=t.substring(0,f+1))}if(m=this.tokenizer.inlineText(b)){t=t.substring(m.raw.length),m.raw.slice(-1)!=="_"&&(a=m.raw.slice(-1)),o=!0;let f=e.at(-1);(f==null?void 0:f.type)==="text"?(f.raw+=m.raw,f.text+=m.text):e.push(m);continue}if(t){let f="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return e}},mt=class{constructor(r){d(this,"options");d(this,"parser");this.options=r||Z}space(r){return""}code({text:r,lang:t,escaped:e}){var n;let i=(n=(t||"").match(L.notSpaceStart))==null?void 0:n[0],s=r.replace(L.endingNewline,"")+`
`;return i?'<pre><code class="language-'+H(i)+'">'+(e?s:H(s,!0))+`</code></pre>
`:"<pre><code>"+(e?s:H(s,!0))+`</code></pre>
`}blockquote({tokens:r}){return`<blockquote>
${this.parser.parse(r)}</blockquote>
`}html({text:r}){return r}def(r){return""}heading({tokens:r,depth:t}){return`<h${t}>${this.parser.parseInline(r)}</h${t}>
`}hr(r){return`<hr>
`}list(r){let t=r.ordered,e=r.start,i="";for(let o=0;o<r.items.length;o++){let a=r.items[o];i+=this.listitem(a)}let s=t?"ol":"ul",n=t&&e!==1?' start="'+e+'"':"";return"<"+s+n+`>
`+i+"</"+s+`>
`}listitem(r){return`<li>${this.parser.parse(r.tokens)}</li>
`}checkbox({checked:r}){return"<input "+(r?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:r}){return`<p>${this.parser.parseInline(r)}</p>
`}table(r){let t="",e="";for(let s=0;s<r.header.length;s++)e+=this.tablecell(r.header[s]);t+=this.tablerow({text:e});let i="";for(let s=0;s<r.rows.length;s++){let n=r.rows[s];e="";for(let o=0;o<n.length;o++)e+=this.tablecell(n[o]);i+=this.tablerow({text:e})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+i+`</table>
`}tablerow({text:r}){return`<tr>
${r}</tr>
`}tablecell(r){let t=this.parser.parseInline(r.tokens),e=r.header?"th":"td";return(r.align?`<${e} align="${r.align}">`:`<${e}>`)+t+`</${e}>
`}strong({tokens:r}){return`<strong>${this.parser.parseInline(r)}</strong>`}em({tokens:r}){return`<em>${this.parser.parseInline(r)}</em>`}codespan({text:r}){return`<code>${H(r,!0)}</code>`}br(r){return"<br>"}del({tokens:r}){return`<del>${this.parser.parseInline(r)}</del>`}link({href:r,title:t,tokens:e}){let i=this.parser.parseInline(e),s=pe(r);if(s===null)return i;r=s;let n='<a href="'+r+'"';return t&&(n+=' title="'+H(t)+'"'),n+=">"+i+"</a>",n}image({href:r,title:t,text:e,tokens:i}){i&&(e=this.parser.parseInline(i,this.parser.textRenderer));let s=pe(r);if(s===null)return H(e);r=s;let n=`<img src="${r}" alt="${e}"`;return t&&(n+=` title="${H(t)}"`),n+=">",n}text(r){return"tokens"in r&&r.tokens?this.parser.parseInline(r.tokens):"escaped"in r&&r.escaped?r.text:H(r.text)}},Ht=class{strong({text:r}){return r}em({text:r}){return r}codespan({text:r}){return r}del({text:r}){return r}html({text:r}){return r}text({text:r}){return r}link({text:r}){return""+r}image({text:r}){return""+r}br(){return""}checkbox({raw:r}){return r}},D=class St{constructor(t){d(this,"options");d(this,"renderer");d(this,"textRenderer");this.options=t||Z,this.options.renderer=this.options.renderer||new mt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Ht}static parse(t,e){return new St(e).parse(t)}static parseInline(t,e){return new St(e).parseInline(t)}parse(t){var i,s;let e="";for(let n=0;n<t.length;n++){let o=t[n];if((s=(i=this.options.extensions)==null?void 0:i.renderers)!=null&&s[o.type]){let l=o,h=this.options.extensions.renderers[l.type].call({parser:this},l);if(h!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(l.type)){e+=h||"";continue}}let a=o;switch(a.type){case"space":{e+=this.renderer.space(a);break}case"hr":{e+=this.renderer.hr(a);break}case"heading":{e+=this.renderer.heading(a);break}case"code":{e+=this.renderer.code(a);break}case"table":{e+=this.renderer.table(a);break}case"blockquote":{e+=this.renderer.blockquote(a);break}case"list":{e+=this.renderer.list(a);break}case"checkbox":{e+=this.renderer.checkbox(a);break}case"html":{e+=this.renderer.html(a);break}case"def":{e+=this.renderer.def(a);break}case"paragraph":{e+=this.renderer.paragraph(a);break}case"text":{e+=this.renderer.text(a);break}default:{let l='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return e}parseInline(t,e=this.renderer){var s,n;let i="";for(let o=0;o<t.length;o++){let a=t[o];if((n=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&n[a.type]){let h=this.options.extensions.renderers[a.type].call({parser:this},a);if(h!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(a.type)){i+=h||"";continue}}let l=a;switch(l.type){case"escape":{i+=e.text(l);break}case"html":{i+=e.html(l);break}case"link":{i+=e.link(l);break}case"image":{i+=e.image(l);break}case"checkbox":{i+=e.checkbox(l);break}case"strong":{i+=e.strong(l);break}case"em":{i+=e.em(l);break}case"codespan":{i+=e.codespan(l);break}case"br":{i+=e.br(l);break}case"del":{i+=e.del(l);break}case"text":{i+=e.text(l);break}default:{let h='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(h),"";throw new Error(h)}}}return i}},lt,et=(lt=class{constructor(r){d(this,"options");d(this,"block");this.options=r||Z}preprocess(r){return r}postprocess(r){return r}processAllTokens(r){return r}emStrongMask(r){return r}provideLexer(){return this.block?M.lex:M.lexInline}provideParser(){return this.block?D.parse:D.parseInline}},d(lt,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),d(lt,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),lt),We=class{constructor(...r){d(this,"defaults",Lt());d(this,"options",this.setOptions);d(this,"parse",this.parseMarkdown(!0));d(this,"parseInline",this.parseMarkdown(!1));d(this,"Parser",D);d(this,"Renderer",mt);d(this,"TextRenderer",Ht);d(this,"Lexer",M);d(this,"Tokenizer",ut);d(this,"Hooks",et);this.use(...r)}walkTokens(r,t){var i,s;let e=[];for(let n of r)switch(e=e.concat(t.call(this,n)),n.type){case"table":{let o=n;for(let a of o.header)e=e.concat(this.walkTokens(a.tokens,t));for(let a of o.rows)for(let l of a)e=e.concat(this.walkTokens(l.tokens,t));break}case"list":{let o=n;e=e.concat(this.walkTokens(o.items,t));break}default:{let o=n;(s=(i=this.defaults.extensions)==null?void 0:i.childTokens)!=null&&s[o.type]?this.defaults.extensions.childTokens[o.type].forEach(a=>{let l=o[a].flat(1/0);e=e.concat(this.walkTokens(l,t))}):o.tokens&&(e=e.concat(this.walkTokens(o.tokens,t)))}}return e}use(...r){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return r.forEach(e=>{let i={...e};if(i.async=this.defaults.async||i.async||!1,e.extensions&&(e.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let n=t.renderers[s.name];n?t.renderers[s.name]=function(...o){let a=s.renderer.apply(this,o);return a===!1&&(a=n.apply(this,o)),a}:t.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let n=t[s.level];n?n.unshift(s.tokenizer):t[s.level]=[s.tokenizer],s.start&&(s.level==="block"?t.startBlock?t.startBlock.push(s.start):t.startBlock=[s.start]:s.level==="inline"&&(t.startInline?t.startInline.push(s.start):t.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(t.childTokens[s.name]=s.childTokens)}),i.extensions=t),e.renderer){let s=this.defaults.renderer||new mt(this.defaults);for(let n in e.renderer){if(!(n in s))throw new Error(`renderer '${n}' does not exist`);if(["options","parser"].includes(n))continue;let o=n,a=e.renderer[o],l=s[o];s[o]=(...h)=>{let p=a.apply(s,h);return p===!1&&(p=l.apply(s,h)),p||""}}i.renderer=s}if(e.tokenizer){let s=this.defaults.tokenizer||new ut(this.defaults);for(let n in e.tokenizer){if(!(n in s))throw new Error(`tokenizer '${n}' does not exist`);if(["options","rules","lexer"].includes(n))continue;let o=n,a=e.tokenizer[o],l=s[o];s[o]=(...h)=>{let p=a.apply(s,h);return p===!1&&(p=l.apply(s,h)),p}}i.tokenizer=s}if(e.hooks){let s=this.defaults.hooks||new et;for(let n in e.hooks){if(!(n in s))throw new Error(`hook '${n}' does not exist`);if(["options","block"].includes(n))continue;let o=n,a=e.hooks[o],l=s[o];et.passThroughHooks.has(n)?s[o]=h=>{if(this.defaults.async&&et.passThroughHooksRespectAsync.has(n))return(async()=>{let u=await a.call(s,h);return l.call(s,u)})();let p=a.call(s,h);return l.call(s,p)}:s[o]=(...h)=>{if(this.defaults.async)return(async()=>{let u=await a.apply(s,h);return u===!1&&(u=await l.apply(s,h)),u})();let p=a.apply(s,h);return p===!1&&(p=l.apply(s,h)),p}}i.hooks=s}if(e.walkTokens){let s=this.defaults.walkTokens,n=e.walkTokens;i.walkTokens=function(o){let a=[];return a.push(n.call(this,o)),s&&(a=a.concat(s.call(this,o))),a}}this.defaults={...this.defaults,...i}}),this}setOptions(r){return this.defaults={...this.defaults,...r},this}lexer(r,t){return M.lex(r,t??this.defaults)}parser(r,t){return D.parse(r,t??this.defaults)}parseMarkdown(r){return(t,e)=>{let i={...e},s={...this.defaults,...i},n=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&i.async===!1)return n(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return n(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return n(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(s.hooks&&(s.hooks.options=s,s.hooks.block=r),s.async)return(async()=>{let o=s.hooks?await s.hooks.preprocess(t):t,a=await(s.hooks?await s.hooks.provideLexer():r?M.lex:M.lexInline)(o,s),l=s.hooks?await s.hooks.processAllTokens(a):a;s.walkTokens&&await Promise.all(this.walkTokens(l,s.walkTokens));let h=await(s.hooks?await s.hooks.provideParser():r?D.parse:D.parseInline)(l,s);return s.hooks?await s.hooks.postprocess(h):h})().catch(n);try{s.hooks&&(t=s.hooks.preprocess(t));let o=(s.hooks?s.hooks.provideLexer():r?M.lex:M.lexInline)(t,s);s.hooks&&(o=s.hooks.processAllTokens(o)),s.walkTokens&&this.walkTokens(o,s.walkTokens);let a=(s.hooks?s.hooks.provideParser():r?D.parse:D.parseInline)(o,s);return s.hooks&&(a=s.hooks.postprocess(a)),a}catch(o){return n(o)}}}onError(r,t){return e=>{if(e.message+=`
Please report this to https://github.com/markedjs/marked.`,r){let i="<p>An error occurred:</p><pre>"+H(e.message+"",!0)+"</pre>";return t?Promise.resolve(i):i}if(t)return Promise.reject(e);throw e}}},K=new We;function C(r,t){return K.parse(r,t)}C.options=C.setOptions=function(r){return K.setOptions(r),C.defaults=K.defaults,ze(C.defaults),C};C.getDefaults=Lt;C.defaults=Z;C.use=function(...r){return K.use(...r),C.defaults=K.defaults,ze(C.defaults),C};C.walkTokens=function(r,t){return K.walkTokens(r,t)};C.parseInline=K.parseInline;C.Parser=D;C.parser=D.parse;C.Renderer=mt;C.TextRenderer=Ht;C.Lexer=M;C.lexer=M.lex;C.Tokenizer=ut;C.Hooks=et;C.parse=C;C.options;C.setOptions;C.use;C.walkTokens;C.parseInline;D.parse;M.lex;const ge=document.createElement("div");function w(r){return ge.textContent=r,ge.innerHTML}const ms={Read:"file_path",ReadFile:"file_path",Write:"file_path",Edit:"file_path",Glob:"pattern",Grep:"pattern",Bash:"command",WebFetch:"url",WebSearch:"query",Task:"description",NotebookEdit:"notebook_path"},fe=80;function Ft(r,t){if(!t||typeof t!="object")return"";const e=t,i=ms[r];if(i&&e[i]!=null)return ke(String(e[i]),fe);for(const s of Object.values(e))if(typeof s=="string"&&s.length>0)return ke(s,fe);return""}function ke(r,t){const e=r.replace(/\n/g," ");return e.length<=t?e:e.slice(0,t-1)+"â€¦"}let X=null;function gs(){if(X)return X;X=new We;const r={gfm:!0,breaks:!1};return X.setOptions(r),X.use({renderer:{code(t){const e=t.lang?w(t.lang):"",i=w(t.text);return`<div class="thinkt-code-block">
          <div class="thinkt-code-block__header">
            ${e?`<span class="thinkt-code-block__lang">${e}</span>`:'<span class="thinkt-code-block__lang">code</span>'}
            <button class="thinkt-copy-btn" data-copy-action="code">Copy</button>
          </div>
          <pre><code>${i}</code></pre>
        </div>`},html(t){return w(t.text)}}}),X}function Ct(r){return gs().parse(r,{async:!1})}function Q(r){return r==null||r<=0?"":r<1e3?`${r}ms`:`${(r/1e3).toFixed(1)}s`}const fs="*{box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;font-size:13px;line-height:1.6;max-width:900px;margin:0 auto;padding:16px;background:#0a0a0a;color:#e0e0e0}h1{font-size:16px;font-weight:500;margin-bottom:16px;padding-bottom:10px;border-bottom:1px solid #2a2a2a;color:#e0e0e0}.entry{margin-bottom:16px;border-radius:8px;border:1px solid #2a2a2a;background:#141414;overflow:hidden}.entry-header{display:flex;align-items:center;gap:8px;padding:8px 12px;background:#ffffff08;border-bottom:1px solid #2a2a2a}.role{font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:.5px}.role-user{color:#6366f1}.role-assistant{color:#d97750}.role-system{color:#888}.role-tool{color:#19c39b}.timestamp{margin-left:auto;font-size:11px;color:#666}.content{padding:12px}.text{white-space:pre-wrap;word-break:break-word}.text h1,.text h2,.text h3,.text h4,.text h5,.text h6{margin:1em 0 .5em;line-height:1.3;color:#e0e0e0}.text h1:first-child,.text h2:first-child,.text h3:first-child{margin-top:0}.text h1{font-size:1.4em}.text h2{font-size:1.2em}.text h3{font-size:1.1em}.text p{margin:.5em 0}.text p:first-child{margin-top:0}.text p:last-child{margin-bottom:0}.text ul,.text ol{margin:.5em 0;padding-left:1.5em}.text li{margin:.2em 0}.text blockquote{margin:.5em 0;padding:.5em 1em;border-left:3px solid #444;color:#aaa;background:#ffffff05}.text a{color:#6366f1;text-decoration:none}.text a:hover{text-decoration:underline}.text code{font-family:SF Mono,Monaco,monospace;font-size:.9em;padding:.15em .4em;background:#ffffff14;border-radius:3px}.text pre{margin:.5em 0;border-radius:6px;border:1px solid #2a2a2a;overflow:hidden;background:#0000004d}.text pre code{display:block;padding:10px 12px;background:none;border-radius:0;overflow-x:auto;font-size:12px;line-height:1.5}.text table{border-collapse:collapse;margin:.5em 0;width:100%}.text th,.text td{border:1px solid #333;padding:6px 10px;text-align:left}.text th{background:#ffffff0d;font-weight:600}.text hr{border:none;border-top:1px solid #333;margin:1em 0}.text img{max-width:100%}.thinking{margin-top:12px;border-radius:4px;background:#6366f114;border-left:3px solid #6366f1;overflow:hidden}.thinking-header{display:flex;align-items:center;gap:8px;padding:8px 12px;cursor:pointer;-webkit-user-select:none;user-select:none;transition:background .12s ease}.thinking-header:hover{background:#6366f10f}.thinking-toggle{font-size:10px;color:#6366f1;transition:transform .15s ease}.thinking-label{font-size:11px;font-weight:600;color:#6366f1}.thinking-content{display:none;padding:8px 12px;font-style:italic;color:#a5a6f3;white-space:pre-wrap;word-break:break-word;border-top:1px solid rgba(99,102,241,.15);max-height:400px;overflow-y:auto}.thinking.expanded .thinking-content{display:block}.thinking.expanded .thinking-toggle{transform:rotate(90deg)}.tool{margin-top:8px;border-radius:4px;background:#19c39b0f;border-left:3px solid #19c39b;overflow:hidden}.tool-header{display:flex;align-items:center;gap:6px;padding:6px 12px;cursor:pointer;-webkit-user-select:none;user-select:none;font-size:12px;transition:background .12s ease}.tool-header:hover{background:#19c39b0f}.tool-toggle{font-size:10px;color:#19c39b;transition:transform .15s ease}.tool-bullet{color:#666}.tool-name{font-weight:600;color:#19c39b}.tool-summary{color:#999;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;font-family:SF Mono,Monaco,monospace;font-size:11px}.tool-content{display:none;padding:8px 12px;border-top:1px solid rgba(25,195,155,.15);font-family:SF Mono,Monaco,monospace;font-size:11px;background:#0000004d;overflow-x:auto;max-height:300px;overflow-y:auto;white-space:pre-wrap;word-break:break-word}.tool.expanded .tool-content{display:block}.tool.expanded .tool-toggle{transform:rotate(90deg)}.tool-result{background:#22c55e1a;border-left-color:#22c55e}.tool-result .tool-header:hover{background:#22c55e0f}.tool-result .tool-toggle,.tool-result .tool-label{color:#22c55e}.tool-error{background:#ef44441a;border-left-color:#ef4444}.tool-error .tool-header:hover{background:#ef44440f}.tool-error .tool-toggle,.tool-error .tool-label{color:#ef4444}.tool-result-inline{margin-top:4px;border-top:1px solid rgba(25,195,155,.15)}.tool-result-inline .tool-header{background:#22c55e14}.tool-result-inline.tool-result--error .tool-header{background:#ef444414}.media{margin-top:8px;border-radius:4px;overflow:hidden;border-left:3px solid #60a5fa;background:#60a5fa14}.media-document{border-left-color:#a78bfa;background:#a78bfa14}.media-header{display:flex;align-items:center;gap:8px;padding:8px 12px;font-size:11px;border-bottom:1px solid rgba(255,255,255,.08)}.media-label{font-weight:600;color:#93c5fd}.media-document .media-label{color:#c4b5fd}.media-type{margin-left:auto;color:#999;font-family:SF Mono,Monaco,monospace;font-size:10px}.media-content{padding:10px 12px}.media-image-preview{display:block;max-width:100%;max-height:460px;border-radius:6px;border:1px solid #2a2a2a;background:#0000004d}.media-filename{margin-bottom:8px;color:#e0e0e0;word-break:break-word}.media-link{display:inline-block;padding:5px 10px;border-radius:4px;border:1px solid rgba(167,139,250,.45);color:#c4b5fd;text-decoration:none;font-size:11px;background:#a78bfa1f}.media-link:hover{background:#a78bfa33}.media-empty{color:#999;font-size:12px}.meta{color:#666;font-size:11px;margin-top:20px;padding-top:10px;border-top:1px solid #2a2a2a}.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;color:#666;text-align:center}.empty-icon{font-size:40px;margin-bottom:12px;opacity:.4}.empty-title{font-size:16px;font-weight:500;margin-bottom:6px;color:#e0e0e0}";function ks(){return{user:!0,assistant:!0,thinking:!0,toolUse:!0,toolResult:!0,media:!0,system:!1}}function Ut(r){return{...ks(),...r??{}}}function bs(r,t){const e=(r||"unknown").toLowerCase();return e==="user"?t.user:e==="assistant"?t.assistant:e==="system"?t.system:!1}function vs(r,t){const e=[];for(const i of r){if(!bs(i.role,t))continue;const s=i.contentBlocks??[];if(s.length===0){i.text&&i.text.trim()&&e.push({...i});continue}const n=s.filter(o=>{switch(o.type){case"text":return!!(o.text&&o.text.trim());case"thinking":return t.thinking;case"tool_use":return t.toolUse;case"tool_result":return t.toolResult;case"image":case"document":return t.media;default:return!0}});n.length>0&&e.push({...i,contentBlocks:n})}return e}function xs(r){return r.replace(/[^a-z0-9\s-]/gi,"").replace(/\s+/g,"-").substring(0,50).toLowerCase()||"conversation"}function bt(r,t,e){const i=new Blob([r],{type:e}),s=URL.createObjectURL(i),n=document.createElement("a");n.href=s,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}function ws(r,t,e){const i=Ut(e);let s=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${w(t)}</title>
  <style>${fs}</style>
</head>
<body>
  <h1>${w(t)}</h1>
`;const n=new Map;for(const a of r)for(const l of a.contentBlocks||[])if(l.type==="tool_result"){const h=l;n.set(h.toolUseId,h)}const o=new Set;for(const a of r){const l=(a.role||"unknown").toLowerCase(),h=a.timestamp?new Date(a.timestamp).toLocaleString():"",p=l==="user",u=l==="assistant",g=l==="system";if(p&&!i.user||u&&!i.assistant||g&&!i.system||!p&&!u&&!g)continue;let m="",b=!1;if(a.contentBlocks&&a.contentBlocks.length>0)for(const f of a.contentBlocks)switch(f.type){case"text":{f.text&&f.text.trim()&&(m+=`      <div class="text">${Ct(f.text)}</div>
`,b=!0);break}case"thinking":{i.thinking&&(m+=ys(f),b=!0);break}case"tool_use":{if(i.toolUse){const v=f,x=n.get(v.toolUseId);x&&o.add(v.toolUseId),m+=_s(v,x,i),b=!0}break}case"tool_result":{const v=f;i.toolResult&&!o.has(v.toolUseId)&&(m+=Ss(v),b=!0);break}case"image":{i.media&&(m+=Cs(f),b=!0);break}case"document":{i.media&&(m+=Ts(f),b=!0);break}}(!a.contentBlocks||a.contentBlocks.length===0)&&a.text&&a.text.trim()&&(m+=`      <div class="text">${Ct(a.text)}</div>
`,b=!0),b&&(s+=`  <div class="entry">
`,s+=`    <div class="entry-header">
`,s+=`      <span class="role role-${l}">${w(l)}</span>
`,h&&(s+=`      <span class="timestamp">${w(h)}</span>
`),s+=`    </div>
`,s+=`    <div class="content">
`,s+=m,s+=`    </div>
`,s+=`  </div>
`)}return s+=`  <div class="meta">Exported from THINKT on ${new Date().toLocaleString()}</div>
</body>
</html>`,s}function ys(r){return`      <div class="thinking">
        <div class="thinking-header">
          <span class="thinking-toggle">â–¶</span>
          <span class="thinking-label">Thinking${r.durationMs?` (${Q(r.durationMs)})`:""}</span>
        </div>
        <div class="thinking-content">${w(r.thinking||"")}</div>
      </div>
`}function _s(r,t,e){const i=JSON.stringify(r.toolInput,null,2),s=Ft(r.toolName,r.toolInput),n=s?`<span class="tool-summary">(${w(s)})</span>`:"";let o="";if(t&&e.toolResult){const a=t.isError?"tool-result--error":"",l=t.isError?"Error":"Result",h=t.durationMs?` (${Q(t.durationMs)})`:"";o=`
        <div class="tool-result-inline ${a}">
          <div class="tool-header">
            <span class="tool-toggle">â–¶</span>
            <span class="tool-label">${l}${h}</span>
          </div>
          <div class="tool-content">${w(String(t.toolResult||""))}</div>
        </div>`}return`      <div class="tool">
        <div class="tool-header">
          <span class="tool-toggle">â–¶</span>
          <span class="tool-bullet">â€¢</span>
          <span class="tool-name">${w(r.toolName)}</span>
          ${n}
        </div>
        <div class="tool-content">${w(i)}</div>${o}
      </div>
`}function Ss(r){const t=r.isError?"tool tool-error":"tool tool-result",e=r.isError?"Error":"Result",i=r.durationMs?` (${Q(r.durationMs)})`:"";return`      <div class="${t}">
        <div class="tool-header">
          <span class="tool-toggle">â–¶</span>
          <span class="tool-label">${e}${i}</span>
        </div>
        <div class="tool-content">${w(String(r.toolResult||""))}</div>
      </div>
`}function Ke(r,t){const e=t.trim();return e?/^(data:|blob:|https?:)/i.test(e)?e:`data:${r};base64,${e}`:""}function Ze(r){return r==="application/pdf"?"document.pdf":r==="text/plain"?"document.txt":r==="application/json"?"document.json":r==="text/markdown"?"document.md":"document.bin"}function Cs(r){var s;const t=((s=r.mediaType)==null?void 0:s.trim())||"application/octet-stream",e=Ke(t,r.mediaData),i=e?`<img class="media-image-preview" src="${w(e)}" alt="Image preview" loading="lazy" />`:'<div class="media-empty">No image data available</div>';return`      <div class="media media-image">
        <div class="media-header">
          <span class="media-label">Image</span>
          <span class="media-type">${w(t)}</span>
        </div>
        <div class="media-content">
          ${i}
        </div>
      </div>
`}function Ts(r){var n,o;const t=((n=r.mediaType)==null?void 0:n.trim())||"application/octet-stream",e=Ke(t,r.mediaData),i=((o=r.filename)==null?void 0:o.trim())||Ze(t),s=e?`<a class="media-link" href="${w(e)}" download="${w(i)}" target="_blank" rel="noopener noreferrer">Download</a>`:'<div class="media-empty">No document data available</div>';return`      <div class="media media-document">
        <div class="media-header">
          <span class="media-label">Document</span>
          <span class="media-type">${w(t)}</span>
        </div>
        <div class="media-content">
          <div class="media-filename">${w(i)}</div>
          ${s}
        </div>
      </div>
`}function Es(r,t,e){var a,l,h;const i=Ut(e);let s=`# ${t}

`;const n=new Map;for(const p of r)for(const u of p.contentBlocks||[])if(u.type==="tool_result"){const g=u;n.set(g.toolUseId,g)}const o=new Set;for(const p of r){const u=(p.role||"unknown").toLowerCase(),g=u==="user",m=u==="assistant",b=u==="system";if(g&&!i.user||m&&!i.assistant||b&&!i.system||!g&&!m&&!b)continue;let f="";if(p.contentBlocks&&p.contentBlocks.length>0)for(const x of p.contentBlocks)switch(x.type){case"text":{x.text&&x.text.trim()&&(f+=x.text+`

`);break}case"thinking":{if(i.thinking){const k=x,y=k.durationMs?` (${Q(k.durationMs)})`:"";f+=`<details>
<summary>Thinking${y}</summary>

\`\`\`
${k.thinking||""}
\`\`\`

</details>

`}break}case"tool_use":{if(i.toolUse){const k=x,y=JSON.stringify(k.toolInput,null,2),S=Ft(k.toolName,k.toolInput),$=S?` (${S})`:"";f+=`<details>
<summary>Tool: ${k.toolName}${$}</summary>

\`\`\`json
${y}
\`\`\`

</details>

`;const T=n.get(k.toolUseId);if(T&&(o.add(k.toolUseId),i.toolResult)){const R=T.isError?"Error":"Result";f+=`<details>
<summary>${R}</summary>

\`\`\`
${String(T.toolResult||"")}
\`\`\`

</details>

`}}break}case"tool_result":{const k=x;if(i.toolResult&&!o.has(k.toolUseId)){const y=k.isError?"Error":"Result";f+=`<details>
<summary>${y}</summary>

\`\`\`
${String(k.toolResult||"")}
\`\`\`

</details>

`}break}case"image":{if(i.media){const y=((a=x.mediaType)==null?void 0:a.trim())||"application/octet-stream";f+=`> Image: ${y}

`}break}case"document":{if(i.media){const k=x,y=((l=k.mediaType)==null?void 0:l.trim())||"application/octet-stream",S=((h=k.filename)==null?void 0:h.trim())||Ze(y);f+=`> Document: ${S} (${y})

`}break}}if((!p.contentBlocks||p.contentBlocks.length===0)&&p.text&&p.text.trim()&&(f+=p.text+`

`),!f.trim())continue;const v=p.timestamp?new Date(p.timestamp).toLocaleString():"";s+=`---

`,s+=`## ${u.charAt(0).toUpperCase()+u.slice(1)}`,v&&(s+=` (${v})`),s+=`

`,s+=f}return s+=`---

*Exported from THINKT on ${new Date().toLocaleString()}*
`,s}function Ps(r,t,e,i){const s=Ut(e),n={schema:"thinkt.conversation.export",version:1,exportedAt:new Date().toISOString(),title:t,...i!=null&&i.sourcePath?{sourcePath:i.sourcePath}:{},filters:s,entries:r,visibleEntries:vs(r,s)};return JSON.stringify(n,null,2)}const $s=1500,js=2e3;class As{constructor(t){d(this,"container");d(this,"contentContainer");d(this,"filterContainer");d(this,"toolbarContainer");d(this,"client",null);d(this,"onResumeSession",null);d(this,"canResumeSession",null);d(this,"onToggleTimelinePanel",null);d(this,"isTimelinePanelVisible",null);d(this,"canToggleTimelinePanel",null);d(this,"onToggleSidebar",null);d(this,"isSidebarCollapsed",null);d(this,"filterState",{user:!0,assistant:!0,thinking:!1,toolUse:!1,toolResult:!1,media:!0,system:!1});d(this,"currentProjectPath",null);d(this,"currentEntryCount",0);d(this,"currentEntries",[]);d(this,"hasLoadedSession",!1);d(this,"currentSessionSource",null);d(this,"currentSessionModel",null);d(this,"toolResultIndex",new Map);d(this,"inlinedToolResults",new Set);d(this,"abortController",new AbortController);d(this,"availableApps",[]);d(this,"exportDropdownOpen",!1);this.container=t.elements.container,this.client=t.client??null,this.onResumeSession=t.onResumeSession??null,this.canResumeSession=t.canResumeSession??null,this.onToggleTimelinePanel=t.onToggleTimelinePanel??null,this.isTimelinePanelVisible=t.isTimelinePanelVisible??null,this.canToggleTimelinePanel=t.canToggleTimelinePanel??null,this.onToggleSidebar=t.onToggleSidebar??null,this.isSidebarCollapsed=t.isSidebarCollapsed??null,this.init(),this.fetchAvailableApps()}init(){N("thinkt-conversation-view-styles",Ai),this.container.className="thinkt-conversation-view",this.createStructure(),this.setupFilters(),window.addEventListener("thinkt:locale-changed",()=>this.refreshI18n(),{signal:this.abortController.signal})}createStructure(){this.toolbarContainer=document.createElement("div"),this.toolbarContainer.className="thinkt-conversation-view__toolbar",this.renderToolbar(),this.container.appendChild(this.toolbarContainer),this.filterContainer=document.createElement("div"),this.filterContainer.className="thinkt-conversation-view__filters",this.renderFilterBar(),this.container.appendChild(this.filterContainer),this.contentContainer=document.createElement("div"),this.contentContainer.className="thinkt-conversation-view__content",this.container.appendChild(this.contentContainer),this.contentContainer.addEventListener("click",t=>this.handleContentClick(t),{signal:this.abortController.signal}),this.showEmpty()}handleContentClick(t){const e=t.target,i=e.closest(".thinkt-thinking-block__header");if(i){const o=i.closest(".thinkt-thinking-block");o==null||o.classList.toggle("expanded");return}const s=e.closest(".thinkt-tool-call__summary");if(s){const o=s.closest(".thinkt-tool-call");o==null||o.classList.toggle("expanded");return}const n=e.closest(".thinkt-copy-btn");if(n){this.handleCopy(n);return}}async handleCopy(t){let e="";const i=t.dataset.copyAction;if(i==="code"){const s=t.closest(".thinkt-code-block"),n=s==null?void 0:s.querySelector("code");e=(n==null?void 0:n.textContent)??""}else if(i==="text"){const s=t.closest(".thinkt-conversation-entry__text");if(s){const n=s.cloneNode(!0);n.querySelectorAll(".thinkt-copy-btn").forEach(o=>o.remove()),e=n.textContent??""}}else if(i==="detail"){const s=t.closest(".thinkt-tool-call__detail-content");if(s){const n=s.cloneNode(!0);n.querySelectorAll(".thinkt-copy-btn").forEach(o=>o.remove()),e=n.textContent??""}}if(e)try{await navigator.clipboard.writeText(e);const s=t.textContent;t.textContent="âœ“",setTimeout(()=>{t.textContent=s},$s)}catch{}}async fetchAvailableApps(){if(this.client)try{const t=await this.client.getOpenInApps();this.availableApps=t.apps??[],this.renderToolbar()}catch{}}renderToolbar(){var b,f,v,x;const t=this.currentProjectPath??c._("No project selected"),e=this.currentEntryCount,i=((b=this.isSidebarCollapsed)==null?void 0:b.call(this))??!1,s=c._("Open sidebar"),n=c._("Open settings and info"),o=c._("Open search dialog ({shortcut})",{shortcut:this.getSearchShortcutLabel()}),a=((f=this.canResumeSession)==null?void 0:f.call(this))??!1,l=this.onResumeSession&&a?`<button class="thinkt-conversation-view__toolbar-btn" id="toolbar-resume-btn">${c._("Resume")}</button>`:"",h=((v=this.isTimelinePanelVisible)==null?void 0:v.call(this))??!1,p=((x=this.canToggleTimelinePanel)==null?void 0:x.call(this))??!1,u=this.onToggleTimelinePanel?`
          <button class="thinkt-conversation-view__toolbar-btn" id="toolbar-timeline-btn" ${p?"":"disabled"}>
            ${h?c._("Hide Timeline"):c._("Show Timeline")}
          </button>
        `:"",g=this.availableApps.filter(k=>k.enabled).map(k=>`
        <div class="thinkt-conversation-view__toolbar-dropdown-item" data-action="${w(k.id??"")}">
          ${c._("Open in")} ${w(k.name??k.id??"")}
        </div>
      `).join(""),m=i?`
          <div class="thinkt-sidebar-brand-group">
            <span class="thinkt-sidebar-brand-label">thinkt</span>
            <button
              class="thinkt-sidebar-brand-btn"
              id="toolbar-sidebar-btn"
              title="${w(s)}"
              aria-label="${w(s)}"
            >
              â˜°
            </button>
            <button
              class="thinkt-sidebar-brand-action-btn"
              id="toolbar-settings-btn"
              title="${w(n)}"
              aria-label="${w(n)}"
            >
              âš™
            </button>
            <button
              class="thinkt-sidebar-brand-action-btn"
              id="toolbar-search-btn"
              title="${w(o)}"
              aria-label="${w(o)}"
            >
              ðŸ”
            </button>
          </div>
        `:"";this.toolbarContainer.innerHTML=`
      ${m}
      <div class="thinkt-conversation-view__toolbar-path">
        <span class="thinkt-conversation-view__toolbar-path-icon">ðŸ“</span>
        <span class="thinkt-conversation-view__toolbar-path-text" title="${w(t)}">${w(t)}</span>
      </div>
      <div class="thinkt-conversation-view__toolbar-right">
        <div class="thinkt-conversation-view__toolbar-metrics">
          ${e>0?`<span>${c._("{count, plural, one {# entry} other {# entries}}",{count:e})}</span>`:""}
        </div>
        <div class="thinkt-conversation-view__toolbar-actions">
          ${l}
          <button class="thinkt-conversation-view__toolbar-btn" id="toolbar-open-btn">
            ${c._("Open")} â–¼
          </button>
          <div class="thinkt-conversation-view__toolbar-dropdown" id="toolbar-dropdown">
            ${g}
            <div class="thinkt-conversation-view__toolbar-dropdown-item" data-action="copy">
              <span class="icon">ðŸ“‹</span> ${c._("Copy Path")}
            </div>
          </div>
        </div>
        ${u}
      </div>
    `,this.setupToolbarActions()}setupToolbarActions(){const t=this.toolbarContainer.querySelector("#toolbar-sidebar-btn");t&&t.addEventListener("click",()=>{var l;(l=this.onToggleSidebar)==null||l.call(this)});const e=this.toolbarContainer.querySelector("#toolbar-settings-btn");e&&e.addEventListener("click",()=>{const l=document.getElementById("global-settings-button");l instanceof HTMLButtonElement&&l.click()});const i=this.toolbarContainer.querySelector("#toolbar-search-btn");i&&i.addEventListener("click",()=>{const l=document.getElementById("global-search-button");l instanceof HTMLButtonElement&&l.click()});const s=this.toolbarContainer.querySelector("#toolbar-resume-btn");s&&s.addEventListener("click",()=>{this.handleResumeAction()});const n=this.toolbarContainer.querySelector("#toolbar-timeline-btn");n&&n.addEventListener("click",()=>{var l;(l=this.onToggleTimelinePanel)==null||l.call(this),this.renderToolbar()});const o=this.toolbarContainer.querySelector("#toolbar-open-btn"),a=this.toolbarContainer.querySelector("#toolbar-dropdown");!o||!a||(o.addEventListener("click",l=>{l.stopPropagation(),a.classList.toggle("open")}),document.addEventListener("click",()=>{a.classList.remove("open")},{signal:this.abortController.signal}),a.querySelectorAll(".thinkt-conversation-view__toolbar-dropdown-item").forEach(l=>{l.addEventListener("click",h=>{h.stopPropagation();const p=l.dataset.action;this.handleToolbarAction(p??""),a.classList.remove("open")})}))}getSearchShortcutLabel(){const t=navigator.platform.toLowerCase();return t.includes("mac")||t.includes("iphone")||t.includes("ipad")?"Cmd+K":"Ctrl+K"}async handleResumeAction(){if(this.onResumeSession)try{await this.onResumeSession()}catch{}}async handleToolbarAction(t){if(this.currentProjectPath){if(t==="copy"){try{await navigator.clipboard.writeText(this.currentProjectPath)}catch{}return}if(this.client)try{await this.client.openIn(t,this.currentProjectPath)}catch(e){console.warn("[THINKT] Failed to open in app, copying path to clipboard:",e);try{await navigator.clipboard.writeText(this.currentProjectPath)}catch{}}else try{await navigator.clipboard.writeText(this.currentProjectPath)}catch{}}}setProjectPath(t,e){this.currentProjectPath=t,e!==void 0&&(this.currentEntryCount=e),this.renderToolbar()}setSessionContext(t){var e,i;this.currentSessionSource=((e=t==null?void 0:t.source)==null?void 0:e.trim())||null,this.currentSessionModel=((i=t==null?void 0:t.model)==null?void 0:i.trim())||null,this.renderFilterBar(),this.setupFilters(),this.applyFilters()}renderFilterBar(){const t=this.currentEntries.length>0,e=this.renderSourceBadge(),i=this.renderModelBadge(),s=e||i?`<div class="thinkt-conversation-view__session-context">${e}${i}</div>`:"";this.filterContainer.innerHTML=`
      ${s}
      <span class="thinkt-conversation-view__filter-label">${c._("Show:")}</span>
      <button class="thinkt-conversation-view__filter-btn ${this.filterState.user?"active":""}" data-filter="user">
        ${c._("User")}
      </button>
      <button class="thinkt-conversation-view__filter-btn ${this.filterState.assistant?"active":""}" data-filter="assistant">
        ${c._("Assistant")}
      </button>
      <button class="thinkt-conversation-view__filter-btn ${this.filterState.thinking?"active":""}" data-filter="thinking">
        ${c._("Thinking")}
      </button>
      <button class="thinkt-conversation-view__filter-btn ${this.isToolFilterActive()?"active":""}" data-filter="tool">
        ${c._("Tool")}
      </button>
      <button class="thinkt-conversation-view__filter-btn ${this.filterState.media?"active":""}" data-filter="media">
        ${c._("Media")}
      </button>
      <button class="thinkt-conversation-view__filter-btn ${this.filterState.system?"active":""}" data-filter="system">
        ${c._("System")}
      </button>
      <div class="thinkt-conversation-view__export">
        <button class="thinkt-conversation-view__export-btn" id="export-btn" ${t?"":"disabled"}>
          ${c._("Export")} â–¼
        </button>
        <div class="thinkt-conversation-view__export-dropdown" id="export-dropdown">
          <div class="thinkt-conversation-view__export-dropdown-item" data-format="html">
            <span class="icon">ðŸŒ</span> ${c._("Export as HTML")}
          </div>
          <div class="thinkt-conversation-view__export-dropdown-item" data-format="markdown">
            <span class="icon">ðŸ“</span> ${c._("Export as Markdown")}
          </div>
          <div class="thinkt-conversation-view__export-dropdown-item" data-format="raw-json">
            <span class="icon">{}</span> ${c._("Export as Raw JSON")}
          </div>
        </div>
      </div>
    `,this.setupExportHandlers()}renderSourceBadge(){var i;const t=(i=this.currentSessionSource)==null?void 0:i.trim();return t?`<span class="thinkt-conversation-view__session-badge thinkt-conversation-view__session-badge--source ${this.getSourceBadgeClass(t)}">${w(t)}</span>`:""}renderModelBadge(){var e;const t=(e=this.currentSessionModel)==null?void 0:e.trim();return t?`<span class="thinkt-conversation-view__session-badge thinkt-conversation-view__session-badge--model" title="${w(t)}">${w(t)}</span>`:""}getSourceBadgeClass(t){const e=t.trim().toLowerCase();return e==="claude"?"thinkt-conversation-view__session-badge--source-claude":e==="kimi"?"thinkt-conversation-view__session-badge--source-kimi":e==="gemini"?"thinkt-conversation-view__session-badge--source-gemini":e==="copilot"?"thinkt-conversation-view__session-badge--source-copilot":e==="codex"?"thinkt-conversation-view__session-badge--source-codex":e==="qwen"?"thinkt-conversation-view__session-badge--source-qwen":e==="thinkt"?"thinkt-conversation-view__session-badge--source-thinkt":"thinkt-conversation-view__session-badge--source-other"}setupExportHandlers(){const t=this.filterContainer.querySelector("#export-btn"),e=this.filterContainer.querySelector("#export-dropdown");!t||!e||(t.addEventListener("click",i=>{i.stopPropagation(),this.exportDropdownOpen=!this.exportDropdownOpen,this.exportDropdownOpen?(this.positionDropdown(t,e),e.classList.add("open")):e.classList.remove("open")}),document.addEventListener("click",()=>{this.exportDropdownOpen&&(this.exportDropdownOpen=!1,e.classList.remove("open"))},{signal:this.abortController.signal}),e.querySelectorAll(".thinkt-conversation-view__export-dropdown-item").forEach(i=>{i.addEventListener("click",s=>{s.stopPropagation();const n=i.dataset.format;n&&this.handleExport(n),this.exportDropdownOpen=!1,e.classList.remove("open")})}))}positionDropdown(t,e){const i=t.getBoundingClientRect();e.style.top=`${i.bottom+4}px`,e.style.right=`${window.innerWidth-i.right}px`}handleExport(t){const e=this.currentProjectPath?`${this.currentProjectPath.split("/").pop()||c._("conversation")}`:c._("conversation"),i=this.isToolFilterActive(),s={user:this.filterState.user,assistant:this.filterState.assistant,thinking:this.filterState.thinking,toolUse:i,toolResult:i,media:this.filterState.media,system:this.filterState.system};if(this.currentEntries.length===0)return;const n=xs(e);if(t==="html"){const o=ws(this.currentEntries,e,s);bt(o,`${n}.html`,"text/html")}else if(t==="markdown"){const o=Es(this.currentEntries,e,s);bt(o,`${n}.md`,"text/markdown")}else if(t==="raw-json"){const o=Ps(this.currentEntries,e,s,{sourcePath:this.currentProjectPath??void 0});bt(o,`${n}.json`,"application/json")}}setupFilters(){this.filterContainer.querySelectorAll(".thinkt-conversation-view__filter-btn").forEach(e=>{const i=e,s=i.dataset.filter;if(!s)return;const n=()=>{if(s==="tool"){const o=!this.isToolFilterActive();this.filterState.toolUse=o,this.filterState.toolResult=o,i.classList.toggle("active",o)}else this.filterState[s]=!this.filterState[s],i.classList.toggle("active",this.filterState[s]);this.applyFilters()};i.addEventListener("click",n,{signal:this.abortController.signal})})}applyFilters(){this.contentContainer.querySelectorAll("[data-role]").forEach(t=>{const e=t,i=(e.dataset.role??"").toLowerCase(),s=e.dataset.blockType;let n=!1;i==="user"?n=!this.filterState.user:i==="assistant"?n=!this.filterState.assistant:(i==="system"||i==="progress"||i==="checkpoint")&&(n=!this.filterState.system),!n&&s&&(s==="thinking"?n=!this.filterState.thinking:s==="toolUse"||s==="toolResult"?n=!this.isToolFilterActive():(s==="image"||s==="document")&&(n=!this.filterState.media)),e.classList.toggle("hidden",n)}),this.updateFilteredEmptyState()}updateFilteredEmptyState(){const t=this.contentContainer.querySelector(".thinkt-conversation-empty--filtered");if(this.currentEntries.length===0){t==null||t.remove();return}if(Array.from(this.contentContainer.querySelectorAll("[data-role]")).find(s=>!s.classList.contains("hidden"))){t==null||t.remove();return}if(t)return;const i=document.createElement("div");i.className="thinkt-conversation-empty thinkt-conversation-empty--filtered",i.innerHTML=`
      <div class="thinkt-conversation-empty__icon">ðŸ‘</div>
      <div class="thinkt-conversation-empty__title">${c._("Everything is hidden by current filters")}</div>
      <div>${c._("Adjust the Show filters to view conversation entries")}</div>
    `,this.contentContainer.appendChild(i)}getFilterState(){return{...this.filterState}}setFilterState(t){if(Object.assign(this.filterState,t),t.toolUse!==void 0||t.toolResult!==void 0){const e=t.toolUse??t.toolResult??this.isToolFilterActive();this.filterState.toolUse=e,this.filterState.toolResult=e}this.renderFilterBar(),this.setupFilters(),this.applyFilters()}isToolFilterActive(){return this.filterState.toolUse||this.filterState.toolResult}buildToolResultIndex(t){this.toolResultIndex.clear(),this.inlinedToolResults.clear();for(const e of t)if(e.contentBlocks){for(const i of e.contentBlocks)if(i.type==="tool_result"){const s=i;this.toolResultIndex.set(s.toolUseId,s)}}}displayEntries(t){if(this.contentContainer.replaceChildren(),this.currentEntries=t||[],this.hasLoadedSession=!0,this.currentEntries.length===0){this.showSessionEmpty();return}this.buildToolResultIndex(this.currentEntries);for(let e=0;e<this.currentEntries.length;e++){const i=this.currentEntries[e],s=this.renderEntry(i,e);this.contentContainer.appendChild(s)}this.currentEntryCount=this.currentEntries.length,this.renderToolbar(),this.renderFilterBar(),this.setupFilters(),this.applyFilters()}beginProgressiveDisplay(){this.contentContainer.replaceChildren(),this.currentEntries=[],this.hasLoadedSession=!0,this.toolResultIndex.clear(),this.inlinedToolResults.clear(),this.currentEntryCount=0,this.renderToolbar(),this.renderFilterBar(),this.setupFilters(),this.applyFilters()}appendEntries(t){for(const e of t){this.currentEntries.push(e);const i=this.renderEntry(e,this.currentEntries.length-1);this.contentContainer.appendChild(i)}this.currentEntryCount=this.currentEntries.length,this.applyFilters()}finalizeProgressiveDisplay(){if(this.currentEntries.length===0){this.showSessionEmpty();return}if(this.buildToolResultIndex(this.currentEntries),this.toolResultIndex.size>0){this.contentContainer.replaceChildren();for(let t=0;t<this.currentEntries.length;t++){const e=this.renderEntry(this.currentEntries[t],t);this.contentContainer.appendChild(e)}}this.renderToolbar(),this.renderFilterBar(),this.setupFilters(),this.applyFilters()}renderEntry(t,e){var h;const i=document.createDocumentFragment(),s=t.role||"unknown",n=t.timestamp?new Date(t.timestamp).toLocaleString():"";if(!((h=t.contentBlocks)!=null&&h.length)){if(t.text){const p=s==="assistant"?this.renderAssistantText(t.text):this.renderPlainText(t.text);i.appendChild(this.createTextCard(s,n,p))}return i}let o="",a=!0;const l=()=>{o&&(i.appendChild(this.createTextCard(s,a?n:"",o)),o="",a=!1)};for(const p of t.contentBlocks)switch(p.type){case"text":p.text&&p.text.trim()&&(o+=s==="assistant"?this.renderAssistantText(p.text):this.renderPlainText(p.text));break;case"thinking":l(),i.appendChild(this.createStandaloneBlock(s,"thinking",this.renderThinkingBlock(p.thinking||"",p.durationMs)));break;case"tool_use":l(),i.appendChild(this.createStandaloneBlock(s,"toolUse",this.renderToolCall(p.toolUseId,p.toolName,p.toolInput)));break;case"tool_result":this.inlinedToolResults.has(p.toolUseId)||(l(),i.appendChild(this.createStandaloneBlock(s,"toolResult",this.renderToolResultBlock(p))));break;case"image":l(),i.appendChild(this.createStandaloneBlock(s,"image",this.renderImageBlock(p)));break;case"document":l(),i.appendChild(this.createStandaloneBlock(s,"document",this.renderDocumentBlock(p)));break}if(l(),e!==void 0)for(let p=0;p<i.childNodes.length;p++){const u=i.childNodes[p];u instanceof HTMLElement&&(u.dataset.entryIndex=String(e))}return i}createTextCard(t,e,i){const s=document.createElement("div");s.className="thinkt-conversation-entry",s.dataset.role=t,s.dataset.blockType="text";const n=`thinkt-conversation-entry__role--${t}`;return s.innerHTML=`
      <div class="thinkt-conversation-entry__header">
        <span class="thinkt-conversation-entry__role ${n}">${w(t)}</span>
        ${e?`<span class="thinkt-conversation-entry__timestamp">${w(e)}</span>`:""}
      </div>
      <div class="thinkt-conversation-entry__content">${i}</div>
    `,s}createStandaloneBlock(t,e,i){const s=document.createElement("div");return s.className="thinkt-standalone-block",s.dataset.role=t,s.dataset.blockType=e,s.innerHTML=i,s}renderAssistantText(t){return`<div class="thinkt-conversation-entry__text thinkt-conversation-entry__text--markdown">${Ct(t)}<button class="thinkt-copy-btn thinkt-copy-btn--float" data-copy-action="text">${c._("Copy")}</button></div>`}renderPlainText(t){return`<div class="thinkt-conversation-entry__text">${w(t)}</div>`}renderToolResultBlock(t){const e=t.isError?"thinkt-conversation-entry__tool-result--error":"",i=t.isError?c._("Error"):c._("Result");return`
      <div class="thinkt-conversation-entry__tool-result ${e}">
        <div class="thinkt-conversation-entry__tool-result-label">${i}</div>
        <div class="thinkt-conversation-entry__text">${w(String(t.toolResult||""))}</div>
      </div>
    `}renderImageBlock(t){var s;const e=((s=t.mediaType)==null?void 0:s.trim())||"application/octet-stream",i=this.resolveMediaSource(e,t.mediaData);return i?`
      <div class="thinkt-media-block thinkt-media-block--image">
        <div class="thinkt-media-block__header">
          <span class="thinkt-media-block__label">${c._("Image")}</span>
          <span class="thinkt-media-block__type">${w(e)}</span>
        </div>
        <div class="thinkt-media-block__content">
          <img
            class="thinkt-media-block__image"
            src="${w(i)}"
            alt="${w(c._("Embedded image"))}"
            loading="lazy"
          />
        </div>
      </div>
    `:`
        <div class="thinkt-media-block thinkt-media-block--image">
          <div class="thinkt-media-block__header">
            <span class="thinkt-media-block__label">${c._("Image")}</span>
            <span class="thinkt-media-block__type">${w(e)}</span>
          </div>
          <div class="thinkt-media-block__content">
            <div class="thinkt-media-block__empty">${c._("No image data available")}</div>
          </div>
        </div>
      `}renderDocumentBlock(t){var o,a;const e=((o=t.mediaType)==null?void 0:o.trim())||"application/octet-stream",i=this.resolveMediaSource(e,t.mediaData),s=((a=t.filename)==null?void 0:a.trim())||this.getDefaultDocumentFilename(e),n=i?`
          <a
            class="thinkt-media-block__link"
            href="${w(i)}"
            download="${w(s)}"
            target="_blank"
            rel="noopener noreferrer"
          >${c._("Download")}</a>
        `:`<span class="thinkt-media-block__empty">${c._("No document data available")}</span>`;return`
      <div class="thinkt-media-block thinkt-media-block--document">
        <div class="thinkt-media-block__header">
          <span class="thinkt-media-block__label">${c._("Document")}</span>
          <span class="thinkt-media-block__type">${w(e)}</span>
        </div>
        <div class="thinkt-media-block__content">
          <div class="thinkt-media-block__filename">${w(s)}</div>
          ${n}
        </div>
      </div>
    `}resolveMediaSource(t,e){const i=e.trim();return i?/^(data:|blob:|https?:)/i.test(i)?i:`data:${t};base64,${i}`:""}getDefaultDocumentFilename(t){return t==="application/pdf"?"document.pdf":t==="text/plain"?"document.txt":t==="application/json"?"document.json":t==="text/markdown"?"document.md":"document.bin"}renderThinkingBlock(t,e){const i=Q(e),s=i?`<span class="thinkt-thinking-block__duration">(${w(i)})</span>`:"",n=t.replace(/\n/g," ").slice(0,80),o=n?`<span class="thinkt-thinking-block__preview">${w(n)}${t.length>80?"â€¦":""}</span>`:"";return`
      <div class="thinkt-thinking-block" data-type="thinking">
        <div class="thinkt-thinking-block__header">
          <span class="thinkt-thinking-block__toggle">â–¶</span>
          <span class="thinkt-thinking-block__label">${c._("Thinking")}</span>
          ${s}
          ${o}
        </div>
        <div class="thinkt-thinking-block__content">${w(t)}</div>
      </div>
    `}renderToolCall(t,e,i){const s=Ft(e,i),n=s?`<span class="thinkt-tool-call__arg">(${w(s)})</span>`:"",o=this.toolResultIndex.get(t);let a,l="",h="";if(o){this.inlinedToolResults.add(t),o.isError?a='<span class="thinkt-tool-call__status thinkt-tool-call__status--error">âœ—</span>':a='<span class="thinkt-tool-call__status thinkt-tool-call__status--ok">âœ“</span>';const u=Q(o.durationMs);u&&(h=`<span class="thinkt-tool-call__duration">${w(u)}</span>`);const g=o.isError?" thinkt-tool-call__detail-result--error":"",m=o.isError?c._("Error"):c._("Result");l=`
        <div class="thinkt-tool-call__detail-section thinkt-tool-call__detail-result${g}">
          <div class="thinkt-tool-call__detail-label">${m}</div>
          <div class="thinkt-tool-call__detail-content">${w(String(o.toolResult||""))}<button class="thinkt-copy-btn thinkt-copy-btn--float" data-copy-action="detail">${c._("Copy")}</button></div>
        </div>
      `}else a='<span class="thinkt-tool-call__status thinkt-tool-call__status--pending">â€¢</span>';const p=w(JSON.stringify(i,null,2));return`
      <div class="thinkt-tool-call" data-type="toolUse" data-tool-use-id="${w(t)}">
        <div class="thinkt-tool-call__summary">
          <span class="thinkt-tool-call__toggle">â–¶</span>
          <span class="thinkt-tool-call__bullet">â€¢</span>
          <span class="thinkt-tool-call__name">${w(e)}</span>
          ${n}
          ${h}
          ${a}
        </div>
        <div class="thinkt-tool-call__detail">
          <div class="thinkt-tool-call__detail-section">
            <div class="thinkt-tool-call__detail-label">${c._("Input")}</div>
            <div class="thinkt-tool-call__detail-content">${p}<button class="thinkt-copy-btn thinkt-copy-btn--float" data-copy-action="detail">${c._("Copy")}</button></div>
          </div>
          ${l}
        </div>
      </div>
    `}showEmpty(){this.currentEntries=[],this.hasLoadedSession=!1,this.contentContainer.innerHTML=`
      <div class="thinkt-conversation-empty">
        <div class="thinkt-conversation-empty__icon">ðŸ’¬</div>
        <div class="thinkt-conversation-empty__title">${c._("No conversation loaded")}</div>
        <div>${c._("Select a session to view the conversation")}</div>
      </div>
    `,this.renderFilterBar()}showSessionEmpty(){this.currentEntries=[],this.contentContainer.innerHTML=`
      <div class="thinkt-conversation-empty">
        <div class="thinkt-conversation-empty__icon">ðŸ“­</div>
        <div class="thinkt-conversation-empty__title">${c._("This session has no conversation entries")}</div>
        <div>${c._("No messages were found in this session.")}</div>
      </div>
    `,this.renderFilterBar()}clear(){this.hasLoadedSession=!1,this.currentSessionSource=null,this.currentSessionModel=null,this.showEmpty()}refreshToolbar(){this.renderToolbar()}refreshI18n(){if(this.renderToolbar(),this.currentEntries.length===0){this.hasLoadedSession?this.showSessionEmpty():this.showEmpty();return}const t=this.contentContainer.scrollTop;this.displayEntries(this.currentEntries),requestAnimationFrame(()=>{this.contentContainer.scrollTop=t})}scrollToEntry(t){const e=this.contentContainer.querySelector(`[data-entry-index="${t}"]`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("thinkt-conversation-entry--highlighted"),setTimeout(()=>{e.classList.remove("thinkt-conversation-entry--highlighted")},js))}scrollToTop(){this.contentContainer.scrollTop=0}dispose(){this.abortController.abort(),this.container.replaceChildren()}}const Ls='.thinkt-tree-browser{display:flex;flex-direction:column;height:100%;font-family:var(--thinkt-font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif);color:var(--thinkt-text-color, #e0e0e0);background:var(--thinkt-bg-color, #1a1a1a);overflow:hidden}.thinkt-tree-header{padding:12px;border-bottom:1px solid var(--thinkt-border-color, #333);display:flex;align-items:center;justify-content:space-between}.thinkt-tree-view-toggle{display:flex;gap:2px;background:var(--thinkt-bg-tertiary, #181a1f);padding:2px;border-radius:4px}.thinkt-tree-view-btn{background:transparent;border:none;padding:4px 8px;cursor:pointer;border-radius:3px;font-size:12px;opacity:.6;transition:all .15s ease}.thinkt-tree-view-btn:hover{opacity:.9;background:var(--thinkt-hover-bg, #333)}.thinkt-tree-view-btn.active{opacity:1;background:var(--thinkt-bg-secondary, #1a1a1a);box-shadow:0 1px 2px #0000004d}.thinkt-tree-title{font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--thinkt-muted-color, #888)}.thinkt-tree-content{flex:1;overflow-y:auto;padding:8px}.thinkt-tree-empty{padding:48px 24px;text-align:center;color:var(--thinkt-muted-color, #666)}.thinkt-tree-empty-icon{font-size:32px;margin-bottom:12px;opacity:.5}.thinkt-tree-project{margin-bottom:4px}.thinkt-tree-project-header{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:6px;cursor:pointer;transition:background-color .15s ease;-webkit-user-select:none;user-select:none}.thinkt-tree-project-header:hover,.thinkt-tree-project-header.expanded{background:var(--thinkt-hover-bg, #252525)}.thinkt-tree-chevron{font-size:10px;color:var(--thinkt-muted-color, #666);transition:transform .2s ease;width:12px;text-align:center}.thinkt-tree-chevron.expanded{transform:rotate(90deg)}.thinkt-tree-folder-icon{font-size:14px;color:var(--thinkt-accent-color, #6366f1)}.thinkt-tree-project-name{flex:1;font-size:13px;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.thinkt-tree-project-meta{font-size:11px;color:var(--thinkt-muted-color, #666);display:flex;align-items:center;gap:6px}.thinkt-tree-badge{font-size:10px;padding:1px 5px;border-radius:3px;background:var(--thinkt-bg-tertiary, #181a1f);color:var(--thinkt-muted-color, #888)}.thinkt-tree-source{margin-left:20px;margin-bottom:2px}.thinkt-tree-source-header{display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:4px;cursor:pointer;transition:background-color .15s ease;-webkit-user-select:none;user-select:none}.thinkt-tree-source-header:hover{background:var(--thinkt-hover-bg, #252525)}.thinkt-tree-source-icon{font-size:12px;width:16px;text-align:center}.thinkt-tree-source-icon--claude{color:var(--thinkt-source-claude-color, #d97750)}.thinkt-tree-source-icon--kimi{color:var(--thinkt-source-kimi-color, #19c39b)}.thinkt-tree-source-icon--gemini{color:var(--thinkt-source-gemini-color, #6366f1)}.thinkt-tree-source-name{flex:1;font-size:12px;color:var(--thinkt-text-secondary, #94a3b8);text-transform:capitalize}.thinkt-tree-source-count{font-size:10px;color:var(--thinkt-muted-color, #666)}.thinkt-tree-sessions{margin-left:36px}.thinkt-tree-sessions--flat{margin-left:20px}.thinkt-tree-session-source{font-size:9px;padding:1px 4px;border-radius:3px;background:var(--thinkt-bg-tertiary, #181a1f);color:var(--thinkt-muted-color, #888);text-transform:uppercase;margin-left:4px}.thinkt-tree-session-source--claude{color:var(--thinkt-source-claude-color, #d97750)}.thinkt-tree-session-source--kimi{color:var(--thinkt-source-kimi-color, #19c39b)}.thinkt-tree-session-source--gemini{color:var(--thinkt-source-gemini-color, #6366f1)}.thinkt-tree-session{display:flex;align-items:center;gap:6px;padding:5px 10px;border-radius:4px;cursor:pointer;transition:background-color .12s ease;margin-bottom:1px}.thinkt-tree-session:hover{background:var(--thinkt-hover-bg, #252525)}.thinkt-tree-session.selected{background:var(--thinkt-selected-bg, rgba(99, 102, 241, .15));border-left:2px solid var(--thinkt-accent-color, #6366f1);margin-left:-2px}.thinkt-tree-session-icon{font-size:10px;color:var(--thinkt-muted-color, #666)}.thinkt-tree-session-title{flex:1;font-size:11px;color:var(--thinkt-text-secondary, #94a3b8);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.thinkt-tree-session-time{font-size:10px;color:var(--thinkt-muted-color, #666)}.thinkt-tree-session--loading{padding:6px 12px 6px 48px;font-size:11px;color:var(--thinkt-muted-color, #666);font-style:italic}.thinkt-tree-loading,.thinkt-tree-error{padding:48px;text-align:center;color:var(--thinkt-muted-color, #666)}.thinkt-tree-retry{margin-top:12px;padding:6px 16px;background:transparent;border:1px solid var(--thinkt-border-color, #333);border-radius:4px;color:inherit;cursor:pointer;font-size:12px}.thinkt-tree-retry:hover{background:var(--thinkt-hover-bg, #252525)}';class Is{constructor(t){d(this,"options");d(this,"client");d(this,"container");d(this,"contentContainer");d(this,"headerContainer");d(this,"projectGroups",new Map);d(this,"expandedProjects",new Set);d(this,"expandedSources",new Set);d(this,"selectedSessionId",null);d(this,"filters");d(this,"showAllWhenNoSourceSelected");d(this,"lastLoadedIncludeDeleted",!1);d(this,"loadController",null);d(this,"abortController",new AbortController);d(this,"viewMode","hierarchical");this.options=t,this.client=t.client??B(),this.container=t.elements.container,this.contentContainer=document.createElement("div"),this.headerContainer=document.createElement("div"),this.viewMode=t.initialViewMode??"hierarchical",this.filters=t.filters??{searchQuery:"",sources:new Set,sort:"date_desc",includeDeleted:!1},this.showAllWhenNoSourceSelected=t.filters===void 0,this.init()}init(){N("thinkt-tree-browser-styles",Ls),this.createStructure(),this.loadData(),window.addEventListener("thinkt:locale-changed",()=>this.refreshI18n(),{signal:this.abortController.signal})}createStructure(){this.container.className="thinkt-tree-browser",this.container.replaceChildren(),this.headerContainer.className="thinkt-tree-header",this.headerContainer.innerHTML=`
      <span class="thinkt-tree-title">${c._("Projects")}</span>
      <div class="thinkt-tree-view-toggle">
        <button class="thinkt-tree-view-btn ${this.viewMode==="hierarchical"?"active":""}" 
                data-mode="hierarchical" title="${c._("Group by source")}">
          <span class="thinkt-tree-view-icon">ðŸ“‚</span>
        </button>
        <button class="thinkt-tree-view-btn ${this.viewMode==="flat"?"active":""}" 
                data-mode="flat" title="${c._("Flat list")}">
          <span class="thinkt-tree-view-icon">ðŸ“„</span>
        </button>
      </div>
    `,this.container.appendChild(this.headerContainer),this.headerContainer.querySelectorAll(".thinkt-tree-view-btn").forEach(t=>{const e=()=>{const i=t.dataset.mode;this.setViewMode(i)};t.addEventListener("click",e,{signal:this.abortController.signal})}),this.contentContainer.className="thinkt-tree-content",this.container.appendChild(this.contentContainer),this.showLoading()}get isLoading(){return this.loadController!==null&&!this.loadController.signal.aborted}async loadData(){var e,i,s;(e=this.loadController)==null||e.abort();const t=new AbortController;this.loadController=t,this.showLoading();try{const n=await this.client.getProjects(void 0,{includeDeleted:this.filters.includeDeleted,signal:t.signal});if(t.signal.aborted)return;if(this.lastLoadedIncludeDeleted=this.filters.includeDeleted,this.projectGroups=this.groupProjectsByPath(n),this.projectGroups.size<=3)for(const o of this.projectGroups.keys())this.expandedProjects.add(o);this.render()}catch(n){if(t.signal.aborted)return;const o=n instanceof Error?n:new Error(String(n));this.showError(o),(s=(i=this.options).onError)==null||s.call(i,o)}finally{this.loadController===t&&(this.loadController=null)}}groupProjectsByPath(t){const e=new Map;for(const i of t){if(!i.path)continue;const s=i.displayPath||i.path,n=i.name||this.extractProjectName(s),o=this.normalizeProjectPath(s);let a=e.get(o);a||(a={path:o,name:n,sources:new Map,totalSessions:0,lastModified:new Date(0)},e.set(o,a));const l=i.source||"unknown";if(a.sources.has(l)||a.sources.set(l,{source:l,project:i,sessions:[],loaded:!1,loading:!1}),a.totalSessions+=i.sessionCount||0,i.lastModified){const h=new Date(i.lastModified);h>a.lastModified&&(a.lastModified=h)}}return e}extractProjectName(t){const e=t.split(/[/\\]/).filter(i=>i&&i!=="."&&i!=="..");for(;e.length>1;){const i=e[e.length-1],s=e[e.length-2];if(["projects","workspaces","repos","src"].includes(s)||!i.startsWith(".")&&i.length>2)return i;e.pop()}return e[e.length-1]||"Unknown"}normalizeProjectPath(t){let e=t.replace(/^~\//,"/").replace(/\\/g,"/");const i=[/\.claude\/projects\//,/\.kimi\/projects\//,/\.thinkt\/projects\//];for(const s of i)e=e.replace(s,"");return e}async loadSessionsForSource(t,e){if(!(e.loaded||e.loading||!e.project.id)){e.loading=!0,this.render();try{const i=await this.client.getSessions(e.project.id,e.source);i.sort((s,n)=>{var l,h;const o=((l=s.modifiedAt)==null?void 0:l.getTime())||0;return(((h=n.modifiedAt)==null?void 0:h.getTime())||0)-o}),e.sessions=i,e.loaded=!0}catch(i){console.warn("[THINKT] Failed to load sessions for source:",e.source,i),e.sessions=[],e.loaded=!0}finally{e.loading=!1;let i=0;for(const s of t.sources.values())i+=s.loaded?s.sessions.length:s.project.sessionCount||0;t.totalSessions=i,this.render()}}}render(){const t=this.getFilteredProjectGroups();if(t.length===0){this.showEmpty(this.hasActiveFilters()&&this.projectGroups.size>0?c._("No projects match your filter"):c._("No projects found"));return}this.contentContainer.replaceChildren();const e=t.sort((i,s)=>this.compareProjectGroups(i,s));for(const i of e){const s=this.renderProjectGroup(i);this.contentContainer.appendChild(s)}}renderProjectGroup(t){const e=this.expandedProjects.has(t.path),i=document.createElement("div");i.className="thinkt-tree-project";const s=document.createElement("div");s.className=`thinkt-tree-project-header ${e?"expanded":""}`;const n=this.viewMode==="hierarchical"?`<span class="thinkt-tree-badge">${c._("{count, plural, one {# source} other {# sources}}",{count:t.sources.size})}</span>
         <span class="thinkt-tree-badge">${c._("{count, plural, one {# session} other {# sessions}}",{count:t.totalSessions})}</span>`:`<span class="thinkt-tree-badge">${c._("{count, plural, one {# session} other {# sessions}}",{count:t.totalSessions})}</span>`;return s.innerHTML=`
      <span class="thinkt-tree-chevron ${e?"expanded":""}">â–¶</span>
      <span class="thinkt-tree-folder-icon">ðŸ“</span>
      <span class="thinkt-tree-project-name" title="${this.escapeHtml(t.path)}">${this.escapeHtml(t.name)}</span>
      <span class="thinkt-tree-project-meta">
        ${n}
      </span>
    `,s.addEventListener("click",()=>{e?this.expandedProjects.delete(t.path):this.expandedProjects.add(t.path),this.render()}),i.appendChild(s),e&&(this.viewMode==="hierarchical"?i.appendChild(this.renderHierarchicalChildren(t)):i.appendChild(this.renderFlatChildren(t))),i}renderHierarchicalChildren(t){const e=document.createElement("div");e.className="thinkt-tree-sources";const i=Array.from(t.sources.values()).sort((s,n)=>{const o={claude:0,kimi:1,gemini:2,copilot:3,thinkt:4};return(o[s.source]??99)-(o[n.source]??99)});for(const s of i){const n=this.renderSourceGroup(t,s);e.appendChild(n)}return e}renderFlatChildren(t){const e=document.createElement("div");e.className="thinkt-tree-sessions thinkt-tree-sessions--flat";let i=!1;for(const n of t.sources.values())!n.loaded&&!n.loading&&this.loadSessionsForSource(t,n),n.loading&&(i=!0);if(i){const n=document.createElement("div");return n.className="thinkt-tree-session thinkt-tree-session--loading",n.textContent=c._("Loading sessionsâ€¦"),e.appendChild(n),e}const s=[];for(const n of t.sources.values())for(const o of n.sessions)s.push({session:o,source:n.source});s.sort((n,o)=>{var h,p;const a=((h=n.session.modifiedAt)==null?void 0:h.getTime())||0;return(((p=o.session.modifiedAt)==null?void 0:p.getTime())||0)-a});for(const{session:n,source:o}of s){const a=this.renderSession(n,t,o);e.appendChild(a)}return e}renderSourceGroup(t,e){const i=`${t.path}::${e.source}`,s=this.expandedSources.has(i),n=document.createElement("div");n.className="thinkt-tree-source";const o=document.createElement("div");o.className="thinkt-tree-source-header";const a=this.getSourceIcon(e.source),l=e.loaded?e.sessions.length:e.project.sessionCount||0;if(o.innerHTML=`
      <span class="thinkt-tree-chevron ${s?"expanded":""}">â–¶</span>
      <span class="thinkt-tree-source-icon thinkt-tree-source-icon--${e.source}">${a}</span>
      <span class="thinkt-tree-source-name">${this.escapeHtml(e.source)}</span>
      <span class="thinkt-tree-source-count">${l}</span>
    `,o.addEventListener("click",()=>{s?this.expandedSources.delete(i):(this.expandedSources.add(i),!e.loaded&&!e.loading&&this.loadSessionsForSource(t,e)),this.render()}),n.appendChild(o),s){const h=document.createElement("div");if(h.className="thinkt-tree-sessions",e.loading){const p=document.createElement("div");p.className="thinkt-tree-session thinkt-tree-session--loading",p.textContent=c._("Loading sessionsâ€¦"),h.appendChild(p)}else for(const p of e.sessions){const u=this.renderSession(p,t);h.appendChild(u)}n.appendChild(h)}return n}renderSession(t,e,i){var l;const s=document.createElement("div");s.className="thinkt-tree-session",t.id===this.selectedSessionId&&s.classList.add("selected");const n=t.firstPrompt?t.firstPrompt.slice(0,50)+(t.firstPrompt.length>50?"...":""):((l=t.id)==null?void 0:l.slice(0,8))||"Unknown",o=t.modifiedAt?this.formatRelativeTime(t.modifiedAt):"",a=i&&this.viewMode==="flat"?`<span class="thinkt-tree-session-source thinkt-tree-session-source--${i}">${this.escapeHtml(i)}</span>`:"";return s.innerHTML=`
      <span class="thinkt-tree-session-icon">ðŸ’¬</span>
      <span class="thinkt-tree-session-title" title="${this.escapeHtml(t.firstPrompt||"")}">${this.escapeHtml(n)}</span>
      ${a}
      ${o?`<span class="thinkt-tree-session-time">${o}</span>`:""}
    `,s.addEventListener("click",()=>{this.selectSession(t,e)}),s}getSourceIcon(t){return{claude:"â—‰",kimi:"â—‰",gemini:"â—‰",copilot:"â—‰",thinkt:"â—‰"}[t]||"â—‰"}formatRelativeTime(t){const e=t instanceof Date?t:new Date(t),s=new Date().getTime()-e.getTime(),n=Math.floor(s/1e3),o=Math.floor(n/60),a=Math.floor(o/60),l=Math.floor(a/24);return n<60?c._("now"):o<60?`${o}m`:a<24?`${a}h`:l<7?`${l}d`:e.toLocaleDateString(void 0,{month:"short",day:"numeric"})}selectSession(t,e){var i,s;this.selectedSessionId=t.id||null,this.render(),(s=(i=this.options).onSessionSelect)==null||s.call(i,t,e)}showLoading(){this.contentContainer.innerHTML=`
      <div class="thinkt-tree-loading">
        <div>${c._("Loading projects...")}</div>
      </div>
    `}showEmpty(t=c._("No projects found")){this.contentContainer.innerHTML=`
      <div class="thinkt-tree-empty">
        <div class="thinkt-tree-empty-icon">ðŸ“</div>
        <div>${this.escapeHtml(t)}</div>
      </div>
    `}showError(t){this.contentContainer.innerHTML=`
      <div class="thinkt-tree-error">
        <div>${c._("Error: {message}",{message:this.escapeHtml(t.message)})}</div>
        <button class="thinkt-tree-retry">${c._("Retry")}</button>
      </div>
    `;const e=this.contentContainer.querySelector(".thinkt-tree-retry");e&&e.addEventListener("click",()=>{this.loadData()})}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}compareProjectGroups(t,e){const i=()=>(t.name||t.path).toLowerCase().localeCompare((e.name||e.path).toLowerCase()),s=()=>t.lastModified.getTime()-e.lastModified.getTime();switch(this.filters.sort){case"name_asc":return i();case"name_desc":return i()*-1;case"date_asc":{const n=s();return n!==0?n:i()}case"date_desc":default:{const n=s()*-1;return n!==0?n:i()}}}refresh(){return this.loadData()}applyFilters(){if(this.filters.includeDeleted!==this.lastLoadedIncludeDeleted){this.loadData();return}this.isLoading||this.render()}hasActiveFilters(){if(this.filters.searchQuery.length>0)return!0;if(this.showAllWhenNoSourceSelected&&this.filters.sources.size===0)return!1;const t=new Set;for(const e of this.projectGroups.values())for(const i of e.sources.keys())t.add(i.toLowerCase());if(t.size===0)return this.filters.sources.size>0;if(this.filters.sources.size!==t.size)return!0;for(const e of t)if(!this.filters.sources.has(e))return!0;return!1}getFilteredProjectGroups(){const t=this.filters.searchQuery.trim().toLowerCase(),e=this.filters.sources,i=[];for(const s of this.projectGroups.values()){const n=new Map;for(const[h,p]of s.sources){const u=h.toLowerCase();(this.showAllWhenNoSourceSelected&&e.size===0||e.has(u))&&n.set(h,p)}if(n.size===0||!(t.length===0||s.name.toLowerCase().includes(t)||s.path.toLowerCase().includes(t)||Array.from(n.values()).some(h=>h.source.toLowerCase().includes(t))))continue;let a=0,l=new Date(0);for(const h of n.values())if(a+=h.sessions.length,h.project.lastModified){const p=new Date(h.project.lastModified);p>l&&(l=p)}i.push({...s,sources:n,totalSessions:a,lastModified:l.getTime()>0?l:s.lastModified})}return i}refreshI18n(){this.createStructure(),this.render()}getViewMode(){return this.viewMode}setViewMode(t){this.viewMode!==t&&(this.viewMode=t,this.headerContainer.querySelectorAll(".thinkt-tree-view-btn").forEach(e=>{const i=e.dataset.mode;e.classList.toggle("active",i===t)}),this.render())}dispose(){var t;this.abortController.abort(),(t=this.loadController)==null||t.abort(),this.container.replaceChildren()}}const Rs='.thinkt-timeline{display:flex;flex-direction:column;height:100%;font-family:var(--thinkt-font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif);color:var(--thinkt-text-color, #e0e0e0);background:var(--thinkt-bg-color, #1a1a1a);overflow:hidden}.thinkt-timeline-header{padding:12px 16px;border-bottom:1px solid var(--thinkt-border-color, #333);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}.thinkt-timeline-title{font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--thinkt-muted-color, #888)}.thinkt-timeline-controls{display:flex;gap:8px;align-items:center}.thinkt-timeline-btn{font-size:11px;padding:4px 10px;background:var(--thinkt-bg-tertiary, #181a1f);border:1px solid var(--thinkt-border-color, #333);border-radius:4px;color:var(--thinkt-text-secondary, #94a3b8);cursor:pointer;transition:all .15s ease}.thinkt-timeline-btn:hover{background:var(--thinkt-hover-bg, #333)}.thinkt-timeline-btn.active{background:var(--thinkt-accent-color, #6366f1);border-color:var(--thinkt-accent-color, #6366f1);color:#fff}.thinkt-timeline-zoom{display:flex;align-items:center;gap:6px;margin-left:6px;padding-left:8px;border-left:1px solid var(--thinkt-border-color, #333)}.thinkt-timeline-zoom-preset{font-size:10px;padding:3px 6px;min-width:30px;background:var(--thinkt-bg-tertiary, #181a1f);border:1px solid var(--thinkt-border-color, #333);border-radius:3px;color:var(--thinkt-text-secondary, #94a3b8);cursor:pointer}.thinkt-timeline-zoom-preset:hover{background:var(--thinkt-hover-bg, #333)}.thinkt-timeline-scroll:focus-visible{outline:1px solid var(--thinkt-accent-color, #6366f1);outline-offset:-1px}.thinkt-timeline-scroll{position:absolute;top:0;right:0;bottom:0;left:0;overflow:auto}.thinkt-timeline-viewport{flex:1;position:relative;overflow:hidden}.thinkt-timeline-chart-content{position:relative;min-height:100%}.thinkt-timeline-time-axis{position:sticky;top:0;height:30px;background:transparent;border-bottom:1px solid var(--thinkt-border-color, #333);z-index:20}.thinkt-timeline-time-label{position:absolute;top:8px;font-size:10px;color:var(--thinkt-muted-color, #666);transform:translate(-50%);white-space:nowrap}.thinkt-timeline-source-content{min-width:100%;min-height:100%}.thinkt-timeline-source-header{position:sticky;top:0;height:30px;border-bottom:1px solid var(--thinkt-border-color, #333);background:var(--thinkt-bg-color, #1a1a1a);z-index:20}.thinkt-timeline-source-axis-corner{position:absolute;left:0;top:0;bottom:0;border-right:1px solid var(--thinkt-border-color, #2a2a2a)}.thinkt-timeline-source-header-label{position:absolute;top:8px;transform:translate(-50%);font-size:11px;font-weight:600;color:var(--thinkt-text-secondary, #94a3b8);white-space:nowrap}.thinkt-timeline-source-time-label{position:absolute;left:8px;transform:translateY(-50%);font-size:10px;color:var(--thinkt-muted-color, #666);white-space:nowrap;pointer-events:none}.thinkt-timeline-source-svg{display:block}.thinkt-timeline-chart-row{height:50px;border-bottom:1px solid var(--thinkt-border-color, #222);position:relative}.thinkt-timeline-chart-svg{display:block;height:100%}.thinkt-timeline-label-overlay{position:absolute;left:0;right:auto;top:0;bottom:0;width:140px;overflow:hidden;pointer-events:none;z-index:30}.thinkt-timeline-label-track{position:absolute;left:0;right:0;top:30px;will-change:transform}.thinkt-timeline-label-item{position:absolute;left:10px;right:8px;height:50px;display:flex;align-items:flex-start;padding-top:7px;font-size:11px;font-weight:500;line-height:1.1;color:var(--thinkt-text-secondary, #94a3b8);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;background:transparent}.thinkt-timeline-label-item.clickable{pointer-events:auto;cursor:pointer}.thinkt-timeline-label-item.clickable:hover{color:var(--thinkt-text-color, #e0e0e0)}.thinkt-timeline-tooltip{position:absolute;background:var(--thinkt-dropdown-bg, #1a1a1a);border:1px solid var(--thinkt-border-color, #333);border-radius:6px;padding:10px 12px;font-size:12px;pointer-events:none;z-index:100;box-shadow:0 4px 12px #00000080;max-width:280px}.thinkt-timeline-tooltip-title{font-weight:500;color:var(--thinkt-text-primary, #f0f0f0);margin-bottom:4px;line-height:1.3}.thinkt-timeline-tooltip-meta{color:var(--thinkt-muted-color, #888);font-size:11px}.thinkt-timeline-empty,.thinkt-timeline-loading,.thinkt-timeline-error{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:var(--thinkt-muted-color, #666);text-align:center;padding:48px}',zs=[{id:"1d",label:"1d"},{id:"1w",label:"1w"},{id:"all",label:"All"}],Ms={claude:"#d97750",kimi:"#19c39b",gemini:"#6366f1",copilot:"#0078d4",thinkt:"#888888"};class Ds{constructor(t){d(this,"options");d(this,"client");d(this,"container");d(this,"viewport");d(this,"scrollArea");d(this,"labelOverlay");d(this,"labelTrack");d(this,"allSessions",[]);d(this,"sessions",[]);d(this,"rows",[]);d(this,"sourceInfos",[]);d(this,"filters");d(this,"showAllWhenNoSourceSelected");d(this,"lastLoadedIncludeDeleted",!1);d(this,"tooltip",null);d(this,"isLoading",!1);d(this,"groupBy","project");d(this,"disposed",!1);d(this,"rafScrollSync",0);d(this,"hasInitialAlignment",!1);d(this,"hasUserNavigated",!1);d(this,"autoFollowUntilMs",0);d(this,"expectedScrollLeft",null);d(this,"expectedScrollTop",null);d(this,"suppressUserNavigationDetection",!1);d(this,"pendingZoomAnchor",null);d(this,"rowHeight",50);d(this,"blobRadius",6);d(this,"labelWidth",140);d(this,"labelPadding",16);d(this,"timeAxisHeight",30);d(this,"minChartWidth",640);d(this,"minChartHeight",480);d(this,"rightPadding",32);d(this,"sourceAxisWidth",64);d(this,"sourceColumnWidth",96);d(this,"sourceColumnGap",8);d(this,"defaultMsPerPixel",420*1e3);d(this,"minMsPerPixel",30*1e3);d(this,"maxMsPerPixel",1440*60*1e3);d(this,"maxConcurrentSessionFetches",6);d(this,"progressiveCommitDelayMs",80);d(this,"autoFollowGraceMs",3e3);d(this,"userScrollEpsilonPx",6);d(this,"zoomMsPerPixel",this.defaultMsPerPixel);d(this,"abortController",new AbortController);d(this,"handleScroll",()=>{if(!this.hasUserNavigated&&!this.suppressUserNavigationDetection){const t=this.expectedScrollLeft,e=this.expectedScrollTop,i=t===null?0:Math.abs(this.scrollArea.scrollLeft-t),s=e===null?0:Math.abs(this.scrollArea.scrollTop-e);(i>this.userScrollEpsilonPx||s>this.userScrollEpsilonPx)&&this.markUserNavigated()}this.groupBy==="project"&&this.rafScrollSync===0&&(this.rafScrollSync=window.requestAnimationFrame(()=>{this.rafScrollSync=0,this.updateLabelTrackPosition()}))});d(this,"handleWheel",t=>{if(!(t.ctrlKey||t.metaKey))return;this.markUserNavigated(),t.preventDefault();const e=Math.exp(t.deltaY*.0015),i=this.clampZoom(this.zoomMsPerPixel*e),s=this.scrollArea.getBoundingClientRect(),n=this.groupBy==="project"?t.clientX-s.left:t.clientY-s.top;this.setZoom(i,n)});d(this,"handleKeyDown",t=>{if(this.isEditableTarget(t.target))return;["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","PageUp","PageDown","Home","End"," "].includes(t.key)&&this.markUserNavigated();const e=this.groupBy==="project"?this.scrollArea.clientWidth/2:this.scrollArea.clientHeight/2;if(t.key==="+"||t.key==="="){t.preventDefault(),this.setZoom(this.zoomMsPerPixel*.85,e);return}if(t.key==="-"||t.key==="_"){t.preventDefault(),this.setZoom(this.zoomMsPerPixel*1.15,e);return}t.key==="0"&&(t.preventDefault(),this.setZoom(this.defaultMsPerPixel,e))});this.options=t,this.client=t.client??B(),this.groupBy=t.groupBy??"project",this.filters=t.filters??{searchQuery:"",sources:new Set,sort:"date_desc",includeDeleted:!1},this.showAllWhenNoSourceSelected=t.filters===void 0,this.container=t.elements.container,this.viewport=document.createElement("div"),this.scrollArea=document.createElement("div"),this.labelOverlay=document.createElement("div"),this.labelTrack=document.createElement("div"),this.init()}init(){N("thinkt-timeline-styles",Rs),this.createStructure(),this.loadData(),window.addEventListener("thinkt:locale-changed",()=>this.refreshI18n(),{signal:this.abortController.signal})}createStructure(){this.container.className="thinkt-timeline",this.container.innerHTML=`
      <div class="thinkt-timeline-header">
        <span class="thinkt-timeline-title">${c._("Timeline")}</span>
        <div class="thinkt-timeline-controls">
          <button class="thinkt-timeline-btn ${this.groupBy==="project"?"active":""}" data-group="project">${c._("By Project")}</button>
          <button class="thinkt-timeline-btn ${this.groupBy==="source"?"active":""}" data-group="source">${c._("By Source")}</button>
          <div class="thinkt-timeline-zoom">
            ${zs.map(i=>`<button class="thinkt-timeline-zoom-preset" data-zoom-preset="${i.id}">${i.label}</button>`).join("")}
          </div>
        </div>
      </div>
    `,this.viewport.className="thinkt-timeline-viewport",this.container.appendChild(this.viewport),this.scrollArea.className="thinkt-timeline-scroll",this.scrollArea.tabIndex=0,this.scrollArea.addEventListener("scroll",this.handleScroll,{signal:this.abortController.signal}),this.scrollArea.addEventListener("wheel",this.handleWheel,{passive:!1,signal:this.abortController.signal}),this.scrollArea.addEventListener("keydown",this.handleKeyDown,{signal:this.abortController.signal}),this.viewport.appendChild(this.scrollArea),this.labelOverlay.className="thinkt-timeline-label-overlay",this.labelTrack.className="thinkt-timeline-label-track",this.labelTrack.style.top=`${this.timeAxisHeight}px`,this.labelOverlay.appendChild(this.labelTrack),this.viewport.appendChild(this.labelOverlay);const t=this.container.querySelectorAll(".thinkt-timeline-btn");t.forEach(i=>{i.addEventListener("click",()=>{const s=i.dataset.group;this.setGroupBy(s),t.forEach(n=>n.classList.remove("active")),i.classList.add("active")})}),this.container.querySelectorAll(".thinkt-timeline-zoom-preset").forEach(i=>{i.addEventListener("click",()=>{const s=i.dataset.zoomPreset;this.applyZoomPreset(s)})}),this.tooltip=document.createElement("div"),this.tooltip.className="thinkt-timeline-tooltip",this.tooltip.style.display="none",document.body.appendChild(this.tooltip),this.showLoading()}markUserNavigated(){this.hasUserNavigated=!0,this.autoFollowUntilMs=0,this.expectedScrollLeft=null,this.expectedScrollTop=null,this.suppressUserNavigationDetection=!1}beginProgrammaticAlignment(){this.suppressUserNavigationDetection=!0,this.expectedScrollLeft=null,this.expectedScrollTop=null}endProgrammaticAlignment(){this.suppressUserNavigationDetection=!1}updateLabelTrackPosition(){if(this.groupBy!=="project")return;const t=this.scrollArea.scrollTop;this.labelTrack.style.transform=`translateY(${-t}px)`}isEditableTarget(t){if(!(t instanceof HTMLElement))return!1;const e=t.tagName.toLowerCase();return e==="input"||e==="textarea"||t.isContentEditable}clampZoom(t){return Math.min(this.maxMsPerPixel,Math.max(this.minMsPerPixel,t))}applyZoomPreset(t){if(this.sessions.length===0)return;const e=this.groupBy==="project"?Math.max(200,this.scrollArea.clientWidth-this.labelWidth-this.labelPadding-this.rightPadding):Math.max(200,this.scrollArea.clientHeight-this.timeAxisHeight-this.rightPadding);let i=this.zoomMsPerPixel;switch(t){case"1d":i=1440*60*1e3/e;break;case"1w":i=10080*60*1e3/e;break;case"all":{const n=this.getTimeRange();i=Math.max(1,n.end.getTime()-n.start.getTime())/e;break}}const s=this.groupBy==="project"?this.scrollArea.clientWidth/2:this.scrollArea.clientHeight/2;this.setZoom(i,s)}setZoom(t,e){if(this.sessions.length===0)return;const i=this.clampZoom(t);if(!(Math.abs(i-this.zoomMsPerPixel)<1e-4)){if(this.markUserNavigated(),this.groupBy==="project"){const s=this.computeLayout(this.zoomMsPerPixel),n=this.getTimeAtViewportX(s,e);this.pendingZoomAnchor={timeMs:n,viewportCoord:e,axis:"x"}}else{const s=this.computeVerticalLayout(this.zoomMsPerPixel),n=this.getTimeAtViewportY(s,e);this.pendingZoomAnchor={timeMs:n,viewportCoord:e,axis:"y"}}this.zoomMsPerPixel=i,this.render()}}getTimeAtViewportX(t,e){const n=(this.scrollArea.scrollLeft+e-t.timelineStartX)/t.pxPerMs,o=Math.min(t.totalDuration,Math.max(0,n));return t.timeRange.start.getTime()+o}getTimeAtViewportY(t,e){const n=(this.scrollArea.scrollTop+e-t.timelineStartY)/t.pxPerMs,o=Math.min(t.totalDuration,Math.max(0,n));return t.timeRange.end.getTime()-o}computeLayout(t){const e=this.getTimeRange(),i=Math.max(1,e.end.getTime()-e.start.getTime()),s=this.scrollArea.clientWidth||this.minChartWidth,n=Math.max(this.minChartWidth,Math.ceil(i/t)),o=this.labelWidth+this.labelPadding,a=n/i,l=o+n,h=Math.max(s+this.rightPadding,Math.ceil(l+this.rightPadding));return{timeRange:e,totalDuration:i,timelineStartX:o,pxPerMs:a,latestX:l,chartWidth:h}}computeVerticalLayout(t){const e=this.getTimeRange(),i=Math.max(1,e.end.getTime()-e.start.getTime()),s=this.scrollArea.clientWidth||this.minChartWidth,n=this.scrollArea.clientHeight||this.minChartHeight,o=Math.max(this.minChartHeight,Math.ceil(i/t)),a=this.timeAxisHeight+10,l=o/i,h=a+i*l,p=Math.max(1,this.rows.length),u=p*this.sourceColumnWidth+Math.max(0,p-1)*this.sourceColumnGap,g=this.sourceAxisWidth,m=Math.max(s+this.rightPadding,g+u+this.rightPadding),b=Math.max(n+this.rightPadding,Math.ceil(h+this.rightPadding));return{timeRange:e,totalDuration:i,timelineStartY:a,pxPerMs:l,latestY:h,chartWidth:m,chartHeight:b,timelineStartX:g,columnWidth:this.sourceColumnWidth,columnGap:this.sourceColumnGap}}normalizePath(t){return t.replace(/\\/g,"/").replace(/\/+$/,"").toLowerCase()}toTimestampMs(t){const e=t.getTime();return Number.isFinite(e)?e:0}inferSourceFromPath(t){const i=this.normalizePath(t).match(/\/\.([a-z0-9_-]+)(?:\/|$)/);if(!i)return null;const s=i[1];return!s||s==="config"||s==="cache"?null:s}detectSourceFromPaths(t){const e=t.filter(s=>typeof s=="string"&&s.trim().length>0).map(s=>this.normalizePath(s));if(e.length===0)return null;let i=null;for(const s of this.sourceInfos){const n=s.basePath;!n||!e.some(a=>a===n||a.startsWith(`${n}/`))||(!i||s.basePath.length>i.basePath.length)&&(i=s)}if(i)return i.name;for(const s of e){const n=this.inferSourceFromPath(s);if(n)return n}return null}resolveSource(t,e){const i=this.detectSourceFromPaths([t.fullPath,t.projectPath,e.path??null,e.sourceBasePath??null]);return i||(t.source||e.source||"").toString().trim().toLowerCase()||"unknown"}async loadSourceInfos(){try{const t=await this.client.getSources();this.sourceInfos=t.map(e=>{const i=(e.name??"").toString().trim().toLowerCase(),s=typeof e.base_path=="string"&&e.base_path.trim().length>0?this.normalizePath(e.base_path):"";return{name:i,basePath:s}}).filter(e=>e.name.length>0)}catch{this.sourceInfos=[]}}async loadData(){var e,i,s,n;if(this.isLoading||this.disposed)return;this.isLoading=!0,this.autoFollowUntilMs=Date.now()+this.autoFollowGraceMs,this.showLoading();let t=null;try{const[o]=await Promise.all([this.client.getProjects(void 0,{includeDeleted:this.filters.includeDeleted}),this.loadSourceInfos()]);this.lastLoadedIncludeDeleted=this.filters.includeDeleted;const a=[],l=new Set;let h=!1,p=!1;this.allSessions=[],this.sessions=[],this.rows=[],this.hasInitialAlignment=!1,this.hasUserNavigated=!1,this.expectedScrollLeft=null,this.expectedScrollTop=null,this.pendingZoomAnchor=null;const u=()=>{var k,y;this.disposed||(this.allSessions=a,(y=(k=this.options).onSourcesDiscovered)==null||y.call(k,Array.from(l)),this.applyFilters({preserveAlignment:!0}))},g=()=>{if(!this.disposed){if(!p){p=!0,u();return}h||(h=!0,t=window.setTimeout(()=>{h=!1,t=null,u()},this.progressiveCommitDelayMs))}},m=()=>{t!==null&&(window.clearTimeout(t),t=null),h=!1,u()},b=o.filter(k=>!!k.id);let f=0;const v=Math.max(1,Math.min(this.maxConcurrentSessionFetches,b.length)),x=async()=>{for(;!this.disposed;){const k=b[f];if(f+=1,!k||!k.id)return;try{const y=await this.client.getSessions(k.id,k.source??void 0);let S=!1;for(const $ of y){if(!$.modifiedAt)continue;const T=this.resolveSource($,{path:k.path??null,source:k.source??null,sourceBasePath:k.sourceBasePath??null});T.length>0&&l.add(T.trim().toLowerCase()),a.push({session:$,projectId:k.id,projectName:k.name||"Unknown",projectPath:k.path??null,source:T,timestamp:$.modifiedAt instanceof Date?$.modifiedAt:new Date($.modifiedAt)});const R=a[a.length-1].timestamp;if(!Number.isFinite(R.getTime())){a.pop();continue}S=!0}S&&g()}catch(y){console.warn("[THINKT] Failed to load sessions for project:",k.id,y)}}};if(await Promise.all(Array.from({length:v},()=>x())),a.sort((k,y)=>this.toTimestampMs(k.timestamp)-this.toTimestampMs(y.timestamp)),this.disposed)return;m(),this.allSessions=a,(i=(e=this.options).onSourcesDiscovered)==null||i.call(e,Array.from(l)),this.applyFilters({preserveAlignment:!0,force:!0})}catch(o){const a=o instanceof Error?o:new Error(String(o));this.showError(a),(n=(s=this.options).onError)==null||n.call(s,a)}finally{t!==null&&window.clearTimeout(t),this.isLoading=!1}}applyFilters(t){if(!(t!=null&&t.force)&&this.filters.includeDeleted!==this.lastLoadedIncludeDeleted){this.loadData();return}if(!(t!=null&&t.force)&&this.isLoading&&this.allSessions.length===0)return;const e=this.filters.searchQuery.trim().toLowerCase(),i=this.filters.sources,s=this.showAllWhenNoSourceSelected&&i.size===0;this.sessions=this.allSessions.filter(n=>{var o;return!s&&!i.has(n.source.toLowerCase())?!1:e?n.projectName.toLowerCase().includes(e)||n.source.toLowerCase().includes(e)||(((o=n.projectPath)==null?void 0:o.toLowerCase().includes(e))??!1):!0}),this.processRows(),t!=null&&t.preserveAlignment||(this.hasInitialAlignment=!1,this.pendingZoomAnchor=null),this.render()}shouldAutoFollow(){return this.hasUserNavigated?!1:this.isLoading?!0:Date.now()<=this.autoFollowUntilMs}setProgrammaticScrollPosition(t,e){t==="x"?(this.scrollArea.scrollLeft=Math.max(0,e),this.expectedScrollLeft=this.scrollArea.scrollLeft):(this.scrollArea.scrollTop=Math.max(0,e),this.expectedScrollTop=this.scrollArea.scrollTop)}processRows(){var e;const t=new Map;for(const i of this.sessions){const s=this.groupBy==="project"?`project:${i.projectId}`:`source:${i.source.toLowerCase()}`;t.has(s)||t.set(s,{projectId:this.groupBy==="project"?i.projectId:null,projectPath:this.groupBy==="project"?i.projectPath:null,projectSource:this.groupBy==="project"?i.source:null,label:this.groupBy==="project"?i.projectName:i.source,sessions:[]}),(e=t.get(s))==null||e.sessions.push(i)}this.rows=Array.from(t.values()).map(i=>({projectId:i.projectId,projectPath:i.projectPath,projectSource:i.projectSource,label:i.label,sessions:i.sessions.sort((s,n)=>this.toTimestampMs(s.timestamp)-this.toTimestampMs(n.timestamp)),color:this.groupBy==="source"?this.getSourceColor(i.label):i.projectSource?this.getSourceColor(i.projectSource):this.getDefaultColor(i.label)})),this.rows.sort((i,s)=>{const n=i.sessions[i.sessions.length-1]?this.toTimestampMs(i.sessions[i.sessions.length-1].timestamp):0,o=s.sessions[s.sessions.length-1]?this.toTimestampMs(s.sessions[s.sessions.length-1].timestamp):0;return o!==n?o-n:i.label.localeCompare(s.label)})}getSourceColor(t){const e=t.toLowerCase();return Ms[e]||this.getDefaultColor(t)}getDefaultColor(t){const e=["#6366f1","#d97750","#19c39b","#f59e0b","#ec4899","#8b5cf6","#06b6d4","#84cc16","#f97316","#ef4444"];let i=0;for(let s=0;s<t.length;s++)i=t.charCodeAt(s)+((i<<5)-i);return e[Math.abs(i)%e.length]}render(){if(this.sessions.length===0){this.showEmpty();return}if(this.scrollArea.replaceChildren(),this.labelTrack.replaceChildren(),this.groupBy==="source"){this.labelOverlay.style.display="none",this.renderVerticalSourceTimeline();return}this.labelOverlay.style.display="block",this.renderHorizontalProjectTimeline()}renderHorizontalProjectTimeline(){var h;const t=this.computeLayout(this.zoomMsPerPixel),e=((h=this.pendingZoomAnchor)==null?void 0:h.axis)==="x",i=!this.hasInitialAlignment||this.shouldAutoFollow(),s=e||i;s&&this.beginProgrammaticAlignment();const n=p=>{const u=p.getTime()-t.timeRange.start.getTime();return t.timelineStartX+u*t.pxPerMs},o=document.createElement("div");o.className="thinkt-timeline-chart-content",o.style.width=`${t.chartWidth}px`;const a=document.createElement("div");a.className="thinkt-timeline-time-axis",a.style.height=`${this.timeAxisHeight}px`,a.style.width=`${t.chartWidth}px`;const l=Math.max(4,Math.floor(t.chartWidth/220));for(let p=0;p<=l;p++){const u=new Date(t.timeRange.start.getTime()+(t.timeRange.end.getTime()-t.timeRange.start.getTime())*p/l),g=document.createElement("span");g.className="thinkt-timeline-time-label",g.style.left=`${n(u)}px`,g.textContent=this.formatTime(u),a.appendChild(g)}o.appendChild(a),this.rows.forEach(p=>{const u=document.createElement("div");u.className="thinkt-timeline-chart-row",u.style.width=`${t.chartWidth}px`;const g=document.createElementNS("http://www.w3.org/2000/svg","svg");g.setAttribute("class","thinkt-timeline-chart-svg"),g.setAttribute("width",String(t.chartWidth)),g.setAttribute("height",String(this.rowHeight));const m=this.rowHeight/2,b=document.createElementNS("http://www.w3.org/2000/svg","line");b.setAttribute("x1",String(t.timelineStartX)),b.setAttribute("y1",String(m)),b.setAttribute("x2",String(t.latestX)),b.setAttribute("y2",String(m)),b.setAttribute("stroke","var(--thinkt-border-color, #333)"),b.setAttribute("stroke-opacity","0.3"),g.appendChild(b);for(let f=0;f<p.sessions.length-1;f++){const v=p.sessions[f],x=p.sessions[f+1],k=document.createElementNS("http://www.w3.org/2000/svg","line");k.setAttribute("x1",String(n(v.timestamp))),k.setAttribute("y1",String(m)),k.setAttribute("x2",String(n(x.timestamp))),k.setAttribute("y2",String(m)),k.setAttribute("stroke",p.color),k.setAttribute("stroke-width","2"),k.setAttribute("opacity","0.35"),g.appendChild(k)}p.sessions.forEach(f=>{const v=document.createElementNS("http://www.w3.org/2000/svg","circle");v.setAttribute("cx",String(n(f.timestamp))),v.setAttribute("cy",String(m)),v.setAttribute("r",String(this.blobRadius)),v.setAttribute("fill",p.color),v.setAttribute("stroke","var(--thinkt-bg-color, #1a1a1a)"),v.setAttribute("stroke-width","2"),v.setAttribute("cursor","pointer"),v.addEventListener("mouseenter",x=>{v.setAttribute("r",String(this.blobRadius+2)),this.showTooltip(x,f)}),v.addEventListener("mouseleave",()=>{v.setAttribute("r",String(this.blobRadius)),this.hideTooltip()}),v.addEventListener("click",()=>{var x,k;(k=(x=this.options).onSessionSelect)==null||k.call(x,f.session)}),g.appendChild(v)}),u.appendChild(g),o.appendChild(u)}),this.renderLabelOverlay(),this.scrollArea.appendChild(o),this.updateLabelTrackPosition(),window.requestAnimationFrame(()=>{var p;if(!this.disposed)try{if(((p=this.pendingZoomAnchor)==null?void 0:p.axis)==="x"){const u=t.timelineStartX+(this.pendingZoomAnchor.timeMs-t.timeRange.start.getTime())*t.pxPerMs;this.setProgrammaticScrollPosition("x",u-this.pendingZoomAnchor.viewportCoord),this.pendingZoomAnchor=null,this.hasInitialAlignment=!0}else!this.hasInitialAlignment||this.shouldAutoFollow()?(this.setProgrammaticScrollPosition("x",this.scrollArea.scrollWidth-this.scrollArea.clientWidth),this.setProgrammaticScrollPosition("y",0),this.hasInitialAlignment=!0):this.pendingZoomAnchor&&(this.pendingZoomAnchor=null)}finally{s&&this.endProgrammaticAlignment()}})}renderVerticalSourceTimeline(){var b;const t=this.computeVerticalLayout(this.zoomMsPerPixel),e=((b=this.pendingZoomAnchor)==null?void 0:b.axis)==="y",i=!this.hasInitialAlignment||this.shouldAutoFollow(),s=e||i;s&&this.beginProgrammaticAlignment();const n=f=>{const v=t.timeRange.end.getTime()-f.getTime();return t.timelineStartY+v*t.pxPerMs},o=f=>t.timelineStartX+f*(t.columnWidth+t.columnGap)+t.columnWidth/2,a=t.timelineStartX+Math.max(1,this.rows.length)*t.columnWidth+Math.max(0,this.rows.length-1)*t.columnGap,l=document.createElement("div");l.className="thinkt-timeline-chart-content thinkt-timeline-source-content",l.style.width=`${t.chartWidth}px`,l.style.height=`${t.chartHeight}px`;const h=document.createElement("div");h.className="thinkt-timeline-source-header",h.style.width=`${t.chartWidth}px`,h.style.height=`${this.timeAxisHeight}px`;const p=document.createElement("div");p.className="thinkt-timeline-source-axis-corner",p.style.width=`${t.timelineStartX}px`,h.appendChild(p),this.rows.forEach((f,v)=>{const x=document.createElement("span");x.className="thinkt-timeline-source-header-label",x.style.left=`${o(v)}px`,x.title=f.label,x.textContent=this.truncateLabel(f.label,16),h.appendChild(x)}),l.appendChild(h);const u=Math.max(4,Math.floor(t.chartHeight/180));for(let f=0;f<=u;f++){const v=new Date(t.timeRange.end.getTime()-(t.timeRange.end.getTime()-t.timeRange.start.getTime())*f/u),x=n(v),k=document.createElement("span");k.className="thinkt-timeline-source-time-label",k.style.top=`${x}px`,k.textContent=this.formatTime(v),l.appendChild(k)}const g=document.createElementNS("http://www.w3.org/2000/svg","svg");g.setAttribute("class","thinkt-timeline-source-svg"),g.setAttribute("width",String(t.chartWidth)),g.setAttribute("height",String(t.chartHeight));const m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",String(t.timelineStartX)),m.setAttribute("y1",String(t.timelineStartY)),m.setAttribute("x2",String(t.timelineStartX)),m.setAttribute("y2",String(t.latestY)),m.setAttribute("stroke","var(--thinkt-border-color, #333)"),m.setAttribute("stroke-opacity","0.35"),g.appendChild(m);for(let f=0;f<=u;f++){const v=new Date(t.timeRange.end.getTime()-(t.timeRange.end.getTime()-t.timeRange.start.getTime())*f/u),x=n(v),k=document.createElementNS("http://www.w3.org/2000/svg","line");k.setAttribute("x1",String(t.timelineStartX)),k.setAttribute("y1",String(x)),k.setAttribute("x2",String(a)),k.setAttribute("y2",String(x)),k.setAttribute("stroke","var(--thinkt-border-color, #333)"),k.setAttribute("stroke-opacity","0.25"),g.appendChild(k)}this.rows.forEach((f,v)=>{const x=o(v),k=document.createElementNS("http://www.w3.org/2000/svg","line");k.setAttribute("x1",String(x)),k.setAttribute("y1",String(t.timelineStartY)),k.setAttribute("x2",String(x)),k.setAttribute("y2",String(t.latestY)),k.setAttribute("stroke","var(--thinkt-border-color, #333)"),k.setAttribute("stroke-opacity","0.25"),g.appendChild(k);for(let y=0;y<f.sessions.length-1;y++){const S=f.sessions[y],$=f.sessions[y+1],T=document.createElementNS("http://www.w3.org/2000/svg","line");T.setAttribute("x1",String(x)),T.setAttribute("y1",String(n(S.timestamp))),T.setAttribute("x2",String(x)),T.setAttribute("y2",String(n($.timestamp))),T.setAttribute("stroke",f.color),T.setAttribute("stroke-width","2"),T.setAttribute("opacity","0.4"),g.appendChild(T)}f.sessions.forEach(y=>{const S=document.createElementNS("http://www.w3.org/2000/svg","circle");S.setAttribute("cx",String(x)),S.setAttribute("cy",String(n(y.timestamp))),S.setAttribute("r",String(this.blobRadius)),S.setAttribute("fill",f.color),S.setAttribute("stroke","var(--thinkt-bg-color, #1a1a1a)"),S.setAttribute("stroke-width","2"),S.setAttribute("cursor","pointer"),S.addEventListener("mouseenter",$=>{S.setAttribute("r",String(this.blobRadius+2)),this.showTooltip($,y)}),S.addEventListener("mouseleave",()=>{S.setAttribute("r",String(this.blobRadius)),this.hideTooltip()}),S.addEventListener("click",()=>{var $,T;(T=($=this.options).onSessionSelect)==null||T.call($,y.session)}),g.appendChild(S)})}),l.appendChild(g),this.scrollArea.appendChild(l),window.requestAnimationFrame(()=>{var f;if(!this.disposed)try{if(((f=this.pendingZoomAnchor)==null?void 0:f.axis)==="y"){const v=t.timelineStartY+(t.timeRange.end.getTime()-this.pendingZoomAnchor.timeMs)*t.pxPerMs;this.setProgrammaticScrollPosition("y",v-this.pendingZoomAnchor.viewportCoord),this.pendingZoomAnchor=null,this.hasInitialAlignment=!0}else!this.hasInitialAlignment||this.shouldAutoFollow()?(this.setProgrammaticScrollPosition("x",0),this.setProgrammaticScrollPosition("y",0),this.hasInitialAlignment=!0):this.pendingZoomAnchor&&(this.pendingZoomAnchor=null)}finally{s&&this.endProgrammaticAlignment()}})}renderLabelOverlay(){this.labelTrack.replaceChildren(),this.rows.forEach((t,e)=>{const i=document.createElement("div");if(i.className="thinkt-timeline-label-item",i.style.top=`${e*this.rowHeight}px`,i.title=t.label,this.groupBy==="project"&&t.projectSource){const s=document.createElement("span");s.textContent=this.truncateLabel(t.label,14);const n=document.createElement("span");n.textContent=`(${t.projectSource})`,n.style.fontWeight="normal",n.style.opacity="0.6",n.style.marginLeft="4px",i.appendChild(s),i.appendChild(n)}else i.textContent=this.truncateLabel(t.label,18);this.groupBy==="project"&&t.projectId&&(i.classList.add("clickable"),i.addEventListener("click",()=>{var s,n;(n=(s=this.options).onProjectSelect)==null||n.call(s,{projectId:t.projectId,projectName:t.label,projectPath:t.projectPath,projectSource:t.projectSource??void 0})})),this.labelTrack.appendChild(i)})}getTimeRange(){const t=this.sessions.map(o=>o.timestamp.getTime()),e=Math.min(...t),i=Math.max(...t),s=this.groupBy==="project"?Math.max(i,Date.now()):i,n=(s-e)*.02||6e4;return{start:new Date(e-n),end:new Date(s)}}formatTime(t){const e=new Date;return t.toDateString()===e.toDateString()?t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString(void 0,{month:"short",day:"numeric"})}showTooltip(t,e){var n;if(!this.tooltip)return;const i=e.session.firstPrompt?`${e.session.firstPrompt.slice(0,100)}${e.session.firstPrompt.length>100?"...":""}`:((n=e.session.id)==null?void 0:n.slice(0,8))||"Unknown";this.tooltip.innerHTML=`
      <div class="thinkt-timeline-tooltip-title">${this.escapeHtml(i)}</div>
      <div class="thinkt-timeline-tooltip-meta">
        ${this.escapeHtml(e.projectName)} Â· ${this.escapeHtml(e.source)} Â· ${e.timestamp.toLocaleString()}
      </div>
    `,this.tooltip.style.display="block";const s=t.target.getBoundingClientRect();this.tooltip.style.left=`${s.left}px`,this.tooltip.style.top=`${s.bottom+8}px`}hideTooltip(){this.tooltip&&(this.tooltip.style.display="none")}showLoading(){this.scrollArea.innerHTML=`
      <div class="thinkt-timeline-loading">
        <div>${c._("Loading timeline...")}</div>
      </div>
    `}showEmpty(){this.scrollArea.innerHTML=`
      <div class="thinkt-timeline-empty">
        <div>${c._("No sessions to display")}</div>
      </div>
    `}showError(t){this.scrollArea.innerHTML=`
      <div class="thinkt-timeline-error">
        <div>${c._("Error: {message}",{message:this.escapeHtml(t.message)})}</div>
      </div>
    `}truncateLabel(t,e){return t.length<=e?t:`${t.slice(0,e-3)}...`}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}setGroupBy(t){this.groupBy!==t&&(this.groupBy=t,this.processRows(),this.hasInitialAlignment=!1,this.hasUserNavigated=!1,this.expectedScrollLeft=null,this.expectedScrollTop=null,this.pendingZoomAnchor=null,this.render())}refresh(){return this.loadData()}refreshI18n(){this.createStructure(),this.render()}dispose(){this.disposed||(this.disposed=!0,this.abortController.abort(),this.rafScrollSync!==0&&(window.cancelAnimationFrame(this.rafScrollSync),this.rafScrollSync=0),this.tooltip&&(this.tooltip.remove(),this.tooltip=null),this.container.replaceChildren())}}const Ns='.thinkt-project-timeline{display:flex;flex-direction:column;height:100%;font-family:var(--thinkt-font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif);color:var(--thinkt-text-color, #e0e0e0);background:var(--thinkt-bg-secondary, #141414);border-top:1px solid var(--thinkt-border-color, #2a2a2a)}.thinkt-project-timeline-header{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;border-bottom:1px solid var(--thinkt-border-color, #2a2a2a);background:var(--thinkt-bg-tertiary, #181a1f);flex-shrink:0}.thinkt-project-timeline-title{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--thinkt-muted-color, #888);display:flex;align-items:center;gap:8px}.thinkt-project-timeline-close{background:none;border:none;color:var(--thinkt-muted-color, #666);cursor:pointer;font-size:16px;padding:2px 6px;border-radius:4px;line-height:1}.thinkt-project-timeline-close:hover{background:var(--thinkt-hover-bg, #252525);color:var(--thinkt-text-secondary, #94a3b8)}.thinkt-project-timeline-content{flex:1;overflow:auto;padding:12px}.thinkt-project-timeline-svg{width:100%;min-width:400px}.thinkt-project-timeline-legend{display:flex;gap:16px;padding:8px 12px;border-top:1px solid var(--thinkt-border-color, #2a2a2a);font-size:11px;color:var(--thinkt-text-secondary, #94a3b8);flex-wrap:wrap;flex-shrink:0}.thinkt-project-timeline-legend-item{display:flex;align-items:center;gap:6px}.thinkt-project-timeline-legend-start{width:10px;height:10px;border-radius:50%;border:2px solid currentColor}.thinkt-project-timeline-legend-end{width:10px;height:10px;border-radius:50%;background:currentColor}.thinkt-project-timeline-legend-line{width:20px;height:2px;background:currentColor}.thinkt-project-timeline-empty,.thinkt-project-timeline-loading,.thinkt-project-timeline-error{display:flex;align-items:center;justify-content:center;height:100%;color:var(--thinkt-muted-color, #666);font-size:12px}.thinkt-project-timeline-tooltip{position:absolute;background:var(--thinkt-dropdown-bg, #1a1a1a);border:1px solid var(--thinkt-border-color, #333);border-radius:6px;padding:10px 12px;font-size:12px;pointer-events:none;z-index:100;box-shadow:0 4px 12px #00000080;max-width:280px}.thinkt-project-timeline-tooltip-title{font-weight:500;color:var(--thinkt-text-primary, #f8fafc);margin-bottom:4px;line-height:1.3}.thinkt-project-timeline-tooltip-meta{color:var(--thinkt-muted-color, #888);font-size:11px;display:flex;flex-direction:column;gap:2px}.thinkt-project-timeline-tooltip-duration{color:var(--thinkt-accent-color, #6366f1);font-weight:500}';class Bs{constructor(t){d(this,"options");d(this,"client");d(this,"container");d(this,"contentContainer");d(this,"sessions",[]);d(this,"rows",[]);d(this,"svg",null);d(this,"tooltip",null);d(this,"loadController",null);d(this,"isVisible",!1);d(this,"cachedProjectKey",null);d(this,"rowHeight",50);d(this,"blobRadius",7);d(this,"minEndMarkerGapPx",8);d(this,"padding",{top:30,right:30,bottom:20,left:80});d(this,"abortController",new AbortController);this.options=t,this.client=t.client??B(),this.container=t.elements.container,this.container.className="thinkt-project-timeline",this.contentContainer=document.createElement("div"),this.init()}init(){N("thinkt-project-timeline-styles",Ns),this.createStructure(),this.tooltip=document.createElement("div"),this.tooltip.className="thinkt-project-timeline-tooltip",this.tooltip.style.display="none",document.body.appendChild(this.tooltip),window.addEventListener("thinkt:locale-changed",()=>this.refreshI18n(),{signal:this.abortController.signal}),this.options.projectId&&this.loadSessions(this.options.projectId,this.options.projectSource)}createStructure(){this.container.innerHTML=`
      <div class="thinkt-project-timeline-header">
        <span class="thinkt-project-timeline-title">ðŸ“Š ${c._("Project Timeline")}</span>
        <button class="thinkt-project-timeline-close" title="${c._("Close")}">Ã—</button>
      </div>
    `,this.contentContainer.className="thinkt-project-timeline-content",this.container.appendChild(this.contentContainer);const t=this.container.querySelector(".thinkt-project-timeline-close");t==null||t.addEventListener("click",()=>this.hide());const e=document.createElement("div");e.className="thinkt-project-timeline-legend",e.innerHTML=`
      <div class="thinkt-project-timeline-legend-item">
        <span class="thinkt-project-timeline-legend-start"></span>
        <span>${c._("Start")}</span>
      </div>
      <div class="thinkt-project-timeline-legend-item">
        <span class="thinkt-project-timeline-legend-end"></span>
        <span>${c._("End")}</span>
      </div>
      <div class="thinkt-project-timeline-legend-item">
        <span class="thinkt-project-timeline-legend-line"></span>
        <span>${c._("Session duration")}</span>
      </div>
    `,this.container.appendChild(e)}async loadSessions(t,e,i=!1){var a,l,h;const s=(e==null?void 0:e.trim().toLowerCase())||void 0,n=`${s??""}::${t}`;if(!i&&this.cachedProjectKey===n&&this.sessions.length>0){this.render();return}(a=this.loadController)==null||a.abort();const o=new AbortController;this.loadController=o,this.options.projectId=t,this.options.projectSource=s,this.cachedProjectKey=n,this.showLoading();try{const p=await this.client.getSessions(t,this.options.projectSource,o.signal);if(o.signal.aborted)return;this.sessions=p.filter(u=>u.createdAt&&u.modifiedAt).map(u=>{const g=u.createdAt instanceof Date?u.createdAt:new Date(u.createdAt),m=u.modifiedAt instanceof Date?u.modifiedAt:new Date(u.modifiedAt);return{session:u,source:u.source||"unknown",startTime:g,endTime:m,duration:(m.getTime()-g.getTime())/(1e3*60)}}).sort((u,g)=>u.startTime.getTime()-g.startTime.getTime()),this.processRows(),this.render()}catch(p){if(o.signal.aborted)return;const u=p instanceof Error?p:new Error(String(p));this.showError(u),(h=(l=this.options).onError)==null||h.call(l,u)}finally{this.loadController===o&&(this.loadController=null)}}processRows(){const t=new Map;for(const s of this.sessions)t.has(s.source)||t.set(s.source,[]),t.get(s.source).push(s);const e={claude:"#d97750",kimi:"#19c39b",gemini:"#6366f1",copilot:"#0078d4",thinkt:"#888888"};this.rows=Array.from(t.entries()).map(([s,n])=>({source:s,color:e[s.toLowerCase()]||"#6366f1",sessions:n.sort((o,a)=>o.startTime.getTime()-a.startTime.getTime())}));const i={claude:0,kimi:1,gemini:2,copilot:3,thinkt:4};this.rows.sort((s,n)=>(i[s.source]??99)-(i[n.source]??99))}render(){if(this.sessions.length===0){this.showEmpty();return}this.contentContainer.replaceChildren();const t=Math.max(400,this.contentContainer.clientWidth),e=this.padding.top+this.rows.length*this.rowHeight+this.padding.bottom;this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("class","thinkt-project-timeline-svg"),this.svg.setAttribute("viewBox",`0 0 ${t} ${e}`),this.svg.style.height=`${e}px`;const i=this.getTimeRange(),s=n=>{const o=(n.getTime()-i.start.getTime())/(i.end.getTime()-i.start.getTime());return this.padding.left+o*(t-this.padding.left-this.padding.right)};this.drawTimeAxis(t,i,s),this.rows.forEach((n,o)=>{this.drawRow(n,o,t,s)}),this.contentContainer.appendChild(this.svg)}getTimeRange(){const t=this.sessions.flatMap(n=>[n.startTime.getTime(),n.endTime.getTime()]),e=Math.min(...t),i=Math.max(...t),s=(i-e)*.1||6e4;return{start:new Date(e-s),end:new Date(i+s)}}drawTimeAxis(t,e,i){const s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("class","thinkt-project-timeline-axis");const n=this.padding.top-10,o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",String(this.padding.left)),o.setAttribute("y1",String(n)),o.setAttribute("x2",String(t-this.padding.right)),o.setAttribute("y2",String(n)),o.setAttribute("stroke","var(--thinkt-border-color, #333)"),s.appendChild(o);const a=5;for(let l=0;l<=a;l++){const h=new Date(e.start.getTime()+(e.end.getTime()-e.start.getTime())*(l/a)),p=i(h),u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttribute("x",String(p)),u.setAttribute("y",String(n-5)),u.setAttribute("fill","var(--thinkt-muted-color, #666)"),u.setAttribute("font-size","9"),u.setAttribute("text-anchor",l===0?"start":l===a?"end":"middle"),u.textContent=this.formatTime(h),s.appendChild(u);const g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",String(p)),g.setAttribute("y1",String(n)),g.setAttribute("x2",String(p)),g.setAttribute("y2",String(n+4)),g.setAttribute("stroke","var(--thinkt-border-color, #333)"),s.appendChild(g)}this.svg.appendChild(s)}drawRow(t,e,i,s){const n=this.padding.top+e*this.rowHeight+this.rowHeight/2,o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("class","thinkt-project-timeline-row");const a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x","10"),a.setAttribute("y",String(n+4)),a.setAttribute("fill","var(--thinkt-text-secondary, #94a3b8)"),a.setAttribute("font-size","11"),a.setAttribute("font-weight","500"),a.setAttribute("text-anchor","start"),a.textContent=t.source.charAt(0).toUpperCase()+t.source.slice(1),o.appendChild(a);for(const l of t.sessions){const h=s(l.startTime),p=s(l.endTime),u=l.endTime.getTime()>l.startTime.getTime(),g=i-this.padding.right,m=u?Math.min(g,Math.max(p,h+this.minEndMarkerGapPx)):h;if(u&&m>h){const v=document.createElementNS("http://www.w3.org/2000/svg","line");v.setAttribute("x1",String(h)),v.setAttribute("y1",String(n)),v.setAttribute("x2",String(m)),v.setAttribute("y2",String(n)),v.setAttribute("stroke",t.color),v.setAttribute("stroke-width","2"),v.setAttribute("opacity","0.4"),o.appendChild(v)}const b=document.createElementNS("http://www.w3.org/2000/svg","circle");b.setAttribute("cx",String(h)),b.setAttribute("cy",String(n)),b.setAttribute("r",String(this.blobRadius)),b.setAttribute("fill","var(--thinkt-bg-secondary, #141414)"),b.setAttribute("stroke",t.color),b.setAttribute("stroke-width","2"),b.setAttribute("cursor","pointer"),this.attachInteraction(b,l,"start"),o.appendChild(b);const f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttribute("cx",String(m)),f.setAttribute("cy",String(n)),f.setAttribute("r",String(u?this.blobRadius:Math.max(3,this.blobRadius-3))),f.setAttribute("fill",t.color),f.setAttribute("stroke",t.color),f.setAttribute("stroke-width",u?"2":"1.5"),f.setAttribute("cursor","pointer"),this.attachInteraction(f,l,"end"),o.appendChild(f)}this.svg.appendChild(o)}attachInteraction(t,e,i){const s=Number(t.getAttribute("r")??this.blobRadius);t.addEventListener("mouseenter",n=>{t.setAttribute("r",String(s+2)),this.showTooltip(n,e,i)}),t.addEventListener("mouseleave",()=>{t.setAttribute("r",String(s)),this.hideTooltip()}),t.addEventListener("click",()=>{var n,o;(o=(n=this.options).onSessionSelect)==null||o.call(n,e.session)})}showTooltip(t,e,i){var b;if(!this.tooltip)return;const s=e.session.firstPrompt?e.session.firstPrompt.slice(0,80)+(e.session.firstPrompt.length>80?"...":""):((b=e.session.id)==null?void 0:b.slice(0,8))||c._("Unknown"),n=i==="start"?c._("Started"):c._("Ended"),o=i==="start"?e.startTime:e.endTime;this.tooltip.innerHTML=`
      <div class="thinkt-project-timeline-tooltip-title">${this.escapeHtml(s)}</div>
      <div class="thinkt-project-timeline-tooltip-meta">
        <span>${n}: ${o.toLocaleString()}</span>
        <span class="thinkt-project-timeline-tooltip-duration">
          ${c._("Duration: {duration}",{duration:this.formatDuration(e.duration)})}
        </span>
        <span>${c._("Source: {source}",{source:e.source})}</span>
      </div>
    `;const a=t.target.getBoundingClientRect(),l=8;this.tooltip.style.display="block",this.tooltip.style.visibility="hidden",this.tooltip.style.left="0px",this.tooltip.style.top="0px";const h=this.tooltip.getBoundingClientRect(),p=window.innerWidth,u=window.innerHeight;let g=a.left;g+h.width>p-l&&(g=p-h.width-l),g<l&&(g=l);let m=a.bottom+l;m+h.height>u-l&&(m=a.top-h.height-l),m<l&&(m=l),this.tooltip.style.left=`${g+window.scrollX}px`,this.tooltip.style.top=`${m+window.scrollY}px`,this.tooltip.style.visibility="visible"}hideTooltip(){this.tooltip&&(this.tooltip.style.display="none")}formatTime(t){return t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1})}formatDuration(t){if(t<1)return c._("< 1 min");if(t<60)return c._("{count} min",{count:Math.round(t)});const e=Math.floor(t/60),i=Math.round(t%60);return c._("{hours}h {mins}m",{hours:e,mins:i})}showLoading(){this.contentContainer.innerHTML=`
      <div class="thinkt-project-timeline-loading">${c._("Loading timeline...")}</div>
    `}showEmpty(){this.contentContainer.innerHTML=`
      <div class="thinkt-project-timeline-empty">${c._("No sessions with timing data")}</div>
    `}showError(t){this.contentContainer.innerHTML=`
      <div class="thinkt-project-timeline-error">${c._("Error: {message}",{message:this.escapeHtml(t.message)})}</div>
    `}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}show(){var e,i;const t=this.isVisible;this.isVisible=!0,this.container.style.display="flex",t||(i=(e=this.options).onVisibilityChange)==null||i.call(e,!0),this.options.projectId&&this.loadSessions(this.options.projectId,this.options.projectSource,!1)}hide(){var e,i;const t=this.isVisible;this.isVisible=!1,this.container.style.display="none",t&&((i=(e=this.options).onVisibilityChange)==null||i.call(e,!1))}isShown(){return this.isVisible}setProject(t,e){const i=(e==null?void 0:e.trim().toLowerCase())||void 0,s=this.options.projectId!==t||this.options.projectSource!==i;this.options.projectId=t,this.options.projectSource=i,this.isVisible&&this.loadSessions(t,this.options.projectSource,s)}refresh(){this.options.projectId&&this.isVisible&&this.loadSessions(this.options.projectId,this.options.projectSource,!0)}refreshI18n(){this.createStructure(),this.render()}dispose(){var t;this.abortController.abort(),(t=this.loadController)==null||t.abort(),this.tooltip&&(this.tooltip.remove(),this.tooltip=null),this.container.replaceChildren(),this.sessions=[],this.rows=[],this.cachedProjectKey=null}}const Hs=".thinkt-api-viewer{display:flex;height:100vh;width:100vw;overflow:hidden;background:var(--thinkt-bg-color, #0a0a0a)}.thinkt-api-viewer__sidebar{display:flex;flex-direction:column;width:380px;min-width:280px;max-width:500px;border-right:1px solid var(--thinkt-border-color, #2a2a2a);background:var(--thinkt-sidebar-bg, #0f1115)}.thinkt-project-browser,.thinkt-session-list{background:transparent!important}.thinkt-api-viewer__projects{flex:0 0 auto;height:45%;min-height:150px;overflow:hidden;display:flex;flex-direction:column}.thinkt-api-viewer__projects.full-height{flex:1;height:auto}.thinkt-api-viewer__projects.hidden{display:none}.thinkt-api-viewer__sessions{flex:1;overflow:hidden;min-height:200px}.thinkt-api-viewer__sessions.hidden{display:none}.thinkt-api-viewer__sidebar-splitter{height:6px;flex:0 0 6px;cursor:row-resize;background:var(--thinkt-bg-secondary, #141414);border-top:1px solid var(--thinkt-border-color, #2a2a2a);border-bottom:1px solid var(--thinkt-border-color, #2a2a2a)}.thinkt-api-viewer__sidebar-splitter:hover,.thinkt-api-viewer__sidebar-splitter.resizing{background:#6366f133}.thinkt-api-viewer__sidebar-splitter.hidden{display:none}.thinkt-api-viewer__viewer{flex:1;position:relative;overflow:hidden;background:var(--thinkt-bg-color, #0a0a0a);display:flex;flex-direction:column}.thinkt-api-viewer__conversation{flex:1;overflow:hidden;position:relative}.thinkt-api-viewer__timeline-panel{height:200px;min-height:150px;max-height:400px;border-top:1px solid var(--thinkt-border-color, #2a2a2a);background:var(--thinkt-bg-secondary, #141414);flex-shrink:0;display:none}.thinkt-api-viewer__timeline-panel.visible{display:flex}.thinkt-api-viewer__resizer{width:4px;background:var(--thinkt-border-color, #2a2a2a);cursor:col-resize;transition:background .15s ease}.thinkt-api-viewer__resizer:hover,.thinkt-api-viewer__resizer.resizing{background:var(--thinkt-accent-color, #6366f1)}.thinkt-api-viewer--sidebar-collapsed .thinkt-api-viewer__sidebar{width:0!important;min-width:0;max-width:0;border-right:none;overflow:hidden}.thinkt-api-viewer--sidebar-collapsed .thinkt-api-viewer__resizer{width:0;min-width:0;max-width:0;opacity:0;pointer-events:none}.thinkt-view-switcher{display:flex;padding:6px 8px;border-bottom:1px solid var(--thinkt-border-color, #2a2a2a);background:var(--thinkt-bg-secondary, #141414);gap:4px}.thinkt-view-switcher-btn{flex:1;padding:4px 8px;font-size:11px;font-weight:500;text-transform:uppercase;letter-spacing:.3px;background:transparent;border:1px solid transparent;border-radius:4px;color:var(--thinkt-text-muted, #666);cursor:pointer;transition:all .15s ease;display:flex;align-items:center;justify-content:center;gap:4px}.thinkt-view-switcher-btn:hover{background:var(--thinkt-bg-hover, #252525);color:var(--thinkt-text-secondary, #94a3b8)}.thinkt-view-switcher-btn.active{background:var(--thinkt-accent-color, #6366f1);color:#fff}.thinkt-view-switcher-btn .icon{font-size:10px}.thinkt-sidebar-toggle{display:none;width:24px;height:24px;border:none;border-radius:4px;background:transparent;color:var(--thinkt-text-color, #e0e0e0);font-size:16px;cursor:pointer;align-items:center;justify-content:center;line-height:1;padding:0;flex-shrink:0}.thinkt-sidebar-toggle:hover{background:#ffffff1a}.thinkt-sidebar-overlay{display:none;position:fixed;top:0;right:0;bottom:0;left:0;z-index:9;background:#00000080}@media(max-width:768px){.thinkt-sidebar-toggle{display:flex}.thinkt-api-viewer__sidebar{position:fixed;left:0;top:0;bottom:0;z-index:10;transform:translate(-100%);transition:transform .3s ease}.thinkt-api-viewer__sidebar--open{transform:translate(0)}.thinkt-sidebar-overlay--open{display:block}.thinkt-api-viewer__resizer{display:none}}",Fs=":root{--thinkt-source-claude-color: #d97750;--thinkt-source-claude-bg: rgba(217, 119, 80, .15);--thinkt-source-claude-border: rgba(217, 119, 80, .4);--thinkt-source-kimi-color: #19c39b;--thinkt-source-kimi-bg: rgba(25, 195, 155, .15);--thinkt-source-gemini-color: #6366f1;--thinkt-source-gemini-bg: rgba(99, 102, 241, .15)}";class V{static normalizeSourceName(t){return t.trim().toLowerCase()}static normalizePath(t){return t.replace(/\\/g,"/").replace(/\/+/g,"/").replace(/\/$/,"").toLowerCase()}static inferSourceFromPath(t){const e=t.match(/\/\.([a-z0-9_-]+)(?:\/|$)/);if(!e)return null;const i=e[1];return!i||i==="config"||i==="cache"?null:i}static detectSourceFromPaths(t,e){const i=t.filter(n=>typeof n=="string"&&n.trim().length>0).map(n=>V.normalizePath(n));if(i.length===0)return null;let s=null;for(const n of e)!n.basePath||!i.some(a=>a===n.basePath||a.startsWith(`${n.basePath}/`))||(!s||n.basePath.length>s.basePath.length)&&(s=n);if(s)return s.name;for(const n of i){const o=V.inferSourceFromPath(n);if(o)return o}return null}static resolveSessionSource(t,e,i){const s=V.detectSourceFromPaths([t.fullPath,t.projectPath,e==null?void 0:e.path,e==null?void 0:e.sourceBasePath],i);return s||(t.source||(e==null?void 0:e.source)||"").toString().trim().toLowerCase()||null}}const Us=".thinkt-project-filter{display:grid;grid-template-columns:minmax(0,1fr) minmax(110px,auto) minmax(94px,110px);gap:6px;align-items:center;padding:6px 8px;border-bottom:1px solid var(--thinkt-border-color, #2a2a2a);background:var(--thinkt-bg-secondary, #141414)}.thinkt-project-filter__search,.thinkt-project-filter__sort{border:1px solid var(--thinkt-border-color, #333);border-radius:4px;background:var(--thinkt-input-bg, #252525);color:var(--thinkt-text-color, #e0e0e0);font-size:12px;padding:6px 8px}.thinkt-project-filter__search{min-width:0;width:100%}.thinkt-project-filter__sort{width:100%;min-width:0}.thinkt-project-filter__search:focus,.thinkt-project-filter__sort:focus{outline:none;border-color:var(--thinkt-accent-color, #6366f1)}.thinkt-source-dropdown{position:relative;width:100%;min-width:0}.thinkt-source-dropdown__btn{display:flex;align-items:center;justify-content:space-between;width:100%;border:1px solid var(--thinkt-border-color, #333);border-radius:4px;background:var(--thinkt-input-bg, #252525);color:var(--thinkt-text-color, #e0e0e0);font-size:12px;padding:6px 8px;cursor:pointer;text-align:left;transition:all .15s ease;white-space:nowrap;overflow:hidden}.thinkt-source-dropdown__btn:hover{border-color:var(--thinkt-accent-color, #6366f1)}.thinkt-source-dropdown__btn.active{background:var(--thinkt-hover-bg, #333);border-color:var(--thinkt-accent-color, #6366f1)}.thinkt-source-dropdown__btn span:first-child{overflow:hidden;text-overflow:ellipsis;margin-right:8px}.thinkt-source-dropdown__icon{font-size:8px;color:var(--thinkt-muted-color, #666);transition:transform .2s ease}.thinkt-source-dropdown__btn.active .thinkt-source-dropdown__icon{transform:rotate(180deg)}.thinkt-source-dropdown__menu{position:absolute;top:calc(100% + 4px);right:0;min-width:160px;background:var(--thinkt-dropdown-bg, #1a1a1a);border:1px solid var(--thinkt-border-color, #333);border-radius:6px;box-shadow:0 4px 12px #00000080;padding:4px;z-index:100;display:none;flex-direction:column;gap:2px}.thinkt-source-dropdown__menu.open{display:flex;animation:dropdownFadeIn .15s ease}@keyframes dropdownFadeIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.thinkt-source-dropdown__list{max-height:200px;overflow-y:auto}.thinkt-source-option{display:flex;align-items:center;gap:8px;padding:6px 8px;font-size:12px;color:var(--thinkt-text-color, #e0e0e0);border-radius:4px;cursor:pointer;transition:background .1s ease;-webkit-user-select:none;user-select:none}.thinkt-source-option:hover{background:var(--thinkt-hover-bg, #2a2a2a)}.thinkt-source-option input[type=checkbox]{margin:0;accent-color:var(--thinkt-accent-color, #6366f1);cursor:pointer}.thinkt-source-dropdown__divider{height:1px;background:var(--thinkt-border-color, #333);margin:4px 0}.thinkt-source-option--toggle{color:var(--thinkt-text-secondary, #94a3b8)}",Os=150;class be{constructor(t){d(this,"options");d(this,"filters");d(this,"client");d(this,"signal");d(this,"searchInput",null);d(this,"sourceDropdownBtn",null);d(this,"sourceDropdownMenu",null);d(this,"isSourceDropdownOpen",!1);d(this,"sortFilter",null);d(this,"includeDeletedToggle",null);d(this,"includeDeletedLabel",null);d(this,"searchDebounceTimer",null);d(this,"defaultSelectAllSources",!0);d(this,"discoveredSources",[]);d(this,"sourceCapabilities",[]);d(this,"resumableSources",new Set);this.options=t,this.filters=t.filters,this.client=t.client,this.signal=t.signal,this.defaultSelectAllSources=t.defaultSelectAllSources??!0,this.createFilterBar()}createFilterBar(){const t=this.options.container;t.className="thinkt-project-filter";const e=document.createElement("input");e.className="thinkt-project-filter__search",e.type="text",e.placeholder=c._("Filter projects..."),e.value=this.filters.searchQuery,this.searchInput=e;const i=document.createElement("div");i.className="thinkt-source-dropdown";const s=document.createElement("button");s.className="thinkt-source-dropdown__btn",s.innerHTML=`<span>${c._("All Sources")}</span><span class="thinkt-source-dropdown__icon">â–¼</span>`,this.sourceDropdownBtn=s;const n=document.createElement("div");n.className="thinkt-source-dropdown__menu",this.sourceDropdownMenu=n,i.appendChild(s),i.appendChild(n);const o=b=>{if(b.stopPropagation(),this.isSourceDropdownOpen=!this.isSourceDropdownOpen,this.isSourceDropdownOpen){n.classList.add("open"),s.classList.add("active");const f=new AbortController,v=x=>{i.contains(x.target)||(this.isSourceDropdownOpen=!1,n.classList.remove("open"),s.classList.remove("active"),f.abort())};document.addEventListener("click",v,{signal:f.signal}),this.signal.addEventListener("abort",()=>f.abort())}else n.classList.remove("open"),s.classList.remove("active")};s.addEventListener("click",o,{signal:this.signal});const a=document.createElement("select");a.className="thinkt-project-filter__sort",this.sortFilter=a,this.renderSortFilterOptions();const l=document.createElement("input");l.type="checkbox",l.checked=this.filters.includeDeleted,this.includeDeletedToggle=l;const h=document.createElement("span");h.textContent=c._("Include Deleted"),this.includeDeletedLabel=h;const p=document.createElement("label");p.className="thinkt-source-option thinkt-source-option--toggle",p.appendChild(l),p.appendChild(h);const u=()=>{this.searchDebounceTimer&&clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=setTimeout(()=>{this.filters.searchQuery=e.value,this.options.onFiltersChanged()},Os)};e.addEventListener("input",u,{signal:this.signal});const g=()=>{this.filters.sort=this.normalizeProjectSort(a.value),this.options.onFiltersChanged()};a.addEventListener("change",g,{signal:this.signal});const m=()=>{this.filters.includeDeleted=l.checked,this.options.onFiltersChanged()};l.addEventListener("change",m,{signal:this.signal}),this.renderSourceFilterOptions(),t.appendChild(e),t.appendChild(i),t.appendChild(a)}setSourceCapabilities(t,e){this.sourceCapabilities=t,this.resumableSources=e}getSourceCapabilities(){return this.sourceCapabilities}isSourceResumable(t){return this.resumableSources.has(V.normalizeSourceName(t))}resolveSessionSource(t,e){return V.resolveSessionSource(t,e,this.sourceCapabilities)}mergeDiscoveredSources(t){const e=[...this.discoveredSources],i=e.length>0&&e.every(o=>this.filters.sources.has(o));let s=!1;const n=new Set(this.discoveredSources);for(const o of t){const a=V.normalizeSourceName(o);a&&n.add(a)}if(this.discoveredSources=Array.from(n).sort((o,a)=>o.localeCompare(a)),this.defaultSelectAllSources&&this.filters.sources.size===0&&this.discoveredSources.length>0){for(const o of this.discoveredSources)this.filters.sources.add(o);s=!0,this.defaultSelectAllSources=!1}else if(i)for(const o of this.discoveredSources)this.filters.sources.has(o)||(this.filters.sources.add(o),s=!0);this.renderSourceFilterOptions(),s&&this.options.onFiltersChanged()}async discoverSourcesFromProjects(){try{const e=(await this.client.getProjects(void 0,{includeDeleted:this.filters.includeDeleted})).map(i=>typeof i.source=="string"?i.source.trim():"").filter(i=>i.length>0);this.mergeDiscoveredSources(e)}catch(t){console.warn("[THINKT] Source discovery failed:",t)}}syncFromDom(){this.searchInput&&(this.filters.searchQuery=this.searchInput.value),this.sortFilter&&(this.filters.sort=this.normalizeProjectSort(this.sortFilter.value)),this.includeDeletedToggle&&(this.filters.includeDeleted=this.includeDeletedToggle.checked)}focusSearch(){var t;(t=this.searchInput)==null||t.focus()}renderSourceFilterOptions(){var n;if(!this.sourceDropdownMenu||!this.sourceDropdownBtn)return;const t=this.sourceDropdownMenu,e=(n=this.includeDeletedLabel)==null?void 0:n.parentElement;t.replaceChildren();const i=document.createElement("div");i.className="thinkt-source-dropdown__list";const s=[...this.discoveredSources];if(s.sort((o,a)=>o.localeCompare(a)),s.forEach(o=>{const a=document.createElement("label");a.className="thinkt-source-option";const l=document.createElement("input");l.type="checkbox",l.value=o,l.checked=this.filters.sources.has(o);const h=document.createElement("span");h.textContent=o.charAt(0).toUpperCase()+o.slice(1),a.appendChild(l),a.appendChild(h),i.appendChild(a),l.addEventListener("change",()=>{this.defaultSelectAllSources=!1,l.checked?this.filters.sources.add(o):this.filters.sources.delete(o),this.updateSourceDropdownButton(),this.options.onFiltersChanged()})}),t.appendChild(i),s.length>0&&e){const o=document.createElement("div");o.className="thinkt-source-dropdown__divider",t.appendChild(o)}e&&t.appendChild(e),this.updateSourceDropdownButton()}updateSourceDropdownButton(){if(!this.sourceDropdownBtn)return;const t=this.sourceDropdownBtn.querySelector("span:first-child");if(t){const e=this.filters.sources.size,i=this.discoveredSources.length;if(i>0&&e===i)t.textContent=c._("All Sources");else if(e===0)t.textContent=c._("None");else if(e===1){const s=Array.from(this.filters.sources)[0];t.textContent=s.charAt(0).toUpperCase()+s.slice(1)}else t.textContent=c._("{count} Sources",{count:e})}}renderSortFilterOptions(){if(!this.sortFilter)return;const t=this.sortFilter,e=this.normalizeProjectSort(t.value||this.filters.sort);t.replaceChildren(),[{value:"date_desc",label:c._("Newest")},{value:"date_asc",label:c._("Oldest")},{value:"name_asc",label:c._("Name A-Z")},{value:"name_desc",label:c._("Name Z-A")}].forEach(({value:s,label:n})=>{const o=document.createElement("option");o.value=s,o.textContent=n,t.appendChild(o)}),t.value=e,this.filters.sort=e}normalizeProjectSort(t){switch(t){case"name_asc":case"name_desc":case"date_asc":case"date_desc":return t;default:return"date_desc"}}refreshI18n(){this.searchInput&&(this.searchInput.placeholder=c._("Filter projects...")),this.includeDeletedLabel&&(this.includeDeletedLabel.textContent=c._("Include Deleted")),this.renderSourceFilterOptions(),this.renderSortFilterOptions()}static get styles(){return Us}}const Vs=250,qs=600,Ws=150,Ks=200;class Zs{constructor(t){d(this,"sidebar");d(this,"projectsSection");d(this,"sessionsSection");d(this,"viewerSection");d(this,"timelinePanelContainer");d(this,"sectionSplitter");d(this,"projectPaneHeightPx",null);d(this,"disposed",!1);d(this,"minProjectPaneHeight",Ws);d(this,"minSessionPaneHeight",Ks);d(this,"currentView");d(this,"sidebarCollapsed",!1);this.options=t,this.currentView=t.initialView;const{container:e}=t.elements;e.className="thinkt-api-viewer",this.sidebar=document.createElement("div"),this.sidebar.className="thinkt-api-viewer__sidebar";const i=document.getElementById("top-bar");i&&this.sidebar.appendChild(i),this.projectsSection=document.createElement("div"),this.projectsSection.className="thinkt-api-viewer__projects",this.projectsSection.id="projects-section",this.projectsSection.appendChild(t.elements.projectBrowserContainer),this.sectionSplitter=document.createElement("div"),this.sectionSplitter.className="thinkt-api-viewer__sidebar-splitter",this.sectionSplitter.id="sidebar-section-splitter",this.sectionSplitter.setAttribute("role","separator"),this.sectionSplitter.setAttribute("aria-orientation","horizontal"),this.sectionSplitter.setAttribute("aria-label","Resize projects and sessions"),this.sessionsSection=document.createElement("div"),this.sessionsSection.className="thinkt-api-viewer__sessions",this.sessionsSection.id="sessions-section",this.sessionsSection.appendChild(t.elements.sessionListContainer),this.sidebar.appendChild(this.projectsSection),this.sidebar.appendChild(this.sectionSplitter),this.sidebar.appendChild(this.sessionsSection),e.appendChild(this.sidebar);const s=document.createElement("button");s.className="thinkt-sidebar-toggle",s.setAttribute("aria-label","Toggle sidebar"),s.textContent="â˜°",i&&i.insertBefore(s,i.firstChild);const n=document.createElement("div");n.className="thinkt-sidebar-overlay",e.appendChild(n);const o=()=>{const h=!this.sidebar.classList.contains("thinkt-api-viewer__sidebar--open");this.sidebar.classList.toggle("thinkt-api-viewer__sidebar--open",h),n.classList.toggle("thinkt-sidebar-overlay--open",h)},a=()=>{this.sidebar.classList.remove("thinkt-api-viewer__sidebar--open"),n.classList.remove("thinkt-sidebar-overlay--open")};if(s.addEventListener("click",o,{signal:t.signal}),n.addEventListener("click",a,{signal:t.signal}),window.addEventListener("resize",()=>this.clampProjectPaneHeight(),{signal:t.signal}),t.onLocaleChanged&&window.addEventListener("thinkt:locale-changed",t.onLocaleChanged,{signal:t.signal}),!t.elements.resizer){const h=document.createElement("div");h.className="thinkt-api-viewer__resizer",t.elements.resizer=h}e.appendChild(t.elements.resizer),t.elements.resizer&&this.setupDragResize(t.elements.resizer,{cursor:"col-resize",onMove:h=>{h.clientX>=Vs&&h.clientX<=qs&&(this.sidebar.style.width=`${h.clientX}px`)}}),this.setupDragResize(this.sectionSplitter,{cursor:"row-resize",onStart:()=>{if(this.currentView!=="list")return!1;this.sectionSplitter.classList.add("resizing")},onMove:h=>{const p=this.getProjectPaneBounds();if(!p)return;const u=h.clientY-p.top;this.projectPaneHeightPx=Math.min(p.max,Math.max(p.min,u)),this.clampProjectPaneHeight()},onEnd:()=>{this.sectionSplitter.classList.remove("resizing")}}),this.updateForView(this.currentView),this.viewerSection=document.createElement("div"),this.viewerSection.className="thinkt-api-viewer__viewer",this.viewerSection.style.display="flex",this.viewerSection.style.flexDirection="column",t.elements.timelinePanelContainer||(t.elements.timelinePanelContainer=document.createElement("div"),t.elements.timelinePanelContainer.className="thinkt-api-viewer__timeline-panel",t.elements.timelinePanelContainer.style.display="none",t.elements.timelinePanelContainer.style.height="200px",t.elements.timelinePanelContainer.style.flexShrink="0"),this.timelinePanelContainer=t.elements.timelinePanelContainer;const l=document.createElement("div");l.className="thinkt-api-viewer__conversation",l.style.flex="1",l.style.overflow="hidden",l.appendChild(t.elements.viewerContainer),this.viewerSection.appendChild(l),this.viewerSection.appendChild(this.timelinePanelContainer),e.appendChild(this.viewerSection)}updateForView(t){if(this.currentView=t,t==="list"){this.projectsSection.classList.remove("full-height","hidden"),this.sessionsSection.classList.remove("hidden"),this.sectionSplitter.classList.remove("hidden"),this.projectPaneHeightPx===null&&(this.projectsSection.style.height="45%"),this.projectsSection.style.flex="0 0 auto",this.sessionsSection.style.flex="1 1 auto",window.requestAnimationFrame(()=>{this.disposed||this.currentView!=="list"||this.clampProjectPaneHeight()});return}this.sectionSplitter.classList.add("hidden"),this.projectsSection.classList.add("full-height"),this.projectsSection.classList.remove("hidden"),this.sessionsSection.classList.add("hidden"),this.projectsSection.style.height="",this.projectsSection.style.flex="",this.sessionsSection.style.flex=""}closeMobileSidebar(){const t=this.options.elements.container,e=t.querySelector(".thinkt-api-viewer__sidebar"),i=t.querySelector(".thinkt-sidebar-overlay");e==null||e.classList.remove("thinkt-api-viewer__sidebar--open"),i==null||i.classList.remove("thinkt-sidebar-overlay--open")}isSidebarCollapsed(){return this.sidebarCollapsed}setSidebarCollapsed(t){var e,i;this.sidebarCollapsed!==t&&(this.sidebarCollapsed=t,this.options.elements.container.classList.toggle("thinkt-api-viewer--sidebar-collapsed",t),t&&this.closeMobileSidebar(),(i=(e=this.options).onSidebarCollapsedChange)==null||i.call(e,t))}toggleSidebarCollapsed(){const t=!this.sidebarCollapsed;return this.setSidebarCollapsed(t),t}clampProjectPaneHeight(){if(this.currentView!=="list")return;const t=this.getProjectPaneBounds();if(!t)return;const e=this.projectPaneHeightPx??this.projectsSection.getBoundingClientRect().height,i=Math.min(t.max,Math.max(t.min,e));this.projectPaneHeightPx=i,this.projectsSection.style.height=`${Math.round(i)}px`,this.projectsSection.style.flex="0 0 auto",this.sessionsSection.style.flex="1 1 auto"}getProjectPaneBounds(){const t=this.projectsSection.getBoundingClientRect(),e=this.sessionsSection.getBoundingClientRect(),i=this.sectionSplitter.getBoundingClientRect().height,s=e.bottom-t.top-i,n=this.minProjectPaneHeight,o=Math.max(n,s-this.minSessionPaneHeight);return{top:t.top,min:n,max:o}}setupDragResize(t,e){let i=!1;const s=a=>{var l;((l=e.onStart)==null?void 0:l.call(e,a))!==!1&&(i=!0,document.body.style.cursor=e.cursor,document.body.style.userSelect="none",a.preventDefault())},n=a=>{i&&e.onMove(a)},o=()=>{var a;i&&(i=!1,document.body.style.cursor="",document.body.style.userSelect="",(a=e.onEnd)==null||a.call(e))};t.addEventListener("mousedown",s,{signal:this.options.signal}),document.addEventListener("mousemove",n,{signal:this.options.signal}),document.addEventListener("mouseup",o,{signal:this.options.signal})}dispose(){this.disposed=!0}}const Xe="thinkt-viewer-state",ve=50;function xe(){try{const r=sessionStorage.getItem(Xe);return r?JSON.parse(r):{}}catch{return{}}}function Xs(r){try{sessionStorage.setItem(Xe,JSON.stringify(r))}catch{}}class Ys{constructor(t){d(this,"elements");d(this,"options");d(this,"client");d(this,"layout");d(this,"filterBar");d(this,"projectBrowser",null);d(this,"treeProjectBrowser",null);d(this,"timelineVisualization",null);d(this,"sessionList",null);d(this,"conversationView",null);d(this,"projectTimelinePanel",null);d(this,"currentProject",null);d(this,"currentSession",null);d(this,"currentProjectView","list");d(this,"projectFilters",{searchQuery:"",sources:new Set,sort:"date_desc",includeDeleted:!1});d(this,"sessionLoadController",null);d(this,"initialized");d(this,"abortController",new AbortController);d(this,"disposed",!1);this.elements=t.elements,this.options=t,this.client=t.client??B();const e=xe(),i=Array.isArray(e.filterSources);this.currentProjectView=t.initialProjectView??e.projectView??"list",e.filterSort&&(this.projectFilters.sort=e.filterSort),i&&(this.projectFilters.sources=new Set(e.filterSources)),e.filterIncludeDeleted&&(this.projectFilters.includeDeleted=e.filterIncludeDeleted),N("thinkt-source-colors",Fs),N("thinkt-api-viewer-styles",Hs),N("thinkt-project-filter-styles",be.styles),this.layout=new Zs({elements:this.elements,signal:this.abortController.signal,initialView:this.currentProjectView,onLocaleChanged:()=>this.refreshI18n(),onSidebarCollapsedChange:o=>this.handleSidebarCollapsedChange(o)});const s=this.createViewSwitcher();this.layout.sidebar.insertBefore(s,this.layout.projectsSection);const n=document.createElement("div");this.layout.sidebar.insertBefore(n,this.layout.projectsSection),this.filterBar=new be({container:n,client:this.client,filters:this.projectFilters,defaultSelectAllSources:!i,signal:this.abortController.signal,onFiltersChanged:()=>this.applyProjectFilters()}),this.initialized=this.initializeComponentsAsync()}createViewSwitcher(){const t=document.createElement("div");return t.className="thinkt-view-switcher",[{id:"list",label:c._("List"),icon:"â˜°"},{id:"tree",label:c._("Tree"),icon:"ðŸŒ³"},{id:"timeline",label:c._("Timeline"),icon:"â—¯"}].forEach(i=>{const s=document.createElement("button");s.className=`thinkt-view-switcher-btn ${this.currentProjectView===i.id?"active":""}`,s.dataset.view=i.id,s.innerHTML=`<span class="icon">${i.icon}</span> ${i.label}`,s.addEventListener("click",()=>this.switchProjectView(i.id)),t.appendChild(s)}),t}refreshViewSwitcherLabels(){const t={list:c._("List"),tree:c._("Tree"),timeline:c._("Timeline")};this.elements.container.querySelectorAll(".thinkt-view-switcher-btn").forEach(e=>{var n;const i=e.dataset.view;if(!i)return;const s=((n=e.querySelector(".icon"))==null?void 0:n.textContent)??"";e.innerHTML=`<span class="icon">${s}</span> ${t[i]}`})}switchProjectView(t){var i,s,n;if(this.currentProjectView===t)return;switch(this.currentProjectView=t,this.persistState(),this.elements.container.querySelectorAll(".thinkt-view-switcher-btn").forEach((o,a)=>{const l=["list","tree","timeline"];o.classList.toggle("active",l[a]===t)}),this.elements.projectBrowserContainer.replaceChildren(),(i=this.projectBrowser)==null||i.dispose(),this.projectBrowser=null,(s=this.treeProjectBrowser)==null||s.dispose(),this.treeProjectBrowser=null,(n=this.timelineVisualization)==null||n.dispose(),this.timelineVisualization=null,this.layout.updateForView(t),t){case"list":this.initListView(),this.currentProject&&(this.currentProject.id?this.showProjectTimelinePanel(this.currentProject.id,this.currentProject.source):this.hideProjectTimelinePanel());break;case"tree":this.hideProjectTimelinePanel(),this.initTreeView();break;case"timeline":this.hideProjectTimelinePanel(),this.initTimelineView();break}}async initListView(){this.projectBrowser=new Ti({elements:{container:this.elements.projectBrowserContainer},client:this.client,enableSearch:!1,enableSourceFilter:!1,filters:this.projectFilters,onProjectSelect:t=>{this.handleProjectSelect(t)},onError:t=>{this.handleError(t)}}),this.applyProjectFilters()}async initTreeView(){this.treeProjectBrowser=new Is({elements:{container:this.elements.projectBrowserContainer},client:this.client,filters:this.projectFilters,onSessionSelect:(t,e)=>{this.handleTreeSessionSelect(t,e)},onError:t=>{this.handleError(t)}}),this.applyProjectFilters()}async initTimelineView(){this.timelineVisualization=new Ds({elements:{container:this.elements.projectBrowserContainer},client:this.client,filters:this.projectFilters,onProjectSelect:t=>{this.handleTimelineProjectSelect(t)},onSessionSelect:t=>{this.handleTimelineSessionSelect(t)},onSourcesDiscovered:t=>{this.filterBar.mergeDiscoveredSources(t)},onError:t=>{this.handleError(t)}}),this.applyProjectFilters()}applyProjectFilters(){var t,e,i;switch(this.filterBar.syncFromDom(),this.currentProjectView){case"list":(t=this.projectBrowser)==null||t.applyFilters();break;case"tree":(e=this.treeProjectBrowser)==null||e.applyFilters();break;case"timeline":(i=this.timelineVisualization)==null||i.applyFilters();break}this.persistState()}persistState(){var t,e,i,s;Xs({projectView:this.currentProjectView,filterSort:this.projectFilters.sort,filterSources:Array.from(this.projectFilters.sources),filterIncludeDeleted:this.projectFilters.includeDeleted,projectId:(t=this.currentProject)==null?void 0:t.id,projectName:(e=this.currentProject)==null?void 0:e.name,projectPath:(i=this.currentProject)==null?void 0:i.path,projectSource:(s=this.currentProject)==null?void 0:s.source})}async initializeComponentsAsync(){switch(await this.checkConnection(),this.currentProjectView){case"list":default:await this.initListView();break;case"tree":await this.initTreeView();break;case"timeline":await this.initTimelineView();break}this.currentProjectView==="list"&&(this.sessionList=new ji({elements:{container:this.elements.sessionListContainer},client:this.client,onSessionSelect:t=>{this.handleSessionSelect(t)},onError:t=>{this.handleError(t)}})),this.conversationView=new As({elements:{container:this.elements.viewerContainer},client:this.client,onResumeSession:()=>this.handleResumeSession(),canResumeSession:()=>this.isCurrentSessionResumable(),onToggleTimelinePanel:()=>{this.handleTimelinePanelToggle()},isTimelinePanelVisible:()=>this.isTimelinePanelVisible(),canToggleTimelinePanel:()=>{var t;return!!((t=this.currentProject)!=null&&t.id)},onToggleSidebar:()=>this.toggleSidebar(),isSidebarCollapsed:()=>this.isSidebarCollapsed()}),this.elements.timelinePanelContainer&&(this.projectTimelinePanel=new Bs({elements:{container:this.elements.timelinePanelContainer},client:this.client,onSessionSelect:t=>{this.handleSessionSelect(t)},onVisibilityChange:t=>{this.handleTimelinePanelVisibilityChange(t)},onError:t=>{this.handleError(t)}})),await this.restorePersistedProject()}async restorePersistedProject(){const t=xe();if(t.projectId)try{const i=(await this.client.getProjects(void 0,{includeDeleted:this.projectFilters.includeDeleted})).find(s=>s.id===t.projectId);i&&this.handleProjectSelect(i)}catch{}}async checkConnection(){try{const t=await this.client.getSources(),e=t.map(n=>{const o=V.normalizeSourceName(typeof n.name=="string"?n.name:""),a=n.base_path&&n.base_path.trim().length>0?V.normalizePath(n.base_path):"",l=!!n.can_resume;return{name:o,basePath:a,canResume:l}}).filter(n=>n.name.length>0),i=new Set;for(const n of e)n.canResume&&i.add(n.name);this.filterBar.setSourceCapabilities(e,i);const s=t.map(n=>n.name).filter(n=>typeof n=="string"&&n.trim().length>0);this.filterBar.mergeDiscoveredSources(s),await this.filterBar.discoverSourcesFromProjects(),this.updateConnectionStatus(!0)}catch(t){this.updateConnectionStatus(!1,t instanceof Error?t.message:c._("Connection failed"))}}updateConnectionStatus(t,e){const i=document.getElementById("global-status");if(!i)return;i.classList.remove("connected","error","connecting"),i.classList.add(t?"connected":"error");const s=i.querySelector(".status-text");s&&(s.textContent=t?c._("Connected"):e??c._("Disconnected"))}refreshI18n(){this.refreshViewSwitcherLabels(),this.filterBar.refreshI18n()}isCurrentSessionResumable(){var i;const t=(i=this.currentSession)==null?void 0:i.meta;if(!(t!=null&&t.fullPath))return!1;const e=this.filterBar.resolveSessionSource(t,this.currentProject);return e?this.filterBar.isSourceResumable(e):!1}async handleResumeSession(){var e;const t=(e=this.currentSession)==null?void 0:e.meta.fullPath;if(t)try{await this.client.execResumeSession(t)}catch(i){const s=i instanceof Error?i:new Error(String(i));this.handleError(s)}}handleProjectSelect(t){var e,i,s,n;this.currentProject=t,this.persistState(),t.id&&((e=this.sessionList)==null||e.setProjectId(t.id,t.source)),(i=this.conversationView)==null||i.setProjectPath(t.path??t.name??null,0),(s=this.conversationView)==null||s.setSessionContext(null),this.currentProjectView==="list"&&t.id&&this.showProjectTimelinePanel(t.id,t.source),(n=this.conversationView)==null||n.refreshToolbar()}async handleTreeSessionSelect(t,e){var i,s;this.layout.closeMobileSidebar(),(i=this.conversationView)==null||i.setProjectPath(e.name,0),t.fullPath&&await this.loadSession(t.fullPath),(s=this.conversationView)==null||s.refreshToolbar()}async handleTimelineSessionSelect(t){var e,i;(e=this.conversationView)==null||e.setProjectPath(t.projectPath??null,0),t.fullPath&&await this.loadSession(t.fullPath),(i=this.conversationView)==null||i.refreshToolbar()}handleTimelineProjectSelect(t){var i,s,n,o,a,l,h;const e=((i=this.currentProject)==null?void 0:i.id)===t.projectId;if(this.showProjectTimelinePanel(t.projectId,t.projectSource),e&&this.currentSession){(s=this.conversationView)==null||s.refreshToolbar();return}this.currentProject={id:t.projectId,name:t.projectName,path:t.projectPath??void 0,source:t.projectSource??((n=this.currentProject)==null?void 0:n.source)??"claude"},this.currentSession=null,(o=this.conversationView)==null||o.setProjectPath(t.projectPath??t.projectName,0),(a=this.conversationView)==null||a.setSessionContext(null),(l=this.conversationView)==null||l.clear(),(h=this.conversationView)==null||h.refreshToolbar()}async handleSessionSelect(t){var i,s,n,o,a,l,h,p,u,g,m,b;if(((i=this.currentSession)==null?void 0:i.meta.id)===t.id)return;(s=this.sessionLoadController)==null||s.abort();const e=new AbortController;this.sessionLoadController=e,this.layout.closeMobileSidebar();try{const f=t.fullPath;if(!f)throw new Error("Session has no path");const v=t.source??((n=this.currentProject)==null?void 0:n.source)??null;(o=this.conversationView)==null||o.setSessionContext({source:v,model:t.model??null}),(a=this.conversationView)==null||a.beginProgressiveDisplay(),(h=(l=this.conversationView)==null?void 0:l.scrollToTop)==null||h.call(l);const x=[];let k=[];for await(const y of this.client.streamSessionEntries(f,ve,e.signal)){if(e.signal.aborted)return;x.push(y),k.push(y),k.length>=ve&&((p=this.conversationView)==null||p.appendEntries(k),k=[])}if(e.signal.aborted)return;k.length>0&&((u=this.conversationView)==null||u.appendEntries(k)),(g=this.conversationView)==null||g.finalizeProgressiveDisplay(),this.currentSession={meta:t,entries:x},Promise.resolve((b=(m=this.options).onSessionLoaded)==null?void 0:b.call(m,t,x))}catch(f){if(e.signal.aborted)return;this.handleError(f instanceof Error?f:new Error(String(f)))}finally{this.sessionLoadController===e&&(this.sessionLoadController=null)}}showProjectTimelinePanel(t,e){var i,s,n;(i=this.projectTimelinePanel)==null||i.setProject(t,e),(s=this.projectTimelinePanel)==null||s.show(),this.layout.timelinePanelContainer.classList.add("visible"),(n=this.conversationView)==null||n.refreshToolbar()}hideProjectTimelinePanel(){var t,e;(t=this.projectTimelinePanel)==null||t.hide(),this.layout.timelinePanelContainer.classList.remove("visible"),(e=this.conversationView)==null||e.refreshToolbar()}handleTimelinePanelVisibilityChange(t){var e;this.layout.timelinePanelContainer.classList.toggle("visible",t),(e=this.conversationView)==null||e.refreshToolbar()}isTimelinePanelVisible(){return this.layout.timelinePanelContainer.classList.contains("visible")??!1}handleTimelinePanelToggle(){var t;(t=this.currentProject)!=null&&t.id&&(this.isTimelinePanelVisible()?this.hideProjectTimelinePanel():this.showProjectTimelinePanel(this.currentProject.id,this.currentProject.source))}handleError(t){var e,i;console.error("ApiViewer error:",t),(i=(e=this.options).onError)==null||i.call(e,t),this.updateConnectionStatus(!1,t.message)}handleSidebarCollapsedChange(t){var e;(e=this.conversationView)==null||e.refreshToolbar(),window.dispatchEvent(new CustomEvent("thinkt:sidebar-collapsed-change",{detail:{collapsed:t}}))}getCurrentProject(){return this.currentProject}whenReady(){return this.initialized}getCurrentSession(){return this.currentSession}async loadSession(t){const e=await this.client.getSessionMetadata(t,{summaryOnly:!0,limit:1}),i=e.meta;await this.handleSessionSelect({...i,fullPath:i.fullPath??t,entryCount:e.totalEntries||i.entryCount})}refreshProjects(){var t,e,i;switch(this.filterBar.discoverSourcesFromProjects(),this.currentProjectView){case"list":return((t=this.projectBrowser)==null?void 0:t.refresh())??Promise.resolve();case"tree":return((e=this.treeProjectBrowser)==null?void 0:e.refresh())??Promise.resolve();case"timeline":return((i=this.timelineVisualization)==null?void 0:i.refresh())??Promise.resolve();default:return Promise.resolve()}}setProjectView(t){this.switchProjectView(t)}getProjectView(){return this.currentProjectView}getProjectBrowser(){return this.projectBrowser}getTreeProjectBrowser(){return this.treeProjectBrowser}getTimelineVisualization(){return this.timelineVisualization}getProjectTimelinePanel(){return this.projectTimelinePanel}getSessionList(){return this.sessionList}getConversationView(){return this.conversationView}focusProjectSearch(){this.filterBar.focusSearch()}focusSessionSearch(){var t;(t=this.sessionList)==null||t.focusSearch()}async selectProject(t){var i,s,n;let e=(i=this.projectBrowser)==null?void 0:i.getProjects().find(o=>o.id===t);e||(await this.refreshProjects(),e=(s=this.projectBrowser)==null?void 0:s.getProjects().find(o=>o.id===t)),e||(e=(await this.client.getProjects(void 0,{includeDeleted:this.projectFilters.includeDeleted})).find(a=>a.id===t)),e&&((n=this.projectBrowser)==null||n.selectProjectById(t),this.handleProjectSelect(e))}async selectProjectByName(t){var i,s;let e=(i=this.projectBrowser)==null?void 0:i.getProjects().find(n=>n.name===t);e||(await this.refreshProjects(),e=(s=this.projectBrowser)==null?void 0:s.getProjects().find(n=>n.name===t)),e||(e=(await this.client.getProjects(void 0,{includeDeleted:this.projectFilters.includeDeleted})).find(o=>o.name===t)),e!=null&&e.id&&await this.selectProject(e.id)}selectSessionById(t){var e;(e=this.sessionList)==null||e.selectSessionById(t)}scrollToEntry(t){var e;(e=this.conversationView)==null||e.scrollToEntry(t)}toggleSidebar(){this.layout.toggleSidebarCollapsed()}isSidebarCollapsed(){return this.layout.isSidebarCollapsed()}dispose(){var t,e,i,s,n,o,a;this.disposed||(this.abortController.abort(),(t=this.sessionLoadController)==null||t.abort(),this.layout.dispose(),(e=this.projectBrowser)==null||e.dispose(),(i=this.treeProjectBrowser)==null||i.dispose(),(s=this.timelineVisualization)==null||s.dispose(),(n=this.sessionList)==null||n.dispose(),(o=this.conversationView)==null||o.dispose(),(a=this.projectTimelinePanel)==null||a.dispose(),this.projectBrowser=null,this.treeProjectBrowser=null,this.timelineVisualization=null,this.sessionList=null,this.conversationView=null,this.projectTimelinePanel=null,this.currentProject=null,this.currentSession=null,this.disposed=!0)}}class Qs{constructor(t){d(this,"projects",new Map);d(this,"selectedProjects",new Set);d(this,"container");d(this,"listContainer");d(this,"onFilterChanged");d(this,"signal");this.container=t.container,this.listContainer=t.listContainer,this.onFilterChanged=t.onFilterChanged,this.signal=t.signal}extractProjects(t){this.projects.clear();for(const e of t){const i=e.project_name;if(!i)continue;const s=this.projects.get(i);s?s.count++:this.projects.set(i,{name:i,count:1,source:e.source??"claude"})}this.selectedProjects=new Set(this.projects.keys())}getSelectedProjects(){return this.selectedProjects}isProjectSelected(t){return this.selectedProjects.size===0?!0:t!=null&&this.selectedProjects.has(t)}render(){if(this.projects.size===0){this.container.style.display="none";return}this.container.style.display="flex";const t=Array.from(this.projects.values()).sort((s,n)=>s.name.localeCompare(n.name));this.listContainer.replaceChildren();for(const s of t){const n=document.createElement("div");n.className="thinkt-search-project-item";const o=this.selectedProjects.has(s.name);n.innerHTML=`
        <input type="checkbox" id="proj-${at(s.name)}" ${o?"checked":""}>
        <label for="proj-${at(s.name)}">
          <span class="thinkt-search-project-name" title="${at(s.name)}">${at(s.name)}</span>
          <span class="thinkt-search-project-count">${s.count}</span>
        </label>
      `;const a=n.querySelector("input");if(a){const h=()=>{a.checked?this.selectedProjects.add(s.name):this.selectedProjects.delete(s.name),this.onFilterChanged()};a.addEventListener("change",h,{signal:this.signal})}const l=n.querySelector("label");l&&l.addEventListener("click",h=>{h.preventDefault(),a&&(a.checked=!a.checked,a.dispatchEvent(new Event("change")))}),this.listContainer.appendChild(n)}const e=this.container.querySelector("#search-select-all");if(e){const s=()=>{if(this.selectedProjects.size===this.projects.size)this.selectedProjects.clear();else for(const o of this.projects.keys())this.selectedProjects.add(o);this.render(),this.onFilterChanged()};e.addEventListener("click",s,{signal:this.signal})}const i=this.container.querySelector("#search-select-none");if(i){const s=()=>{this.selectedProjects.clear(),this.render(),this.onFilterChanged()};i.addEventListener("click",s,{signal:this.signal})}}hide(){this.container.style.display="none"}clear(){this.projects.clear(),this.selectedProjects.clear()}}function at(r){const t=document.createElement("div");return t.textContent=r,t.innerHTML}const we=300;class Gs{constructor(t){d(this,"container");d(this,"onSelectResult");d(this,"onHoverResult");this.container=t.container,this.onSelectResult=t.onSelectResult,this.onHoverResult=t.onHoverResult}renderTextResults(t,e,i){if(t.length===0){e?this.container.innerHTML=`
          <div class="thinkt-search-empty">
            <div class="thinkt-search-empty-icon">ðŸ˜•</div>
            <div>${c._("No results found")}</div>
          </div>
        `:this.container.innerHTML=`
          <div class="thinkt-search-empty">
            <div class="thinkt-search-empty-icon">ðŸ“</div>
            <div>${c._("No results for selected projects")}</div>
            <div style="font-size: 11px; margin-top: 8px;">${c._("Select projects from the sidebar to filter")}</div>
          </div>
        `;return}const s=document.createElement("ul");s.className="thinkt-search-results",t.forEach((n,o)=>{const a=this.createTextResultItem(n,o,i);s.appendChild(a)}),this.container.replaceChildren(),this.container.appendChild(s),this.updateSelection(i)}createTextResultItem(t,e,i){const s=document.createElement("li");s.className="thinkt-search-result",e===i&&s.classList.add("selected");const n=t.source??"claude",o=t.matches??[],a=o.length,l=o.map(h=>this.renderMatchPreview(h)).join("");return s.innerHTML=`
      <div class="thinkt-search-result-header">
        <span class="thinkt-search-result-project">${I(t.project_name??c._("Unknown"))}</span>
        <span class="thinkt-search-result-sep">Â·</span>
        <span class="thinkt-search-result-session">${I(ye(t.session_id??""))}</span>
        <span class="thinkt-search-result-source thinkt-search-result-source--${n}">${n}</span>
        <span class="thinkt-search-result-matches">${c._("{count, plural, one {# match} other {# matches}}",{count:a})}</span>
      </div>
      ${l}
    `,s.addEventListener("click",()=>{this.onSelectResult(e)}),s.addEventListener("mouseenter",()=>{this.onHoverResult(e)}),s}renderMatchPreview(t){const e=t.preview??"",i=t.role??"unknown";return`
      <div class="thinkt-search-result-preview">
        <span class="thinkt-search-result-role">[${I(i)}]:</span>
        ${I(e)}
      </div>
    `}renderSemanticResults(t,e,i){if(t.length===0){this.container.innerHTML=`
        <div class="thinkt-search-empty">
          <div class="thinkt-search-empty-icon">ðŸ§ </div>
          <div>${c._("No semantic matches found")}</div>
        </div>
      `;return}const s=document.createElement("ul");s.className="thinkt-search-results",t.forEach((n,o)=>{const a=this.createSemanticResultItem(n,o,e,i);s.appendChild(a)}),this.container.replaceChildren(),this.container.appendChild(s),this.updateSelection(i)}createSemanticResultItem(t,e,i,s){const n=document.createElement("li");n.className="thinkt-search-result",e===s&&n.classList.add("selected");const o=t.source??"claude",a=t.distance??1,l=Js(a),h=t.first_prompt?I(vt(t.first_prompt,120)):"",p=t.timestamp?tn(t.timestamp):"",u=t.entry_uuid??"",g=i.get(u),m=t.role??"",b=g?`<div class="thinkt-search-result-preview"><span class="thinkt-search-result-role">[${I(m)}]:</span> ${I(vt(g,we))}</div>`:`<div class="thinkt-search-preview-loading" data-entry-uuid="${I(u)}">${c._("Loading preview...")}</div>`;return n.innerHTML=`
      <div class="thinkt-search-result-header">
        <span class="thinkt-search-result-project">${I(t.project_name??c._("Unknown"))}</span>
        <span class="thinkt-search-result-sep">Â·</span>
        <span class="thinkt-search-result-session">${I(ye(t.session_id??""))}</span>
        <span class="thinkt-search-result-source thinkt-search-result-source--${o}">${o}</span>
        <span class="thinkt-search-result-timestamp">${p}</span>
        <span class="thinkt-search-result-relevance ${l.className}">${l.label}</span>
      </div>
      ${h?`<div class="thinkt-search-result-first-prompt">${h}</div>`:""}
      ${b}
    `,n.addEventListener("click",()=>{this.onSelectResult(e)}),n.addEventListener("mouseenter",()=>{this.onHoverResult(e)}),n}updateSemanticPreviews(t,e){this.container.querySelectorAll(".thinkt-search-preview-loading").forEach(s=>{const n=s.dataset.entryUuid;if(!n)return;const o=e.get(n);if(o){const a=t.find(h=>h.entry_uuid===n),l=(a==null?void 0:a.role)??"";s.className="thinkt-search-result-preview",s.innerHTML=`<span class="thinkt-search-result-role">[${I(l)}]:</span> ${I(vt(o,we))}`}})}renderEmpty(){this.container.innerHTML=`
      <div class="thinkt-search-empty">
        <div class="thinkt-search-empty-icon">ðŸ”</div>
        <div>Type to search across all indexed sessions</div>
      </div>
    `}renderLoading(){this.container.innerHTML=`
      <div class="thinkt-search-loading">
        <div>${c._("Searching...")}</div>
      </div>
    `}renderError(t){t.message.includes("indexer")||t.message.includes("503")?this.container.innerHTML=`
        <div class="thinkt-search-no-indexer">
          <div class="thinkt-search-no-indexer-title">${c._("Indexer not available")}</div>
          <div>${c._("The search feature requires the thinkt-indexer to be installed and configured.")}</div>
        </div>
      `:this.container.innerHTML=`
        <div class="thinkt-search-error">
          <div>${c._("Error: {message}",{message:I(t.message)})}</div>
        </div>
      `}updateSelection(t){this.container.querySelectorAll(".thinkt-search-result").forEach((i,s)=>{i.classList.toggle("selected",s===t),s===t&&i.scrollIntoView({block:"nearest",behavior:"smooth"})})}}function I(r){const t=document.createElement("div");return t.textContent=r,t.innerHTML}function ye(r){return r?r.length>8?r.slice(0,8)+"...":r:""}function vt(r,t){return r.length<=t?r:r.slice(0,t)+"..."}function Js(r){return r<.5?{label:c._("High"),className:""}:r<1?{label:c._("Medium"),className:"medium"}:{label:c._("Low"),className:"low"}}function tn(r){try{const t=new Date(r),i=new Date().getTime()-t.getTime(),s=Math.floor(i/(1e3*60*60*24));return s===0?c._("today"):s===1?c._("yesterday"):s<7?c._("{days}d ago",{days:s}):s<30?c._("{weeks}w ago",{weeks:Math.floor(s/7)}):t.toLocaleDateString()}catch{return""}}const en='.thinkt-search-overlay{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1000;display:flex;align-items:flex-start;justify-content:center;padding-top:5vh;background:#000000b3;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);animation:thinkt-search-fade-in .15s ease}.thinkt-search-overlay.closing{animation:thinkt-search-fade-out .15s ease forwards}@keyframes thinkt-search-fade-in{0%{opacity:0}to{opacity:1}}@keyframes thinkt-search-fade-out{0%{opacity:1}to{opacity:0}}.thinkt-search-modal{width:85%;max-width:1200px;max-height:85vh;background:var(--thinkt-bg-secondary, #0f1115);border:1px solid var(--thinkt-border-color, rgba(255, 255, 255, .08));border-radius:var(--radius-lg, 8px);box-shadow:0 25px 50px -12px #00000080;display:flex;flex-direction:column;overflow:hidden;animation:thinkt-search-slide-in .2s ease}@keyframes thinkt-search-slide-in{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.thinkt-search-header{padding:16px;border-bottom:1px solid var(--thinkt-border-color, rgba(255, 255, 255, .08));display:flex;flex-direction:column;gap:12px}.thinkt-search-title{font-size:14px;font-weight:600;color:var(--thinkt-text-primary, #f8fafc);display:flex;align-items:center;justify-content:space-between;gap:12px}.thinkt-search-title-main{display:flex;align-items:center;gap:12px;min-width:0;flex-wrap:wrap}.thinkt-search-close-wrap{display:inline-flex;align-items:center;gap:8px}.thinkt-search-close-btn{width:28px;height:28px;display:inline-flex;align-items:center;justify-content:center;padding:0;border-radius:8px;border:1px solid rgba(239,68,68,.45);background:var(--thinkt-bg-tertiary, #181a1f);color:#fca5a5;cursor:pointer;font-size:18px;line-height:1;transition:all .12s ease}.thinkt-search-close-btn:hover{border-color:#ef4444cc;color:#fecaca;background:#ef44441a}.thinkt-search-close-btn:focus{outline:none;box-shadow:0 0 0 2px #ef444440}.thinkt-search-input-wrapper{position:relative;display:flex;align-items:center}.thinkt-search-icon{position:absolute;left:12px;color:var(--thinkt-muted-color, #64748b);font-size:16px;pointer-events:none}.thinkt-search-input{width:100%;padding:10px 12px 10px 36px;background:var(--thinkt-bg-tertiary, #181a1f);border:1px solid var(--thinkt-border-color-light, rgba(255, 255, 255, .12));border-radius:var(--radius-md, 6px);color:var(--thinkt-text-primary, #f8fafc);font-size:14px;outline:none;transition:border-color .15s ease}.thinkt-search-input:focus{border-color:var(--thinkt-accent-color, #6366f1)}.thinkt-search-input::placeholder{color:var(--thinkt-muted-color, #64748b)}.thinkt-search-options{display:flex;gap:12px;flex-wrap:wrap;font-size:12px}.thinkt-search-option{display:flex;align-items:center;gap:6px;color:var(--thinkt-text-secondary, #94a3b8);cursor:pointer;-webkit-user-select:none;user-select:none}.thinkt-search-option input[type=checkbox]{width:14px;height:14px;accent-color:var(--thinkt-accent-color, #6366f1);cursor:pointer}.thinkt-search-body{display:flex;flex:1;min-height:0}.thinkt-search-projects{width:220px;min-width:220px;border-right:1px solid var(--thinkt-border-color, rgba(255, 255, 255, .08));background:var(--thinkt-bg-tertiary, #181a1f);display:flex;flex-direction:column}.thinkt-search-projects-header{padding:12px 16px;border-bottom:1px solid var(--thinkt-border-color, rgba(255, 255, 255, .08));font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--thinkt-muted-color, #64748b);display:flex;justify-content:space-between;align-items:center}.thinkt-search-projects-actions{display:flex;gap:4px}.thinkt-search-projects-actions button{background:none;border:none;color:var(--thinkt-accent-color, #6366f1);font-size:11px;cursor:pointer;padding:2px 6px;border-radius:4px}.thinkt-search-projects-actions button:hover{background:var(--thinkt-hover-bg, rgba(255, 255, 255, .04))}.thinkt-search-projects-list{flex:1;overflow-y:auto;padding:8px}.thinkt-search-project-item{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:var(--radius-sm, 4px);cursor:pointer;font-size:12px;color:var(--thinkt-text-secondary, #94a3b8);transition:background-color .12s ease}.thinkt-search-project-item:hover{background:var(--thinkt-hover-bg, rgba(255, 255, 255, .04))}.thinkt-search-project-item input[type=checkbox]{width:14px;height:14px;accent-color:var(--thinkt-accent-color, #6366f1);cursor:pointer;flex-shrink:0}.thinkt-search-project-item label{flex:1;cursor:pointer;display:flex;align-items:center;gap:6px;overflow:hidden}.thinkt-search-project-name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.thinkt-search-project-count{font-size:10px;color:var(--thinkt-muted-color, #64748b);background:var(--thinkt-bg-secondary, #0f1115);padding:1px 4px;border-radius:3px;flex-shrink:0}.thinkt-search-content{flex:1;overflow-y:auto;min-height:0}.thinkt-search-results{list-style:none;margin:0;padding:8px}.thinkt-search-result{padding:12px;border-radius:var(--radius-md, 6px);cursor:pointer;transition:background-color .12s ease;margin-bottom:4px}.thinkt-search-result:hover,.thinkt-search-result.selected{background:var(--thinkt-hover-bg, rgba(255, 255, 255, .04))}.thinkt-search-result.selected{border-left:2px solid var(--thinkt-accent-color, #6366f1);margin-left:-2px}.thinkt-search-result-header{display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap}.thinkt-search-result-project{font-weight:500;font-size:13px;color:var(--thinkt-text-primary, #f8fafc)}.thinkt-search-result-sep{color:var(--thinkt-muted-color, #64748b);font-size:12px}.thinkt-search-result-session{font-family:var(--thinkt-font-mono, "SF Mono", Monaco, "Cascadia Code", monospace);font-size:12px;color:var(--thinkt-text-secondary, #94a3b8)}.thinkt-search-result-source{font-size:10px;text-transform:uppercase;padding:2px 6px;border-radius:var(--radius-sm, 4px);font-weight:600;letter-spacing:.3px}.thinkt-search-result-source--claude{background:var(--thinkt-source-claude-bg, rgba(217, 119, 80, .15));color:var(--thinkt-source-claude-color, #d97750)}.thinkt-search-result-source--kimi{background:var(--thinkt-source-kimi-bg, rgba(25, 195, 155, .15));color:var(--thinkt-source-kimi-color, #19c39b)}.thinkt-search-result-source--gemini{background:var(--thinkt-source-gemini-bg, rgba(99, 102, 241, .15));color:var(--thinkt-source-gemini-color, #6366f1)}.thinkt-search-result-matches{font-size:12px;color:var(--thinkt-muted-color, #64748b);margin-left:auto}.thinkt-search-result-preview{font-size:12px;line-height:1.5;color:var(--thinkt-text-secondary, #94a3b8);font-family:var(--thinkt-font-mono, "SF Mono", Monaco, "Cascadia Code", monospace);padding:8px;background:var(--thinkt-bg-tertiary, #181a1f);border-radius:var(--radius-sm, 4px);overflow-x:auto;white-space:pre-wrap;word-break:break-word}.thinkt-search-result-preview mark{background:#6366f14d;color:var(--thinkt-text-primary, #f8fafc);padding:1px 2px;border-radius:2px;font-weight:600}.thinkt-search-result-role{display:inline-block;font-size:10px;color:var(--thinkt-muted-color, #64748b);margin-right:8px;text-transform:lowercase}.thinkt-search-empty,.thinkt-search-loading,.thinkt-search-error{padding:48px;text-align:center;color:var(--thinkt-muted-color, #64748b)}.thinkt-search-empty-icon{font-size:32px;margin-bottom:12px;opacity:.5}.thinkt-search-help{padding:12px 16px;border-top:1px solid var(--thinkt-border-color, rgba(255, 255, 255, .08));font-size:11px;color:var(--thinkt-muted-color, #64748b);display:flex;justify-content:space-between;align-items:center}.thinkt-search-help kbd{font-family:var(--thinkt-font-mono, "SF Mono", Monaco, "Cascadia Code", monospace);padding:2px 4px;background:var(--thinkt-bg-tertiary, #181a1f);border:1px solid var(--thinkt-border-color-light, rgba(255, 255, 255, .12));border-radius:var(--radius-sm, 4px);margin:0 2px}.thinkt-search-no-indexer{padding:32px;text-align:center;color:var(--thinkt-muted-color, #64748b)}.thinkt-search-no-indexer-title{font-size:14px;font-weight:500;color:var(--thinkt-text-secondary, #94a3b8);margin-bottom:8px}.thinkt-search-mode-toggle{display:flex;gap:0;background:var(--thinkt-bg-tertiary, #181a1f);border:1px solid var(--thinkt-border-color-light, rgba(255, 255, 255, .12));border-radius:var(--radius-md, 6px);overflow:hidden;font-size:12px}.thinkt-search-mode-btn{padding:6px 14px;background:none;border:none;color:var(--thinkt-muted-color, #64748b);cursor:pointer;transition:all .15s ease;font-size:12px;white-space:nowrap}.thinkt-search-mode-btn:hover{color:var(--thinkt-text-secondary, #94a3b8)}.thinkt-search-mode-btn.active{background:var(--thinkt-accent-color, #6366f1);color:#fff}.thinkt-search-semantic-hint{font-size:11px;color:var(--thinkt-muted-color, #64748b);font-style:italic;padding:0 4px}.thinkt-search-result-relevance{font-size:10px;padding:2px 6px;border-radius:var(--radius-sm, 4px);font-weight:600;background:#22c55e26;color:#22c55e;margin-left:auto;flex-shrink:0}.thinkt-search-result-relevance.medium{background:#eab30826;color:#eab308}.thinkt-search-result-relevance.low{background:#ef444426;color:#ef4444}.thinkt-search-result-first-prompt{font-size:11px;color:var(--thinkt-muted-color, #64748b);margin-top:4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.thinkt-search-result-timestamp{font-size:11px;color:var(--thinkt-muted-color, #64748b)}.thinkt-search-preview-loading{font-size:12px;color:var(--thinkt-muted-color, #64748b);font-style:italic;padding:8px;background:var(--thinkt-bg-tertiary, #181a1f);border-radius:var(--radius-sm, 4px)}',sn=150,_e=150,Se=300;class nn{constructor(t){d(this,"elements");d(this,"options");d(this,"client");d(this,"overlay",null);d(this,"input",null);d(this,"searchController",null);d(this,"searchDebounceTimer",null);d(this,"abortController",new AbortController);d(this,"isOpen",!1);d(this,"caseSensitive",!1);d(this,"useRegex",!1);d(this,"searchMode","text");d(this,"results",[]);d(this,"filteredResults",[]);d(this,"semanticResults",[]);d(this,"filteredSemanticResults",[]);d(this,"semanticPreviews",new Map);d(this,"selectedIndex",-1);d(this,"projectFilter",null);d(this,"resultRenderer",null);this.elements=t.elements,this.options=t,this.client=t.client??B(),N("thinkt-search-overlay-styles",en)}open(){var t;this.isOpen||(this.isOpen=!0,this.createOverlay(),this.attachListeners(),(t=this.input)==null||t.focus())}close(){!this.isOpen||!this.overlay||(this.isOpen=!1,this.overlay.classList.add("closing"),setTimeout(()=>{var t,e;this.cleanup(),(e=(t=this.options).onClose)==null||e.call(t)},sn))}cleanup(){var t;this.abortController.abort(),this.abortController=new AbortController,this.searchDebounceTimer&&(clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=null),(t=this.overlay)==null||t.remove(),this.overlay=null,this.input=null,this.results=[],this.filteredResults=[],this.selectedIndex=-1,this.semanticResults=[],this.filteredSemanticResults=[],this.semanticPreviews.clear(),this.projectFilter=null,this.resultRenderer=null}createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="thinkt-search-overlay",this.overlay.innerHTML=`
      <div class="thinkt-search-modal">
        <div class="thinkt-search-header">
          <div class="thinkt-search-title">
            <div class="thinkt-search-title-main">
              <span>${c._("Search Sessions")}</span>
              <div class="thinkt-search-mode-toggle">
                <button class="thinkt-search-mode-btn active" data-mode="text">${c._("Text")}</button>
                <button class="thinkt-search-mode-btn" data-mode="semantic">${c._("Semantic")}</button>
              </div>
            </div>
            <div class="thinkt-search-close-wrap">
              <button id="search-close-btn" type="button" class="thinkt-search-close-btn" aria-label="${c._("Close")}" title="${c._("Close")} - ESC">&times;</button>
            </div>
          </div>
          <div class="thinkt-search-input-wrapper">
            <span class="thinkt-search-icon">ðŸ”</span>
            <input type="text" class="thinkt-search-input" placeholder="${c._("Type to search across all sessions...")}" autocomplete="off">
          </div>
          <div class="thinkt-search-options" id="search-text-options">
            <label class="thinkt-search-option">
              <input type="checkbox" id="search-case-sensitive">
              <span>${c._("Case sensitive")}</span>
            </label>
            <label class="thinkt-search-option">
              <input type="checkbox" id="search-regex">
              <span>${c._("Regex")}</span>
            </label>
          </div>
          <div class="thinkt-search-options" id="search-semantic-options" style="display: none;">
            <span class="thinkt-search-semantic-hint">${c._("Ask a question in natural language")}</span>
          </div>
        </div>
        <div class="thinkt-search-body">
          <div class="thinkt-search-projects" style="display: none;">
            <div class="thinkt-search-projects-header">
              <span>${c._("Projects")}</span>
              <div class="thinkt-search-projects-actions">
                <button id="search-select-all">${c._("All")}</button>
                <button id="search-select-none">${c._("None")}</button>
              </div>
            </div>
            <div class="thinkt-search-projects-list"></div>
          </div>
          <div class="thinkt-search-content">
            <div class="thinkt-search-empty">
              <div class="thinkt-search-empty-icon">ðŸ”</div>
              <div>${c._("Type to search across all indexed sessions")}</div>
            </div>
          </div>
        </div>
        <div class="thinkt-search-help">
          <span><kbd>â†‘</kbd><kbd>â†“</kbd> ${c._("to navigate")} <kbd>â†µ</kbd> ${c._("to select")}</span>
          <span>${c._("Search uses the indexer database")}</span>
        </div>
      </div>
    `,this.elements.container.appendChild(this.overlay),this.input=this.overlay.querySelector(".thinkt-search-input");const t=this.overlay.querySelector(".thinkt-search-projects"),e=this.overlay.querySelector(".thinkt-search-projects-list"),i=this.overlay.querySelector(".thinkt-search-content");this.projectFilter=new Qs({container:t,listContainer:e,onFilterChanged:()=>this.applyProjectFilter(),signal:this.abortController.signal}),this.resultRenderer=new Gs({container:i,onSelectResult:s=>this.handleResultSelect(s),onHoverResult:s=>{this.selectedIndex=s,this.resultRenderer.updateSelection(this.selectedIndex)}})}attachListeners(){if(!this.overlay)return;this.overlay.addEventListener("click",n=>{n.target===this.overlay&&this.close()},{signal:this.abortController.signal}),this.input&&(this.input.addEventListener("input",()=>this.handleSearchInput(),{signal:this.abortController.signal}),this.input.addEventListener("keydown",n=>this.handleKeydown(n),{signal:this.abortController.signal}));const t=this.overlay.querySelector("#search-close-btn");t==null||t.addEventListener("click",()=>this.close(),{signal:this.abortController.signal});const e=this.overlay.querySelector("#search-case-sensitive"),i=this.overlay.querySelector("#search-regex");e&&e.addEventListener("change",()=>{this.caseSensitive=e.checked,this.triggerSearch()},{signal:this.abortController.signal}),i&&i.addEventListener("change",()=>{this.useRegex=i.checked,this.triggerSearch()},{signal:this.abortController.signal}),this.overlay.querySelectorAll(".thinkt-search-mode-btn").forEach(n=>{n.addEventListener("click",()=>{const o=n.dataset.mode;this.setSearchMode(o)},{signal:this.abortController.signal})}),document.addEventListener("keydown",n=>{n.key==="Escape"&&(n.preventDefault(),this.close())},{signal:this.abortController.signal})}setSearchMode(t){var n,o,a;if(this.searchMode===t)return;this.searchMode=t;const e=(n=this.overlay)==null?void 0:n.querySelectorAll(".thinkt-search-mode-btn");e==null||e.forEach(l=>{l.classList.toggle("active",l.dataset.mode===t)});const i=(o=this.overlay)==null?void 0:o.querySelector("#search-text-options"),s=(a=this.overlay)==null?void 0:a.querySelector("#search-semantic-options");i&&(i.style.display=t==="text"?"flex":"none"),s&&(s.style.display=t==="semantic"?"flex":"none"),this.input&&(this.input.placeholder=t==="text"?c._("Type to search across all sessions..."):c._("Ask a question about your sessions...")),this.triggerSearch()}applyProjectFilter(){if(this.searchMode==="semantic"){const t=this.projectFilter.getSelectedProjects();t.size===0?this.filteredSemanticResults=[...this.semanticResults]:this.filteredSemanticResults=this.semanticResults.filter(e=>e.project_name&&t.has(e.project_name)),this.selectedIndex=this.filteredSemanticResults.length>0?0:-1,this.resultRenderer.renderSemanticResults(this.filteredSemanticResults,this.semanticPreviews,this.selectedIndex)}else{const t=this.projectFilter.getSelectedProjects();t.size===0?this.filteredResults=[...this.results]:this.filteredResults=this.results.filter(e=>e.project_name&&t.has(e.project_name)),this.selectedIndex=this.filteredResults.length>0?0:-1,this.resultRenderer.renderTextResults(this.filteredResults,this.results.length===0,this.selectedIndex)}}handleSearchInput(){var e,i,s;this.searchDebounceTimer&&clearTimeout(this.searchDebounceTimer);const t=((e=this.input)==null?void 0:e.value.trim())??"";if(!t){(i=this.projectFilter)==null||i.hide(),(s=this.resultRenderer)==null||s.renderEmpty();return}this.searchDebounceTimer=setTimeout(()=>{this.performSearch(t)},this.searchMode==="semantic"?Se:_e)}triggerSearch(){var e;const t=((e=this.input)==null?void 0:e.value.trim())??"";t&&(this.searchDebounceTimer&&clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=setTimeout(()=>{this.performSearch(t)},this.searchMode==="semantic"?Se:_e))}async performSearch(t){var i,s,n,o,a;(i=this.searchController)==null||i.abort();const e=new AbortController;this.searchController=e,(s=this.resultRenderer)==null||s.renderLoading();try{this.searchMode==="semantic"?await this.performSemanticSearch(t,e.signal):await this.performTextSearch(t,e.signal)}catch(l){if(e.signal.aborted)return;const h=l instanceof Error?l:new Error(String(l));(n=this.resultRenderer)==null||n.renderError(h),(a=(o=this.options).onError)==null||a.call(o,h)}finally{this.searchController===e&&(this.searchController=null)}}async performTextSearch(t,e){const i={query:t,limit:50,limitPerSession:2,caseSensitive:this.caseSensitive,regex:this.useRegex,signal:e},s=await this.client.search(i);this.results=s.sessions??[],this.projectFilter.extractProjects(this.results),this.filteredResults=[...this.results],this.selectedIndex=this.filteredResults.length>0?0:-1,this.projectFilter.render(),this.resultRenderer.renderTextResults(this.filteredResults,this.results.length===0,this.selectedIndex)}async performSemanticSearch(t,e){const i={query:t,limit:20,diversity:!0,signal:e},s=await this.client.semanticSearch(i);this.semanticResults=s.results??[],this.projectFilter.extractProjects(this.semanticResults),this.filteredSemanticResults=[...this.semanticResults],this.selectedIndex=this.filteredSemanticResults.length>0?0:-1,this.projectFilter.render(),this.resultRenderer.renderSemanticResults(this.filteredSemanticResults,this.semanticPreviews,this.selectedIndex),this.fetchSemanticPreviews()}async fetchSemanticPreviews(){var e;const t=this.filteredSemanticResults.map(async i=>{if(!(!i.session_path||!i.entry_uuid))try{const s=i.line_number??0,n=await this.client.getSession(i.session_path,{limit:1,offset:s}),o=n.entries.find(a=>a.uuid===i.entry_uuid)??n.entries[0];o!=null&&o.text&&this.semanticPreviews.set(i.entry_uuid,o.text)}catch(s){console.warn("[THINKT] Failed to fetch preview for entry:",i.entry_uuid,s)}});await Promise.allSettled(t),this.searchMode==="semantic"&&this.isOpen&&((e=this.resultRenderer)==null||e.updateSemanticPreviews(this.filteredSemanticResults,this.semanticPreviews))}handleResultSelect(t){if(this.searchMode==="semantic"){const e=this.filteredSemanticResults[t];e&&this.selectSemanticResult(e)}else{const e=this.filteredResults[t];e&&this.selectResult(e)}}async selectResult(t){var e,i,s;try{const n=(e=t.matches)==null?void 0:e[0],o=n==null?void 0:n.line_num;await((s=(i=this.options).onSessionSelect)==null?void 0:s.call(i,t,o))}finally{this.close()}}async selectSemanticResult(t){var e,i;try{await((i=(e=this.options).onSessionSelect)==null?void 0:i.call(e,t,t.line_number))}finally{this.close()}}handleKeydown(t){switch(t.key){case"ArrowDown":t.preventDefault(),this.selectNext();break;case"ArrowUp":t.preventDefault(),this.selectPrevious();break;case"Enter":t.preventDefault(),this.selectCurrent();break}}selectNext(){var e;const t=this.searchMode==="semantic"?this.filteredSemanticResults.length:this.filteredResults.length;t!==0&&(this.selectedIndex=(this.selectedIndex+1)%t,(e=this.resultRenderer)==null||e.updateSelection(this.selectedIndex))}selectPrevious(){var e;const t=this.searchMode==="semantic"?this.filteredSemanticResults.length:this.filteredResults.length;t!==0&&(this.selectedIndex=this.selectedIndex<=0?t-1:this.selectedIndex-1,(e=this.resultRenderer)==null||e.updateSelection(this.selectedIndex))}selectCurrent(){this.selectedIndex>=0&&this.handleResultSelect(this.selectedIndex)}isOpened(){return this.isOpen}dispose(){this.close()}}const rn='.thinkt-settings-overlay{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1000;display:flex;align-items:flex-start;justify-content:center;padding-top:4vh;background:#000000b8;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);animation:thinkt-settings-fade-in .15s ease}.thinkt-settings-overlay.closing{animation:thinkt-settings-fade-out .15s ease forwards}@keyframes thinkt-settings-fade-in{0%{opacity:0}to{opacity:1}}@keyframes thinkt-settings-fade-out{0%{opacity:1}to{opacity:0}}.thinkt-settings-modal{width:min(1100px,92vw);max-height:90vh;display:flex;flex-direction:column;background:var(--thinkt-bg-secondary, #0f1115);border:1px solid var(--thinkt-border-color, rgba(255, 255, 255, .12));border-radius:var(--radius-lg, 14px);box-shadow:0 26px 60px #00000073;overflow:hidden}.thinkt-settings-header{display:flex;align-items:flex-start;justify-content:space-between;gap:16px;padding:16px;border-bottom:1px solid var(--thinkt-border-color, rgba(255, 255, 255, .1))}.thinkt-settings-title-wrap{display:flex;flex-direction:column;gap:0;min-width:0}.thinkt-settings-title{font-size:15px;font-weight:700;color:var(--thinkt-text-primary, #f8fafc)}.thinkt-settings-tabs{display:inline-flex;gap:6px;padding:4px;border-radius:10px;background:var(--thinkt-bg-tertiary, #181a1f);border:1px solid var(--thinkt-border-color, rgba(255, 255, 255, .1))}.thinkt-settings-tab{border:none;background:transparent;color:var(--thinkt-text-secondary, #94a3b8);font-size:12px;font-weight:600;padding:7px 12px;border-radius:8px;cursor:pointer;transition:all .12s ease}.thinkt-settings-tab:hover{color:var(--thinkt-text-primary, #f8fafc);background:var(--thinkt-hover-bg, rgba(255, 255, 255, .05))}.thinkt-settings-tab.active{color:#fff;background:var(--thinkt-accent-color, #6366f1)}.thinkt-settings-actions{display:flex;align-items:center;gap:8px}.thinkt-settings-close-btn{width:28px;height:28px;display:inline-flex;align-items:center;justify-content:center;padding:0;border-radius:8px;border:1px solid var(--thinkt-border-color-light, rgba(255, 255, 255, .16));background:var(--thinkt-bg-tertiary, #181a1f);border-color:#ef444473;color:#fca5a5;cursor:pointer;font-size:18px;line-height:1;transition:all .12s ease}.thinkt-settings-close-btn:focus{outline:none;box-shadow:0 0 0 2px #ef444440;color:#fca5a5}.thinkt-settings-close-btn:hover{border-color:#ef4444cc;color:#fecaca;background:#ef44441a}.thinkt-settings-body{padding:16px;overflow:auto;min-height:0}.thinkt-settings-panel{display:none;flex-direction:column;gap:14px}.thinkt-settings-panel.active{display:flex}.thinkt-settings-section{background:var(--thinkt-bg-tertiary, #181a1f);border:1px solid var(--thinkt-border-color, rgba(255, 255, 255, .1));border-radius:12px;padding:14px}.thinkt-settings-section h3{font-size:12px;font-weight:700;letter-spacing:.05em;text-transform:uppercase;color:var(--thinkt-text-secondary, #94a3b8);margin-bottom:10px}.thinkt-settings-loading{color:var(--thinkt-muted-color, #64748b);font-size:13px}.thinkt-settings-error{color:#fca5a5;font-size:13px}.thinkt-settings-muted{color:var(--thinkt-muted-color, #64748b);font-size:13px}.thinkt-settings-note{color:var(--thinkt-text-secondary, #94a3b8);font-size:12px;margin-bottom:10px}.thinkt-settings-stat-grid{display:grid;grid-template-columns:repeat(4,minmax(150px,1fr));gap:10px}.thinkt-settings-stat-grid--indexer{grid-template-columns:repeat(3,minmax(150px,1fr))}.thinkt-settings-stat-grid--embedding{grid-template-columns:repeat(2,minmax(180px,1fr))}.thinkt-settings-stat-card{background:#ffffff05;border:1px solid var(--thinkt-border-color, rgba(255, 255, 255, .1));border-radius:10px;padding:12px}.thinkt-settings-stat-label{color:var(--thinkt-text-secondary, #94a3b8);font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.05em}.thinkt-settings-stat-value{color:var(--thinkt-text-primary, #f8fafc);font-size:20px;font-weight:700;margin-top:4px;word-break:break-word}.thinkt-settings-stat-meta{margin-top:4px;color:var(--thinkt-muted-color, #64748b);font-size:11px}.thinkt-settings-subtitle{color:var(--thinkt-text-secondary, #94a3b8);font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;margin-top:12px;margin-bottom:8px}.thinkt-settings-list{display:flex;flex-direction:column;gap:8px}.thinkt-settings-system-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:8px}.thinkt-settings-system-grid .thinkt-settings-list-item{align-items:flex-start;min-height:100%}.thinkt-settings-list-item{display:flex;justify-content:space-between;gap:12px;align-items:center;padding:10px 12px;border:1px solid var(--thinkt-border-color, rgba(255, 255, 255, .1));border-radius:9px;background:#ffffff05}.thinkt-settings-list-content{min-width:0}.thinkt-settings-list-title{color:var(--thinkt-text-primary, #f8fafc);font-size:13px;font-weight:600;display:flex;flex-wrap:wrap;align-items:center;gap:6px}.thinkt-settings-list-meta{color:var(--thinkt-muted-color, #64748b);font-size:12px;margin-top:3px;word-break:break-word}.thinkt-settings-system-detail{margin-top:4px;color:var(--thinkt-text-secondary, #94a3b8);font-size:12px;display:flex;gap:6px;flex-wrap:wrap}.thinkt-settings-system-key{color:var(--thinkt-muted-color, #64748b);font-weight:600}.thinkt-settings-auth{display:flex;flex-direction:column;gap:10px}.thinkt-settings-auth-current{font-size:12px;color:var(--thinkt-text-secondary, #94a3b8);display:flex;gap:6px;flex-wrap:wrap;align-items:center}.thinkt-settings-auth-token{font-family:var(--thinkt-font-mono, "SF Mono", Monaco, "Cascadia Code", monospace);color:var(--thinkt-text-primary, #f8fafc);word-break:break-all}.thinkt-settings-auth-toggle{margin-left:2px;border:1px solid var(--thinkt-border-color-light, rgba(255, 255, 255, .16));background:var(--thinkt-bg-tertiary, #181a1f);color:var(--thinkt-text-secondary, #94a3b8);font-size:11px;font-weight:600;padding:3px 8px;border-radius:999px;cursor:pointer;transition:all .12s ease}.thinkt-settings-auth-toggle:hover:not(:disabled){color:var(--thinkt-text-primary, #f8fafc);border-color:var(--thinkt-accent-color, #6366f1)}.thinkt-settings-auth-toggle:disabled{opacity:.5;cursor:not-allowed}.thinkt-settings-auth-label{font-size:12px;color:var(--thinkt-text-secondary, #94a3b8);font-weight:600}.thinkt-settings-auth-input{width:100%;padding:9px 10px;border-radius:8px;border:1px solid var(--thinkt-border-color-light, rgba(255, 255, 255, .16));background:var(--thinkt-bg-secondary, #0f1115);color:var(--thinkt-text-primary, #f8fafc);font-size:13px;font-family:var(--thinkt-font-mono, "SF Mono", Monaco, "Cascadia Code", monospace)}.thinkt-settings-auth-input:focus{outline:none;border-color:var(--thinkt-accent-color, #6366f1);box-shadow:0 0 0 2px #6366f133}.thinkt-settings-auth-actions{display:flex;gap:8px;flex-wrap:wrap}.thinkt-settings-auth-btn{border:1px solid var(--thinkt-border-color-light, rgba(255, 255, 255, .16));background:var(--thinkt-bg-tertiary, #181a1f);color:var(--thinkt-text-secondary, #94a3b8);font-size:12px;font-weight:600;padding:7px 10px;border-radius:8px;cursor:pointer;transition:all .12s ease}.thinkt-settings-auth-btn:hover{color:var(--thinkt-text-primary, #f8fafc);border-color:var(--thinkt-accent-color, #6366f1)}.thinkt-settings-auth-btn--danger{border-color:#ef444473;color:#fca5a5}.thinkt-settings-auth-btn--danger:hover{border-color:#ef4444cc;color:#fecaca;background:#ef44441a}.thinkt-settings-list-badges{display:flex;align-items:center;gap:6px;flex-wrap:wrap}.thinkt-settings-badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:999px;font-size:11px;font-weight:600;border:1px solid rgba(255,255,255,.16);color:var(--thinkt-text-secondary, #94a3b8);background:#ffffff05}.thinkt-settings-badge--source{border-color:#94a3b873;color:#cbd5e1}.thinkt-settings-badge--source-claude{color:var(--thinkt-source-claude-color, #d97750);border-color:var(--thinkt-source-claude-border, rgba(217, 119, 80, .4));background:var(--thinkt-source-claude-bg, rgba(217, 119, 80, .15))}.thinkt-settings-badge--source-kimi{color:var(--thinkt-source-kimi-color, #19c39b);border-color:#19c39b73;background:var(--thinkt-source-kimi-bg, rgba(25, 195, 155, .15))}.thinkt-settings-badge--source-gemini{color:var(--thinkt-source-gemini-color, #6366f1);border-color:#6366f173;background:var(--thinkt-source-gemini-bg, rgba(99, 102, 241, .15))}.thinkt-settings-badge--source-copilot{color:#60a5fa;border-color:#60a5fa73;background:#60a5fa24}.thinkt-settings-badge--source-codex{color:#f472b6;border-color:#f472b673;background:#f472b624}.thinkt-settings-badge--source-qwen{color:#f59e0b;border-color:#f59e0b73;background:#f59e0b24}.thinkt-settings-badge--source-thinkt{color:#a78bfa;border-color:#a78bfa73;background:#a78bfa24}.thinkt-settings-badge--source-other{color:#cbd5e1;border-color:#94a3b873;background:#94a3b81f}.thinkt-settings-badge--terminal{border-color:#14b8a666;color:#2dd4bf;background:#14b8a61f}.thinkt-settings-badge--default{border-color:#f59e0b73;color:#fbbf24;background:#f59e0b21}.thinkt-settings-status{display:inline-flex;align-items:center;padding:2px 8px;border-radius:999px;font-size:11px;font-weight:700;border:1px solid transparent}.thinkt-settings-status--online{color:#34d399;border-color:#34d39966;background:#10b9811f}.thinkt-settings-status--offline{color:#fca5a5;border-color:#f8717173;background:#ef44441a}.thinkt-settings-status--idle{color:var(--thinkt-text-secondary, #94a3b8);border-color:#94a3b84d;background:#94a3b814}.thinkt-settings-tools{display:flex;flex-direction:column;gap:8px}.thinkt-settings-tool-row{display:grid;grid-template-columns:220px minmax(80px,1fr) 70px;gap:10px;align-items:center}.thinkt-settings-tool-name{color:var(--thinkt-text-primary, #f8fafc);font-size:12px;font-family:var(--thinkt-font-mono, "SF Mono", Monaco, "Cascadia Code", monospace);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.thinkt-settings-tool-bar{height:8px;border-radius:999px;overflow:hidden;background:#ffffff14}.thinkt-settings-tool-fill{height:100%;background:var(--thinkt-accent-color, #6366f1)}.thinkt-settings-tool-count{color:var(--thinkt-text-secondary, #94a3b8);font-size:12px;text-align:right}.thinkt-settings-progress-section{margin-top:10px}.thinkt-settings-progress-msg{color:var(--thinkt-text-secondary, #94a3b8);font-size:12px;margin-bottom:6px}.thinkt-settings-progress{margin-top:4px}.thinkt-settings-progress-label{color:var(--thinkt-muted-color, #64748b);font-size:11px;font-weight:600;margin-bottom:2px}.thinkt-settings-progress-row{display:flex;justify-content:space-between;color:var(--thinkt-text-secondary, #94a3b8);font-size:11px;margin-bottom:4px}.thinkt-settings-progress-track{height:7px;border-radius:999px;overflow:hidden;background:#ffffff14}.thinkt-settings-progress-fill{height:100%;background:var(--thinkt-accent-color, #6366f1)}.thinkt-settings-progress-meta{margin-top:6px;color:var(--thinkt-muted-color, #64748b);font-size:11px}@media(max-width:900px){.thinkt-settings-header{flex-direction:column;align-items:stretch}.thinkt-settings-actions{justify-content:flex-end}.thinkt-settings-stat-grid{grid-template-columns:repeat(2,minmax(130px,1fr))}.thinkt-settings-system-grid{grid-template-columns:1fr}.thinkt-settings-tool-row{grid-template-columns:1fr;gap:5px}.thinkt-settings-tool-count{text-align:left}}@media(max-width:640px){.thinkt-settings-overlay{padding-top:0}.thinkt-settings-modal{width:100vw;max-height:100vh;height:100vh;border-radius:0;border-left:none;border-right:none}.thinkt-settings-body,.thinkt-settings-section{padding:12px}.thinkt-settings-stat-grid,.thinkt-settings-stat-grid--embedding{grid-template-columns:1fr}}',on=150,an=5e3;class ln{constructor(t){d(this,"elements");d(this,"options");d(this,"client");d(this,"overlay",null);d(this,"abortController",new AbortController);d(this,"isOpen",!1);d(this,"activeTab","dashboard");d(this,"refreshToken",0);d(this,"indexerRefreshIntervalId",null);d(this,"showAuthToken",!1);d(this,"serverAuthEnabled",null);this.elements=t.elements,this.options=t,this.client=t.client??B(),N("thinkt-settings-overlay-styles",rn)}open(){this.isOpen||(this.isOpen=!0,this.showAuthToken=!1,this.createOverlay(),this.attachListeners(),this.setActiveTab("dashboard"),this.refreshData())}close(){!this.isOpen||!this.overlay||(this.isOpen=!1,this.overlay.classList.add("closing"),setTimeout(()=>{var t,e;this.cleanup(),(e=(t=this.options).onClose)==null||e.call(t)},on))}dispose(){this.cleanup(),this.isOpen=!1}isOpened(){return this.isOpen}cleanup(){var t;this.stopIndexerAutoRefresh(),this.abortController.abort(),this.abortController=new AbortController,this.refreshToken+=1,this.serverAuthEnabled=null,(t=this.overlay)==null||t.remove(),this.overlay=null}createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="thinkt-settings-overlay",this.overlay.innerHTML=`
      <div class="thinkt-settings-modal" role="dialog" aria-modal="true" aria-label="${c._("Settings and Info")}">
        <div class="thinkt-settings-header">
          <div class="thinkt-settings-title-wrap">
            <div class="thinkt-settings-tabs" role="tablist" aria-label="${c._("Info Panels")}">
              <button class="thinkt-settings-tab active" data-tab="dashboard" role="tab">${c._("Dashboard")}</button>
              <button class="thinkt-settings-tab" data-tab="indexer" role="tab">${c._("Indexer")}</button>
              <button class="thinkt-settings-tab" data-tab="sources" role="tab">${c._("Sources")}</button>
              <button class="thinkt-settings-tab" data-tab="apps" role="tab">${c._("Apps")}</button>
              <button class="thinkt-settings-tab" data-tab="auth" role="tab">${c._("Auth")}</button>
            </div>
          </div>
          <div class="thinkt-settings-actions">
            <button id="settings-close-btn" type="button" class="thinkt-settings-close-btn" aria-label="${c._("Close")}" title="${c._("Close")} - ESC">
              &times;
            </button>
          </div>
        </div>
        <div class="thinkt-settings-body">
          <div class="thinkt-settings-panel active" data-panel="dashboard" aria-hidden="false">
            <section class="thinkt-settings-section">
              <h3>${c._("System Status")}</h3>
              <div id="settings-connection" class="thinkt-settings-loading">${c._("Checking connection...")}</div>
            </section>
            <section class="thinkt-settings-section">
              <h3>${c._("Usage Statistics")}</h3>
              <div id="settings-stats" class="thinkt-settings-loading">${c._("Loading stats...")}</div>
            </section>
          </div>

          <div class="thinkt-settings-panel" data-panel="indexer" aria-hidden="true">
            <section class="thinkt-settings-section">
              <h3>${c._("Indexer Status")}</h3>
              <div id="settings-indexer" class="thinkt-settings-loading">${c._("Loading indexer status...")}</div>
            </section>
            <section class="thinkt-settings-section">
              <h3>${c._("Embedding Status")}</h3>
              <div id="settings-embedding" class="thinkt-settings-loading">${c._("Loading embedding status...")}</div>
            </section>
          </div>

          <div class="thinkt-settings-panel" data-panel="sources" aria-hidden="true">
            <section class="thinkt-settings-section">
              <h3>${c._("Sources")}</h3>
              <div id="settings-sources" class="thinkt-settings-loading">${c._("Loading sources...")}</div>
            </section>
          </div>

          <div class="thinkt-settings-panel" data-panel="apps" aria-hidden="true">
            <section class="thinkt-settings-section">
              <h3>${c._("Apps")}</h3>
              <div id="settings-apps" class="thinkt-settings-loading">${c._("Loading apps...")}</div>
            </section>
          </div>

          <div class="thinkt-settings-panel" data-panel="auth" aria-hidden="true">
            <section class="thinkt-settings-section">
              <h3>${c._("API Authentication")}</h3>
              <div class="thinkt-settings-auth">
                <div class="thinkt-settings-auth-current">
                  <span class="thinkt-settings-system-key">${c._("Current Token")}:</span>
                  <span id="settings-auth-current" class="thinkt-settings-auth-token">${c._("Not set")}</span>
                  <button
                    id="settings-auth-toggle-btn"
                    type="button"
                    class="thinkt-settings-auth-toggle"
                    aria-label="${c._("Show token")}"
                    title="${c._("Show token")}"
                  >
                    ${c._("Show")}
                  </button>
                </div>
                <label class="thinkt-settings-auth-label" for="settings-auth-input">${c._("Token")}</label>
                <input
                  id="settings-auth-input"
                  class="thinkt-settings-auth-input"
                  type="password"
                  placeholder="${c._("Paste bearer token")}"
                  autocomplete="off"
                  spellcheck="false"
                />
                <div class="thinkt-settings-auth-actions">
                  <button id="settings-auth-save-btn" type="button" class="thinkt-settings-auth-btn">${c._("Save Token")}</button>
                  <button id="settings-auth-clear-btn" type="button" class="thinkt-settings-auth-btn thinkt-settings-auth-btn--danger">${c._("Clear Token")}</button>
                </div>
                <div id="settings-auth-status" class="thinkt-settings-muted"></div>
              </div>
            </section>
          </div>
        </div>
      </div>
    `,this.elements.container.appendChild(this.overlay),this.syncClientTokenFromUrlIfNeeded(),this.renderAuthState()}attachListeners(){if(!this.overlay)return;this.abortController.signal.addEventListener("abort",()=>{this.stopIndexerAutoRefresh()},{once:!0}),this.overlay.addEventListener("click",o=>{o.target===this.overlay&&this.close()},{signal:this.abortController.signal});const t=this.overlay.querySelector("#settings-close-btn");t==null||t.addEventListener("click",()=>this.close(),{signal:this.abortController.signal});const e=this.overlay.querySelector("#settings-auth-save-btn");e==null||e.addEventListener("click",()=>{this.handleSaveToken()},{signal:this.abortController.signal});const i=this.overlay.querySelector("#settings-auth-clear-btn");i==null||i.addEventListener("click",()=>this.handleClearToken(),{signal:this.abortController.signal});const s=this.overlay.querySelector("#settings-auth-toggle-btn");s==null||s.addEventListener("click",()=>{this.showAuthToken=!this.showAuthToken,this.renderAuthState()},{signal:this.abortController.signal}),this.overlay.querySelectorAll(".thinkt-settings-tab").forEach(o=>{o.addEventListener("click",()=>{const a=o.dataset.tab;a&&this.setActiveTab(a)},{signal:this.abortController.signal})}),document.addEventListener("keydown",o=>{o.key==="Escape"&&(o.preventDefault(),this.close())},{signal:this.abortController.signal})}setActiveTab(t){this.overlay&&(this.activeTab=t,this.overlay.querySelectorAll(".thinkt-settings-panel").forEach(e=>{const i=e.dataset.panel===this.activeTab;e.classList.toggle("active",i),e.setAttribute("aria-hidden",i?"false":"true")}),this.overlay.querySelectorAll(".thinkt-settings-tab").forEach(e=>{const i=e.dataset.tab===this.activeTab;e.classList.toggle("active",i),e.setAttribute("aria-selected",i?"true":"false")}),this.activeTab==="indexer"?(this.refreshIndexerPanel(),this.startIndexerAutoRefresh()):this.stopIndexerAutoRefresh())}refreshData(){if(!this.overlay||!this.isOpen)return;const t=++this.refreshToken;this.setLoadingStates(),this.renderAuthState();const e=this.abortController.signal,i=this.client.getSources(),s=this.client.getLanguages(),n=this.fetchServerInfo(e),o=this.client.getStats(),a=this.client.getIndexerStatus(),l=this.client.getOpenInApps();Promise.allSettled([this.renderDashboard(t,i,s,n,o),this.renderIndexer(t,a),this.renderSources(t,i),this.renderApps(t,l)])}setLoadingStates(){this.setContent("settings-connection",`<div class="thinkt-settings-loading">${c._("Checking connection...")}</div>`),this.setContent("settings-stats",`<div class="thinkt-settings-loading">${c._("Loading stats...")}</div>`),this.setContent("settings-indexer",`<div class="thinkt-settings-loading">${c._("Loading indexer status...")}</div>`),this.setContent("settings-embedding",`<div class="thinkt-settings-loading">${c._("Loading embedding status...")}</div>`),this.setContent("settings-sources",`<div class="thinkt-settings-loading">${c._("Loading sources...")}</div>`),this.setContent("settings-apps",`<div class="thinkt-settings-loading">${c._("Loading apps...")}</div>`)}async renderDashboard(t,e,i,s,n){var Kt,Zt,Xt,Yt,Qt,Gt,Jt,te;const[o,a,l,h]=await Promise.allSettled([e,i,s,n]);if(this.isStale(t))return;const p=this.getServerHostPort(),u=l.status==="fulfilled"?l.value:void 0;this.serverAuthEnabled=(u==null?void 0:u.authenticated)??null,this.renderAuthState();const g=(u==null?void 0:u.fingerprint)??c._("Unavailable"),m=(u==null?void 0:u.version)??c._("Unavailable"),b=this.formatRevision(u==null?void 0:u.revision),f=a.status==="fulfilled"?this.formatLanguage(a.value):c._("Unavailable"),v=this.formatDateTime(u==null?void 0:u.started_at),x=this.formatUptime(u==null?void 0:u.uptime_seconds),k=(u==null?void 0:u.pid)!==void 0?this.formatNumber(u.pid):c._("Unavailable"),y=(u==null?void 0:u.authenticated)===void 0?c._("Unavailable"):u.authenticated?c._("Enabled"):c._("Disabled"),S=l.status==="rejected"?this.escapeHtml(this.toError(l.reason).message):null,$=S?`
        <div class="thinkt-settings-system-detail">
          <span class="thinkt-settings-system-key">${c._("Server Info")}:</span>
          <span>${c._("Unavailable")} (${S})</span>
        </div>
      `:"",T=o.status==="fulfilled"?c._("Sources endpoint reachable"):this.escapeHtml(this.toError(o.reason).message),R=o.status==="fulfilled"?"thinkt-settings-status--online":"thinkt-settings-status--offline",Ot=o.status==="fulfilled"?c._("Online"):c._("Offline"),Vt=`
      <div class="thinkt-settings-system-detail">
        <span class="thinkt-settings-system-key">${c._("Server")}:</span>
        <span>${this.escapeHtml(p)}</span>
      </div>
    `,qt=`
      <div class="thinkt-settings-system-detail">
        <span class="thinkt-settings-system-key">${c._("Version")}:</span>
        <span>${this.escapeHtml(m)}</span>
      </div>
      <div class="thinkt-settings-system-detail">
        <span class="thinkt-settings-system-key">${c._("Revision")}:</span>
        <span>${this.escapeHtml(b)}</span>
      </div>
      <div class="thinkt-settings-system-detail">
        <span class="thinkt-settings-system-key">${c._("Language")}:</span>
        <span>${this.escapeHtml(f)}</span>
      </div>
      <div class="thinkt-settings-system-detail">
        <span class="thinkt-settings-system-key">${c._("Fingerprint")}:</span>
        <span>${this.escapeHtml(g)}</span>
      </div>
    `,Wt=`
      <div class="thinkt-settings-system-detail">
        <span class="thinkt-settings-system-key">${c._("Started At")}:</span>
        <span>${this.escapeHtml(v)}</span>
      </div>
      <div class="thinkt-settings-system-detail">
        <span class="thinkt-settings-system-key">${c._("Server Uptime")}:</span>
        <span>${this.escapeHtml(x)}</span>
      </div>
      <div class="thinkt-settings-system-detail">
        <span class="thinkt-settings-system-key">${c._("PID")}:</span>
        <span>${this.escapeHtml(k)}</span>
      </div>
      <div class="thinkt-settings-system-detail">
        <span class="thinkt-settings-system-key">${c._("Auth")}:</span>
        <span>${this.escapeHtml(y)}</span>
      </div>
      ${$}
    `;if(o.status==="fulfilled")this.setContent("settings-connection",`
        <div class="thinkt-settings-system-grid">
          <div class="thinkt-settings-list-item">
            <div class="thinkt-settings-list-content">
              <div class="thinkt-settings-list-title">${c._("thinkt Info")}</div>
              ${qt}
            </div>
          </div>
          <div class="thinkt-settings-list-item">
            <div class="thinkt-settings-list-content">
              <div class="thinkt-settings-list-title">${c._("API Connection")}</div>
              <div class="thinkt-settings-list-meta">${T}</div>
              ${Vt}
            </div>
            <div class="thinkt-settings-status ${R}">${Ot}</div>
          </div>
          <div class="thinkt-settings-list-item">
            <div class="thinkt-settings-list-content">
              <div class="thinkt-settings-list-title">${c._("Server Info")}</div>
              ${Wt}
            </div>
          </div>
        </div>
      `);else{const rt=this.toError(o.reason);this.setContent("settings-connection",`
        <div class="thinkt-settings-system-grid">
          <div class="thinkt-settings-list-item">
            <div class="thinkt-settings-list-content">
              <div class="thinkt-settings-list-title">${c._("thinkt Info")}</div>
              ${qt}
            </div>
          </div>
          <div class="thinkt-settings-list-item">
            <div class="thinkt-settings-list-content">
              <div class="thinkt-settings-list-title">${c._("API Connection")}</div>
              <div class="thinkt-settings-list-meta">${T}</div>
              ${Vt}
            </div>
            <div class="thinkt-settings-status ${R}">${Ot}</div>
          </div>
          <div class="thinkt-settings-list-item">
            <div class="thinkt-settings-list-content">
              <div class="thinkt-settings-list-title">${c._("Server Info")}</div>
              ${Wt}
            </div>
          </div>
        </div>
      `),(Zt=(Kt=this.options).onError)==null||Zt.call(Kt,rt)}if(l.status==="rejected"&&((Yt=(Xt=this.options).onError)==null||Yt.call(Xt,this.toError(l.reason))),a.status==="rejected"&&((Gt=(Qt=this.options).onError)==null||Gt.call(Qt,this.toError(a.reason))),h.status==="fulfilled")this.setContent("settings-stats",this.renderStats(h.value));else{const rt=this.toError(h.reason);this.setContent("settings-stats",`<div class="thinkt-settings-error">${c._("Failed to load stats: {message}",{message:this.escapeHtml(rt.message)})}</div>`),(te=(Jt=this.options).onError)==null||te.call(Jt,rt)}}async renderIndexer(t,e){var n,o;const[i]=await Promise.allSettled([e]);if(this.isStale(t))return;if(i.status==="fulfilled"){this.setContent("settings-indexer",this.renderIndexerStatus(i.value)),this.setContent("settings-embedding",this.renderEmbeddingStatus(i.value));return}const s=this.toError(i.reason);this.setContent("settings-indexer",`<div class="thinkt-settings-muted">${c._("Indexer status unavailable: {message}",{message:this.escapeHtml(s.message)})}</div>`),this.setContent("settings-embedding",`<div class="thinkt-settings-muted">${c._("Embedding status unavailable: {message}",{message:this.escapeHtml(s.message)})}</div>`),(o=(n=this.options).onError)==null||o.call(n,s)}refreshIndexerPanel(){if(!this.isOpen||!this.overlay)return;const t=this.refreshToken,e=this.client.getIndexerStatus();this.renderIndexer(t,e)}startIndexerAutoRefresh(){this.indexerRefreshIntervalId===null&&(this.indexerRefreshIntervalId=setInterval(()=>{this.refreshIndexerPanel()},an))}stopIndexerAutoRefresh(){this.indexerRefreshIntervalId!==null&&(clearInterval(this.indexerRefreshIntervalId),this.indexerRefreshIntervalId=null)}async renderSources(t,e){var o,a;const i=await Promise.allSettled([e]);if(this.isStale(t))return;const s=i[0];if(s.status==="rejected"){const l=this.toError(s.reason);this.setContent("settings-sources",`<div class="thinkt-settings-error">${c._("Failed to load sources: {message}",{message:this.escapeHtml(l.message)})}</div>`),(a=(o=this.options).onError)==null||a.call(o,l);return}const n=s.value;if(n.length===0){this.setContent("settings-sources",`<div class="thinkt-settings-muted">${c._("No sources found.")}</div>`);return}this.setContent("settings-sources",`
      <div class="thinkt-settings-list">
        ${n.map(l=>this.renderSourceItem(l)).join("")}
      </div>
    `)}async renderApps(t,e){var h,p;const i=await Promise.allSettled([e]);if(this.isStale(t))return;const s=i[0];if(s.status==="rejected"){const u=this.toError(s.reason);this.setContent("settings-apps",`<div class="thinkt-settings-error">${c._("Failed to load apps: {message}",{message:this.escapeHtml(u.message)})}</div>`),(p=(h=this.options).onError)==null||p.call(h,u);return}const n=s.value,o=n.apps??[],a=n.default_terminal;if(o.length===0){this.setContent("settings-apps",`<div class="thinkt-settings-muted">${c._("No apps configured.")}</div>`);return}const l=a?`<div class="thinkt-settings-note">${c._("Default terminal: {app}",{app:this.escapeHtml(a)})}</div>`:"";this.setContent("settings-apps",`
      ${l}
      <div class="thinkt-settings-list">
        ${o.map(u=>this.renderAppItem(u,a)).join("")}
      </div>
    `)}renderStats(t){const e=[...t.top_tools??[]].sort((n,o)=>(o.count??0)-(n.count??0)).slice(0,10),i=[{label:c._("Sessions"),value:this.formatNumber(t.total_sessions)},{label:c._("Projects"),value:this.formatNumber(t.total_projects)},{label:c._("Entries"),value:this.formatNumber(t.total_entries)},{label:c._("Total Tokens"),value:this.formatNumber(t.total_tokens)}],s=e.length>0?`
        <div class="thinkt-settings-subtitle">${c._("Top Tools Used")}</div>
        <div class="thinkt-settings-tools">
          ${e.map(n=>{var l;const o=((l=e[0])==null?void 0:l.count)??1,a=Math.round((n.count??0)/o*100);return`
              <div class="thinkt-settings-tool-row">
                <div class="thinkt-settings-tool-name">${this.escapeHtml(n.name??"â€”")}</div>
                <div class="thinkt-settings-tool-bar">
                  <div class="thinkt-settings-tool-fill" style="width: ${a}%"></div>
                </div>
                <div class="thinkt-settings-tool-count">${this.formatNumber(n.count)}</div>
              </div>
            `}).join("")}
        </div>
      `:`<div class="thinkt-settings-muted">${c._("No tool usage yet.")}</div>`;return`
      <div class="thinkt-settings-stat-grid">
        ${i.map(n=>`
          <div class="thinkt-settings-stat-card">
            <div class="thinkt-settings-stat-label">${n.label}</div>
            <div class="thinkt-settings-stat-value">${n.value}</div>
          </div>
        `).join("")}
      </div>
      ${s}
    `}renderIndexerStatus(t){const e=t.running===!0,i=t.state??(e?c._("Running"):c._("Idle")),s=e?"thinkt-settings-status--online":"thinkt-settings-status--idle",n=t.watching?c._("Yes"):c._("No"),o=this.renderProgressInfo(c._("Sync Progress"),t.sync_progress,{includeProjects:!0,includeSessions:!0});return`
      <div class="thinkt-settings-stat-grid thinkt-settings-stat-grid--indexer">
        <div class="thinkt-settings-stat-card">
          <div class="thinkt-settings-stat-label">${c._("Uptime")}</div>
          <div class="thinkt-settings-stat-value">${this.formatUptime(t.uptime_seconds)}</div>
        </div>
        <div class="thinkt-settings-stat-card">
          <div class="thinkt-settings-stat-label">${c._("Watching")}</div>
          <div class="thinkt-settings-stat-value">${n}</div>
        </div>
        <div class="thinkt-settings-stat-card">
          <div class="thinkt-settings-stat-label">${c._("State")}</div>
          <div class="thinkt-settings-stat-value"><span class="thinkt-settings-status ${s}">${this.escapeHtml(i)}</span></div>
        </div>
      </div>
      ${o}
      ${o?"":`<div class="thinkt-settings-muted">${c._("No active sync in progress.")}</div>`}
    `}renderEmbeddingStatus(t){const e=typeof t.model=="string"&&t.model.trim().length>0,i=(t.state??"").includes("embedding")||t.embed_progress!==void 0,s=i?c._("Running"):e?c._("Enabled"):c._("Not loaded"),n=i?"thinkt-settings-status--online":e?"thinkt-settings-status--idle":"thinkt-settings-status--offline",o=e?this.escapeHtml(t.model??""):this.escapeHtml(c._("Not loaded")),a=t.model_dim!==void 0?`${t.model_dim}d`:c._("No dimension reported"),l=this.renderProgressInfo(c._("Embedding Progress"),t.embed_progress,{includeSessions:!0,includeChunks:!0});return`
      <div class="thinkt-settings-stat-grid thinkt-settings-stat-grid--embedding">
        <div class="thinkt-settings-stat-card">
          <div class="thinkt-settings-stat-label">${c._("Model")}</div>
          <div class="thinkt-settings-stat-value">${o}</div>
          <div class="thinkt-settings-stat-meta">${this.escapeHtml(a)}</div>
        </div>
        <div class="thinkt-settings-stat-card">
          <div class="thinkt-settings-stat-label">${c._("Status")}</div>
          <div class="thinkt-settings-stat-value"><span class="thinkt-settings-status ${n}">${this.escapeHtml(s)}</span></div>
        </div>
      </div>
      ${l}
      ${l?"":`<div class="thinkt-settings-muted">${c._("No active embedding in progress.")}</div>`}
    `}renderProgressInfo(t,e,i={}){if(!e)return"";const s=i.includeProjects?this.renderLabeledProgressBar(c._("Projects"),e.project,e.project_total):"",n=i.includeSessions?this.renderLabeledProgressBar(c._("Sessions"),e.done,e.total):"",o=i.includeChunks?this.renderLabeledProgressBar(c._("Chunks"),e.chunks_done,e.chunks_total):"",a=!s&&!n&&!o?this.renderLabeledProgressBar(c._("Sessions"),e.done??e.chunks_done,e.total??e.chunks_total):"",l=e.message?`<div class="thinkt-settings-progress-msg">${this.escapeHtml(e.message)}</div>`:"",h=e.project_name?`<div class="thinkt-settings-progress-meta">${c._("Project: {projectName}",{projectName:this.escapeHtml(e.project_name)})}</div>`:"",p=`${s}${n}${o}${a}`;return`
      <div class="thinkt-settings-progress-section">
        <div class="thinkt-settings-subtitle">${this.escapeHtml(t)}</div>
        ${l}
        ${p}
        ${h}
      </div>
    `}renderLabeledProgressBar(t,e,i){if(e===void 0||i===void 0||i<=0)return"";const s=Math.min(100,Math.round(e/i*100));return`
      <div class="thinkt-settings-progress">
        <div class="thinkt-settings-progress-label">${this.escapeHtml(t)}</div>
        <div class="thinkt-settings-progress-row">
          <span>${this.formatNumber(e)} / ${this.formatNumber(i)}</span>
          <span>${s}%</span>
        </div>
        <div class="thinkt-settings-progress-track">
          <div class="thinkt-settings-progress-fill" style="width: ${s}%"></div>
        </div>
      </div>
    `}renderSourceItem(t){const e=t.name??c._("Unknown"),i=t.base_path??"",s=t.can_resume===!0,n=t.available===!1,o=this.getSourceBadgeClass(e),a=n?"thinkt-settings-status--offline":"thinkt-settings-status--online",l=n?c._("Offline"):c._("Online");return`
      <div class="thinkt-settings-list-item">
        <div class="thinkt-settings-list-content">
          <div class="thinkt-settings-list-title">
            <span class="thinkt-settings-badge thinkt-settings-badge--source ${o}">${this.escapeHtml(e)}</span>
          </div>
          <div class="thinkt-settings-list-meta">${this.escapeHtml(i)}</div>
        </div>
        <div class="thinkt-settings-list-badges">
          ${s?`<span class="thinkt-settings-badge">${c._("Resumable")}</span>`:""}
          <span class="thinkt-settings-status ${a}">${l}</span>
        </div>
      </div>
    `}renderAppItem(t,e){const i=t.name??t.id??c._("Unknown"),s=t.id??"",n=t.terminal===!0,o=n&&e!==void 0&&s===e,a=t.enabled!==!1;return`
      <div class="thinkt-settings-list-item">
        <div class="thinkt-settings-list-content">
          <div class="thinkt-settings-list-title">
            ${this.escapeHtml(i)}
            ${n?`<span class="thinkt-settings-badge thinkt-settings-badge--terminal">${c._("terminal")}</span>`:""}
            ${o?`<span class="thinkt-settings-badge thinkt-settings-badge--default">${c._("default")}</span>`:""}
          </div>
          <div class="thinkt-settings-list-meta">${this.escapeHtml(s)} Â· ${a?c._("enabled"):c._("disabled")}</div>
        </div>
      </div>
    `}setContent(t,e){var s;const i=(s=this.overlay)==null?void 0:s.querySelector(`#${t}`);i&&(i.innerHTML=e)}isStale(t){return!this.isOpen||!this.overlay||t!==this.refreshToken}formatNumber(t){return t===void 0?"â€”":t.toLocaleString()}formatUptime(t){if(t===void 0)return"â€”";if(t<60)return`${t}s`;const e=Math.floor(t/3600),i=Math.floor(t%3600/60);return e>0?`${e}h ${i}m`:`${i}m`}toError(t){return t instanceof Error?t:new Error(typeof t=="string"?t:c._("Unknown error"))}getServerHostPort(){const t=this.client.getConfig().baseUrl;try{const e=new URL(t);return e.port?`${e.hostname}:${e.port}`:e.hostname}catch{return t.replace(/^https?:\/\//,"")}}formatDateTime(t){if(!t)return"â€”";const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleString()}formatRevision(t){return t?t.length>7?t.slice(0,7):t:"â€”"}formatLanguage(t){var n;const e=typeof t.active=="string"?t.active.trim():"";if(e.length>0)return e;const i=(n=t.languages)==null?void 0:n.find(o=>o.active===!0),s=typeof(i==null?void 0:i.tag)=="string"?i.tag.trim():"";return s.length>0?s:"â€”"}async fetchServerInfo(t){const e=this.client;if(typeof e.getInfo=="function")return e.getInfo();if(e.api&&typeof e.api.getInfo=="function")return e.api.getInfo();const{baseUrl:i,apiVersion:s,token:n,fetch:o}=this.client.getConfig(),a=o??fetch,l=`${i}${s}/info`,h={};n&&n.trim().length>0&&(h.Authorization=`Bearer ${n}`);const p=await a(l,{method:"GET",headers:h,signal:t});if(!p.ok)throw new Error(c._("Failed to load server info: HTTP {status}",{status:p.status}));const u=await p.json();if(!u||typeof u!="object")throw new Error(c._("Invalid server info response"));return u}renderAuthState(t){if(!this.overlay)return;const e=this.getEffectiveToken(),i=typeof e=="string"&&e.length>0,s=!i&&this.serverAuthEnabled===!0,n=this.overlay.querySelector("#settings-auth-current");n&&(n.textContent=i?this.showAuthToken?e:this.maskToken(e):s?c._("Set (injected)"):c._("Not set"));const o=this.overlay.querySelector("#settings-auth-input");o&&(o.value=e??"");const a=this.overlay.querySelector("#settings-auth-toggle-btn");a&&(a.disabled=!i,i&&this.showAuthToken?(a.textContent=c._("Hide"),a.setAttribute("aria-label",c._("Hide token")),a.setAttribute("title",c._("Hide token"))):(a.textContent=c._("Show"),a.setAttribute("aria-label",c._("Show token")),a.setAttribute("title",c._("Show token"))));const l=this.overlay.querySelector("#settings-auth-status");if(l){const h=s?c._("Token is provided by the runtime and cannot be displayed in the browser."):"",p=t??h;l.textContent=p,l.className=p?"thinkt-settings-note":"thinkt-settings-muted"}}async handleSaveToken(){if(!this.overlay)return;const t=this.overlay.querySelector("#settings-auth-input");if(!t)return;const e=t.value.trim();this.showAuthToken=!1,this.client.setConfig({token:e.length>0?e:void 0}),this.updateTokenHash(e.length>0?e:null),this.renderAuthState(c._("Auth token updated.")),this.refreshData()}handleClearToken(){this.showAuthToken=!1,this.client.setConfig({token:void 0}),this.updateTokenHash(null),this.renderAuthState(c._("Auth token cleared.")),this.refreshData()}updateTokenHash(t){if(typeof window>"u")return;const e=window.location.hash.replace(/^#/,""),i=new URLSearchParams(e);t?i.set("token",t):i.delete("token");const s=i.toString(),n=`${window.location.pathname}${window.location.search}${s?`#${s}`:""}`;window.history.replaceState(null,"",n)}maskToken(t){const e=/^thinkt_(\d{8})_(.+)$/.exec(t);if(e){const i=e[1],s=t.slice(-4);return`thinkt_${i}_â€¢â€¢â€¢â€¢${s}`}return t.length<=8?t:`${t.slice(0,4)}â€¢â€¢â€¢â€¢${t.slice(-4)}`}getEffectiveToken(){const t=this.client.getConfig().token;if(t&&t.trim().length>0)return t;if(typeof window>"u")return null;const e=window.location.hash.replace(/^#/,""),i=new URLSearchParams(e).get("token");if(i&&i.trim().length>0)return i;const s=new URLSearchParams(window.location.search).get("token");return s&&s.trim().length>0?s:null}syncClientTokenFromUrlIfNeeded(){const t=this.client.getConfig().token;if(t&&t.trim().length>0)return;const e=this.getEffectiveToken();e&&e.trim().length>0&&this.client.setConfig({token:e})}getSourceBadgeClass(t){const e=t.trim().toLowerCase();return e==="claude"?"thinkt-settings-badge--source-claude":e==="kimi"?"thinkt-settings-badge--source-kimi":e==="gemini"?"thinkt-settings-badge--source-gemini":e==="copilot"?"thinkt-settings-badge--source-copilot":e==="codex"?"thinkt-settings-badge--source-codex":e==="qwen"?"thinkt-settings-badge--source-qwen":e==="thinkt"?"thinkt-settings-badge--source-thinkt":"thinkt-settings-badge--source-other"}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}function cn(){var r;if(typeof window<"u"){const e=new URLSearchParams(window.location.search).get("api-url");if(e)try{return new URL(e),e}catch{console.error("[THINKT] Invalid API URL in query parameter:",e)}const i=window.THINKT_API_URL;if(i)return i}if(typeof document<"u"){const t=(r=document.querySelector('meta[name="thinkt-api-url"]'))==null?void 0:r.getAttribute("content");if(t)return t}return typeof window<"u"?window.location.origin:"http://localhost:8784"}function hn(){if(typeof window>"u")return null;const r=window.location.hash.replace(/^#/,""),t=new URLSearchParams(r).get("token");return t||new URLSearchParams(window.location.search).get("token")}function tt(...r){if(typeof window>"u")return null;const t=new URLSearchParams(window.location.hash.replace(/^#/,""));for(const i of r){const s=t.get(i);if(s&&s.trim().length>0)return s.trim()}const e=new URLSearchParams(window.location.search);for(const i of r){const s=e.get(i);if(s&&s.trim().length>0)return s.trim()}return null}function dn(r){if(!r)return;const t=Number.parseInt(r,10);if(!(!Number.isFinite(t)||t<=0))return t}function pn(){const r=tt("session_path","path","session");return r?{sessionPath:r,sessionId:tt("session_id")??void 0,projectName:tt("project_name","project")??void 0,projectId:tt("project_id")??void 0,lineNum:dn(tt("line_num","line"))}:null}const un="modulepreload",mn=function(r){return"/"+r},Ce={},xt=function(t,e,i){let s=Promise.resolve();if(e&&e.length>0){let o=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=o(e.map(h=>{if(h=mn(h),h in Ce)return;Ce[h]=!0;const p=h.endsWith(".css"),u=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${u}`))return;const g=document.createElement("link");if(g.rel=p?"stylesheet":un,p||(g.as="script"),g.crossOrigin="",g.href=h,l&&g.setAttribute("nonce",l),document.head.appendChild(g),p)return new Promise((m,b)=>{g.addEventListener("load",m),g.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${h}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return t().catch(n)})},Tt=["en","zh","es"],Ye="thinkt-locale",gn="en",fn={en:()=>xt(()=>import("./messages.js"),[]),zh:()=>xt(()=>import("./messages2.js"),[]),es:()=>xt(()=>import("./messages3.js"),[])},Te=new Set;function Ee(r){if(!r)return null;const t=r.toLowerCase(),e=t.split("-")[0];return Tt.includes(t)?t:Tt.includes(e)?e:null}async function kn(r){if(Te.has(r))return;const t=await fn[r]();c.load(r,t.messages),Te.add(r)}async function Qe(r){await kn(r),c.activate(r)}async function bn(){const r=Ee(localStorage.getItem(Ye)),t=Ee(navigator.language),e=r??t??gn;return await Qe(e),e}async function vn(r){localStorage.setItem(Ye,r),await Qe(r)}class xn{constructor(t){d(this,"container");d(this,"locales");d(this,"onChange");d(this,"currentLocale");d(this,"selectEl");d(this,"handleChange",()=>{const t=this.selectEl.value;if(!this.locales.includes(t)){this.selectEl.value=this.currentLocale;return}Promise.resolve(this.onChange(t)).catch(e=>{console.error("[THINKT] Failed to change locale:",e),this.selectEl.value=this.currentLocale})});this.container=t.container,this.locales=t.locales,this.onChange=t.onChange,this.currentLocale=t.currentLocale,this.selectEl=document.createElement("select"),this.selectEl.id="lang-select",this.selectEl.addEventListener("change",this.handleChange),this.container.replaceChildren(this.selectEl),this.renderOptions()}setCurrentLocale(t){this.currentLocale=t,this.renderOptions()}dispose(){this.selectEl.removeEventListener("change",this.handleChange),this.container.replaceChildren()}renderOptions(){this.selectEl.replaceChildren();for(const t of this.locales){const e=document.createElement("option");e.value=t,e.textContent=this.getLocaleLabel(t),this.selectEl.appendChild(e)}this.selectEl.value=this.currentLocale}createDisplayNames(t){try{return new Intl.DisplayNames([t],{type:"language"})}catch{return null}}getLocaleLabel(t){const e=this.createDisplayNames(t);return e?e.of(t)??t:t}}let P=null,j=null,A=null,ct=null,z=null,F=null,U=null,O=null,gt=null,Et={status:"connecting"};async function Pe(){const r=await bn();document.documentElement.lang=r,wn(r),Sn(),Cn(),Tn(),st("connecting");const t=cn(),e=hn();di({baseUrl:t,...e?{token:e}:{}}),console.log(`[THINKT] Initializing (API: ${t}, auth: ${e?"token":"none"}, lang: ${r})`);const i={container:document.getElementById("app"),projectBrowserContainer:document.getElementById("project-browser"),sessionListContainer:document.getElementById("session-list"),viewerContainer:document.getElementById("viewer-container"),resizer:document.getElementById("resizer")};for(const[n,o]of Object.entries(i))if(!o){console.error(`[THINKT] Required element not found: ${n}`);return}P=new Ys({elements:i,onSessionLoaded:(n,o)=>{console.log(`[THINKT] Loaded session: ${n.id} (${o.length} entries)`),gt=n.firstPrompt??n.id??"Session",Ge(gt)},onError:n=>{st("error",n.message)}}),Pn();const s=pn();s&&(await P.whenReady(),ii({path:s.sessionPath,session_path:s.sessionPath,session_id:s.sessionId,project_name:s.projectName,project_id:s.projectId},s.lineNum)),In(),yn(),console.log("[THINKT] API App initialized")}function wn(r){const t=document.getElementById("lang-select-container");t instanceof HTMLElement&&(z==null||z.dispose(),z=new xn({container:t,locales:Tt,currentLocale:r,onChange:async e=>{await vn(e),document.documentElement.lang=e,z==null||z.setCurrentLocale(e),Rn(),console.log(`[THINKT] Language changed to: ${e}`),window.dispatchEvent(new CustomEvent("thinkt:locale-changed",{detail:{locale:e}}))}}))}function yn(){const r=document.getElementById("loading");r&&(r.classList.add("hidden"),setTimeout(()=>r.remove(),300))}function Ge(r){document.title=c._("{sessionTitle} - THINKT",{sessionTitle:r})}function _n(){const r=navigator.platform.toLowerCase();return r.includes("mac")||r.includes("iphone")||r.includes("ipad")?"Cmd+K":"Ctrl+K"}function Je(){const r=document.getElementById("global-search-button");if(!(r instanceof HTMLButtonElement))return;const t=_n(),e=c._("Open search dialog ({shortcut})",{shortcut:t});r.title=e,r.setAttribute("aria-label",e)}function Pt(){const r=document.getElementById("global-sidebar-button");if(!(r instanceof HTMLButtonElement))return;const t=c._("Toggle sidebar panel");r.title=t,r.setAttribute("aria-label",t)}function ti(){const r=document.getElementById("global-settings-button");if(!(r instanceof HTMLButtonElement))return;const t=c._("Open settings and info");r.title=t,r.setAttribute("aria-label",t)}function Sn(){F==null||F(),F=null;const r=document.getElementById("global-sidebar-button");if(!(r instanceof HTMLButtonElement))return;const t=()=>{P==null||P.toggleSidebar()},e=()=>{Pt()};r.addEventListener("click",t),window.addEventListener("thinkt:sidebar-collapsed-change",e),F=()=>{r.removeEventListener("click",t),window.removeEventListener("thinkt:sidebar-collapsed-change",e)},Pt()}function Cn(){U==null||U(),U=null;const r=document.getElementById("global-settings-button");if(!(r instanceof HTMLButtonElement))return;const t=()=>{$n()};r.addEventListener("click",t),U=()=>{r.removeEventListener("click",t)},ti()}function Tn(){O==null||O(),O=null;const r=document.getElementById("global-search-button");if(!(r instanceof HTMLButtonElement))return;const t=()=>{ei()};r.addEventListener("click",t),O=()=>{r.removeEventListener("click",t)},Je()}function st(r,t){Et={status:r,message:t};const e=document.getElementById("global-status");if(!e)return;e.classList.remove("connected","error","connecting"),e.classList.add(r);const i=e.querySelector(".status-text");i&&(i.textContent=t??(r==="connected"?c._("Connected"):r==="connecting"?c._("Connecting..."):c._("Disconnected")))}function En(r){return r instanceof HTMLElement?r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.isContentEditable:!1}function Pn(){document.addEventListener("keydown",r=>{var t;if((r.ctrlKey||r.metaKey)&&r.key==="r"){r.preventDefault();const e=P==null?void 0:P.refreshProjects();e&&e.catch(i=>{console.warn("[THINKT] Failed to refresh projects:",i)});return}if((r.ctrlKey||r.metaKey)&&r.key==="k"){r.preventDefault(),ei();return}if(r.key==="Escape"){if(j!=null&&j.isOpened()||A!=null&&A.isOpened())return;(t=document.getElementById("app"))==null||t.focus();return}if(r.key==="/"&&!r.ctrlKey&&!r.metaKey&&!r.altKey){if(En(r.target))return;r.preventDefault(),(P==null?void 0:P.getCurrentProject())?P==null||P.focusSessionSearch():P==null||P.focusProjectSearch()}})}function ei(){j!=null&&j.isOpened()||(A==null||A.close(),j=new nn({elements:{container:document.body},onSessionSelect:(r,t)=>{ii(r,t)},onClose:()=>{j=null},onError:r=>{console.error("[THINKT] Search error:",r)}}),j.open())}function $n(){A!=null&&A.isOpened()||(j==null||j.close(),A=new ln({elements:{container:document.body},onClose:()=>{A=null},onError:r=>{console.error("[THINKT] Settings overlay error:",r)}}),A.open())}async function ii(r,t){var s;const e=P;if(!e)return;await e.whenReady();const i=r.path??r.session_path;if(!i){console.error("[THINKT] Search result has no path");return}try{const n=await Ln(i),o=r.project_id??(n==null?void 0:n.project_id),a=r.project_name??(n==null?void 0:n.project_name),l=(n==null?void 0:n.session_path)??i,h=r.session_id??(n==null?void 0:n.session_id);o?await e.selectProject(o):a&&await e.selectProjectByName(a),await e.loadSession(l);const p=(s=e.getCurrentSession())==null?void 0:s.meta.id,u=h??p;if(u?e.selectSessionById(u):console.warn("[THINKT] Unable to resolve target session id for sidebar selection"),t!==void 0&&t>0){await new Promise(m=>setTimeout(m,100));const g=Math.max(0,t-1);e.scrollToEntry(g)}}catch(n){console.error("[THINKT] Failed to load session from search:",n)}}function jn(r){return r.endsWith("/")?r.slice(0,-1):r}function An(r){return r.startsWith("/")?r:`/${r}`}async function Ln(r){const t=B(),e=t.resolveSession;if(typeof e=="function")try{return await e.call(t,r)}catch{return null}try{const i=t.getConfig(),s=jn(i.baseUrl),n=An(i.apiVersion),o=new URL(`${s}${n}/sessions/resolve`);o.searchParams.set("path",r);const a=new Headers({Accept:"application/json"});i.token&&i.token.trim().length>0&&a.set("Authorization",`Bearer ${i.token}`);const l=await(i.fetch??fetch)(o.toString(),{method:"GET",headers:a});if(!l.ok)return null;const h=await l.json();return!h||typeof h!="object"?null:h}catch{return null}}function In(){$e(),ct=setInterval(()=>{$e()},3e4)}async function $e(){try{await B().getSources(),st("connected")}catch(r){st("error",r instanceof Error?r.message:c._("Connection failed"))}}function Rn(){gt&&Ge(gt),Pt(),ti(),Je(),st(Et.status,Et.message)}function zn(){ct!==null&&(clearInterval(ct),ct=null),z==null||z.dispose(),z=null,F==null||F(),F=null,U==null||U(),U=null,O==null||O(),O=null,P==null||P.dispose(),P=null,j==null||j.dispose(),j=null,A==null||A.dispose(),A=null}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{Pe()}):Pe();window.addEventListener("beforeunload",zn);
